!function(t,l){"use strict";t.echo=t.echo||{};function r(){return z.__string_rec(this,"")}var i,h=h||{};function e(t,r){var i=Object.create(t);for(var e in r)i[e]=r[e];return r.toString!==Object.prototype.toString&&(i.toString=r.toString),i}function s(){}s.__name__=!0,s.remove=function(t,r){var i=t.indexOf(r);return-1!=i&&(t.splice(i,1),!0)},s.now=function(){return Date.now()};function n(){this.listeners=new F}n.__name__=!0,n.prototype={listen:function(t,r){Object.prototype.hasOwnProperty.call(this.listeners.h,t)||(this.listeners.h[t]=[]),this.listeners.h[t].push(r)},dispatch:function(t,r){if(Object.prototype.hasOwnProperty.call(this.listeners.h,t))for(var i=0,e=this.listeners.h[t];i<e.length;)e[i++](r)},unlisten:function(t,r){if(null!=t||null!=r)if(null==t&&null!=r)for(var i=Object.keys(this.listeners.h),e=i.length,n=0;n<e;)s.remove(this.listeners.h[i[n++]],r);else null!=t&&null==r?this.listeners.h[t]=[]:Object.prototype.hasOwnProperty.call(this.listeners.h,t)&&s.remove(this.listeners.h[t],r)}};var d=function(){var t=this;PIXI.Application.call(this,{width:window.innerWidth,height:window.innerHeight,backgroundColor:26214,antialias:!1,transparent:!0,resizeTo:d.container}),Ct.init(),d.container.appendChild(this.view),d.container.oncontextmenu=function(t){return t.preventDefault()},this.ticker.add(tr(this,this.update)),window.onresize=function(){return Vt.get(.025,function(){d.app_events.dispatch(o.RESIZE,{width:t.renderer.width,height:t.renderer.height})})},window.ondeviceorientation=function(){return Vt.get(.025,function(){d.app_events.dispatch(o.RESIZE,{width:t.renderer.width,height:t.renderer.height})})},this.switch_state(new mt),Dt.init(),d.app_events.dispatch(o.RESIZE,{width:this.renderer.width,height:this.renderer.height})};d.__name__=!0,d.main=function(){d.assets=new PIXI.Loader,d.assets.add(["assets/arrow.png","assets/audio.png","assets/ball_and_chain.png","assets/box_glow.png","assets/box.png","assets/buildings.png","assets/clouds_bg.png","assets/copy.png","assets/copy_confirmation.png","assets/cta.png","assets/facebook.png","assets/heart.png","assets/level.json","assets/linkedin.png","assets/logo.png","assets/paddle.png","assets/player.png","assets/player_dead.png","assets/pointer.png","assets/poof.png","assets/power_icons.png","assets/project.ogmo","assets/rolling_ball.png","assets/saw_blade.png","assets/share.png","assets/spikes.png","assets/star.png","assets/test.png","assets/tiles.png","assets/twitter.png"]),d.assets.load(function(){return d.app=new d})},d.__super__=PIXI.Application,d.prototype=e(PIXI.Application.prototype,{update:function(t){t/=60,Vt.update(t),Zt.update(t),Yt.update(t),d.game_events.dispatch(y.PRE_UPDATE,{dt:t}),d.game_events.dispatch(y.UPDATE,{dt:t}),d.game_events.dispatch(y.POST_UPDATE,{dt:t})},switch_state:function(t){null!=this.state&&this.state.destroy(),this.state=t,this.stage.addChild(t)}});var o=function(){};o.__name__=!0;var y=function(){};y.__name__=!0,Math.__name__=!0;function _(){}_.__name__=!0,_.field=function(t,r){try{return t[r]}catch(t){return null}},_.getProperty=function(t,r){var i;if(null==t)return null;var e=!!t.__properties__&&(i=t.__properties__["get_"+r]);return e?t[i]():t[r]},_.setProperty=function(t,r,i){var e,n=!!t.__properties__&&(e=t.__properties__["set_"+r]);n?t[e](i):t[r]=i},_.fields=function(t){var r=[];if(null!=t){var i=Object.prototype.hasOwnProperty;for(var e in t)"__id__"!=e&&"hx__closures__"!=e&&i.call(t,e)&&r.push(e)}return r},_.compare=function(t,r){return t==r?0:r<t?1:-1},_.isEnumValue=function(t){return null!=t&&null!=t.__enum__},_.copy=function(t){if(null==t)return null;for(var r={},i=0,e=_.fields(t);i<e.length;){var n=e[i];++i,r[n]=_.field(t,n)}return r};function c(){}c.__name__=!0,c.string=function(t){return z.__string_rec(t,"")},c.parseInt=function(t){if(null!=t)for(var r=0,i=t.length;r<i;){var e=r++,n=t.charCodeAt(e);if(n<=8||14<=n&&32!=n&&45!=n){var o=t.charCodeAt(1+e),l=parseInt(t,120==o||88==o?16:10);return isNaN(l)?null:l}}return null};function a(){}a.__name__=!0,a.createInstance=function(t,r){return new(Function.prototype.bind.apply(t,[null].concat(r)))},a.enumParameters=function(t){var r=h[t.__enum__].__constructs__[t._hx_index].__params__;if(null==r)return[];for(var i=[],e=0;e<r.length;){var n=r[e];++e,i.push(t[n])}return i};var u={gt:function(t,r){var i=t<0;return i!=r<0?i:r<t}},j=function(t){this.transform=new O,this.layer_mask=I._new(),this.layers=I._new(),this.drag=new hi(0,0),this.max_velocity=new hi(0,0),this.acceleration=new hi(0,0),this.velocity=new hi(0,0),this.id=++j.ids,this.active=!0,this.shapes=[],this.data={},this.disposed=!1,this.transform.on_dirty=tr(this,this.on_dirty),this.load_options(t)};j.__name__=!0,j.__properties__={get_defaults:"get_defaults"},j.get_defaults=function(){return{kinematic:!1,mass:1,x:0,y:0,rotation:0,scale_x:1,scale_y:1,elasticity:0,velocity_x:0,velocity_y:0,rotational_velocity:0,max_velocity_x:0,max_velocity_y:0,max_velocity_length:0,max_rotational_velocity:1e4,drag_x:0,drag_y:0,drag_length:0,rotational_drag:0,gravity_scale:1}},j.prototype={load_options:function(t){t=N.copy_fields(t,j.get_defaults());for(var r=0,i=this.shapes;r<i.length;)i[r++].put();this.shapes.length=0;var e=t.x,n=this.transform;if(!n.dirty){n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(r=0,i=n.children;r<i.length;){var o=i[r];++r,o.dirty=o.inverse_dirty=o.coordinates_dirty=!0;for(var l=0,s=o.children;l<s.length;)s[l++].set_dirty(!0);null!=o.on_dirty&&o.on_dirty(o)}null!=n.on_dirty&&n.on_dirty(n)}n.local_x=e,null!=this.on_move&&this.on_move(this.transform.local_x,this.transform.local_y);e=t.y;if(!(n=this.transform).dirty){n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(r=0,i=n.children;r<i.length;){o=i[r];++r,o.dirty=o.inverse_dirty=o.coordinates_dirty=!0;for(l=0,s=o.children;l<s.length;)s[l++].set_dirty(!0);null!=o.on_dirty&&o.on_dirty(o)}null!=n.on_dirty&&n.on_dirty(n)}n.local_y=e,null!=this.on_move&&this.on_move(this.transform.local_x,this.transform.local_y);e=t.rotation;if(!(n=this.transform).dirty){n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(r=0,i=n.children;r<i.length;){o=i[r];++r,o.dirty=o.inverse_dirty=o.coordinates_dirty=!0;for(l=0,s=o.children;l<s.length;)s[l++].set_dirty(!0);null!=o.on_dirty&&o.on_dirty(o)}null!=n.on_dirty&&n.on_dirty(n)}n.local_rotation=e,null!=this.on_rotate&&this.on_rotate(this.transform.local_rotation);e=t.scale_x;if(!(n=this.transform).dirty){n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(r=0,i=n.children;r<i.length;){o=i[r];++r,o.dirty=o.inverse_dirty=o.coordinates_dirty=!0;for(l=0,s=o.children;l<s.length;)s[l++].set_dirty(!0);null!=o.on_dirty&&o.on_dirty(o)}null!=n.on_dirty&&n.on_dirty(n)}n.local_scale_x=e;e=t.scale_y;if(!(n=this.transform).dirty){n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(r=0,i=n.children;r<i.length;){o=i[r];++r,o.dirty=o.inverse_dirty=o.coordinates_dirty=!0;for(l=0,s=o.children;l<s.length;)s[l++].set_dirty(!0);null!=o.on_dirty&&o.on_dirty(o)}null!=n.on_dirty&&n.on_dirty(n)}n.local_scale_y=e,this.kinematic=t.kinematic,(e=t.mass)<1e-4?(this.mass=this.inverse_mass=0,this.mass<=0&&null!=this.world&&(this.bounds(this.quadtree_data.bounds),this.world.static_quadtree.update(this.quadtree_data))):(this.mass<=0&&null!=this.world&&this.world.static_quadtree.remove(this.quadtree_data),this.mass=e,this.inverse_mass=1/this.mass),this.elasticity=t.elasticity;var _=this.velocity;if(_.x=t.velocity_x,_.y=t.velocity_y,this.rotational_velocity=t.rotational_velocity,(_=this.max_velocity).x=t.max_velocity_x,_.y=t.max_velocity_y,this.max_velocity_length=t.max_velocity_length,this.max_rotational_velocity=t.max_rotational_velocity,(_=this.drag).x=t.drag_x,_.y=t.drag_y,this.drag_length=t.drag_length,this.rotational_drag=t.rotational_drag,this.gravity_scale=t.gravity_scale,this.last_x=NaN,this.last_y=NaN,this.last_rotation=NaN,this.dirty=!0,null!=t.shape&&(a=G.get(t.shape),-1==this.shapes.indexOf(a)&&(this.shapes.push(a),a.set_parent(this),this.dirty=!0,this.mass<=0&&null!=this.world&&(this.bounds(this.quadtree_data.bounds),this.world.static_quadtree.update(this.quadtree_data)))),null!=t.shapes)for(r=0,i=t.shapes;r<i.length;){var a=G.get(i[r++]);-1==this.shapes.indexOf(a)&&(this.shapes.push(a),a.set_parent(this),this.dirty=!0,this.mass<=0&&null!=this.world&&(this.bounds(this.quadtree_data.bounds),this.world.static_quadtree.update(this.quadtree_data)))}if(null!=t.shape_instance&&(d=t.shape_instance,-1==this.shapes.indexOf(d)&&(this.shapes.push(d),d.set_parent(this),this.dirty=!0,this.mass<=0&&null!=this.world&&(this.bounds(this.quadtree_data.bounds),this.world.static_quadtree.update(this.quadtree_data)))),null!=t.shape_instances)for(r=0,i=t.shape_instances;r<i.length;){var d=i[r];++r,-1==this.shapes.indexOf(d)&&(this.shapes.push(d),d.set_parent(this),this.dirty=!0,this.mass<=0&&null!=this.world&&(this.bounds(this.quadtree_data.bounds),this.world.static_quadtree.update(this.quadtree_data)))}},set_position:function(t,r){null==r&&(r=0),null==t&&(t=0);var i=this.transform,e=t,n=null==r?0:r;if(null==t&&(e=0),!i.dirty){i.dirty=i.inverse_dirty=i.coordinates_dirty=!0;for(var o=0,l=i.children;o<l.length;){var s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(var _=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=i.on_dirty&&i.on_dirty(i)}if(i.local_x=e,!i.dirty){i.dirty=i.inverse_dirty=i.coordinates_dirty=!0;for(o=0,l=i.children;o<l.length;){s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=i.on_dirty&&i.on_dirty(i)}i.local_y=n},bounds:function(t){if(0==this.shapes.length){var r=this.transform.local_x;null==(o=this.transform.local_y)&&(o=0),null==r&&(r=0);var i=r,e=o;return null==e&&(e=0),null==i&&(i=0),(n=ui._pool.get()).min_x=i-.5,n.min_y=e-.5,n.max_x=i+.5,n.max_y=e+.5,n.pooled=!1,n}var n,o,l=this.shapes[0].bounds();if(1<this.shapes.length)for(var s=1,_=this.shapes.length;s<_;){var a=this.shapes[s++].bounds();l.min_x>a.min_x&&(l.min_x=a.min_x),l.min_y>a.min_y&&(l.min_y=a.min_y),l.max_x<a.max_x&&(l.max_x=a.max_x),l.max_y<a.max_y&&(l.max_y=a.max_y),a.put()}return null==t&&(o=r=0,(n=ui._pool.get()).min_x=r-.5,n.min_y=o-.5,n.max_x=r+.5,n.max_y=o+.5,n.pooled=!1,t=n),t.min_x=l.min_x,t.max_x=l.max_x,t.min_y=l.min_y,t.max_y=l.max_y,l.put(),t},dispose:function(){this.disposed=!0,null!=this.world&&this.world.remove(this),null!=this.quadtree_data&&null!=this.quadtree_data.bounds&&this.quadtree_data.bounds.put();for(var t=0,r=this.shapes;t<r.length;)r[t++].put();this.shapes=null,this.velocity=null,this.max_velocity=null,this.drag=null,this.data=null,this.on_move=null,this.on_rotate=null,this.quadtree_data=null},on_dirty:function(t){this.dirty=!0,this.mass<=0&&null!=this.world&&(this.bounds(this.quadtree_data.bounds),this.world.static_quadtree.update(this.quadtree_data))}};function H(){}H.__name__=!0,H.update_quadtree=function(t){for(var r=0,i=t.members;r<i.length;){var e=i[r];if(++r,!e.disposed){e.collided=!1;for(var n=0,o=e.shapes;n<o.length;)o[n++].collided=!1;e.active&&0<e.mass&&e.dirty&&0<e.shapes.length&&(null==e.quadtree_data.bounds?e.quadtree_data.bounds=e.bounds():e.bounds(e.quadtree_data.bounds),t.quadtree.update(e.quadtree_data,!1),e.dirty=!1)}}t.quadtree.shake()},H.query=function(t,r){H.update_quadtree(t);for(var i=null==r?t.listeners.members:r.members,e=0;e<i.length;){var n=i[e];++e,n.quadtree_results.length=0;var o=n.a;switch(o._hx_index){case 0:var l=o.v,s=n.b;switch(s._hx_index){case 0:var _=H.overlap_body_and_body_bounds(l,s.v);null!=_&&n.quadtree_results.push(_);break;case 1:H.overlap_body_and_bodies_bounds(l,s.v,t,n.quadtree_results)}break;case 1:var a=o.v,d=n.b;switch(d._hx_index){case 0:H.overlap_body_and_bodies_bounds(d.v,a,t,n.quadtree_results);break;case 1:var y=d.v;H.overlap_bodies_and_bodies_bounds(a,y,t,n.quadtree_results),a!=y&&H.overlap_bodies_and_bodies_bounds(y,a,t,n.quadtree_results)}}for(var c=0,h=n.last_collisions;c<h.length;)h[c++].put();n.last_collisions.length=n.collisions.length;for(var u=0,f=n.collisions.length;u<f;){var v=u++;n.last_collisions[v]=n.collisions[v]}for(var m=n.collisions.length=0,p=n.quadtree_results;m<p.length;){var g=p[m];if(++m,g.a.disposed||g.b.disposed)g.put();else if(g.a.id!=g.b.id){for(var x=!1,w=0,I=n.collisions;w<I.length;){var b=I[w];if(++w,b.a.id==g.a.id&&b.b.id==g.b.id||b.b.id==g.a.id&&b.a.id==g.b.id){x=!0;break}}if(x)g.put();else{if(1==g.a.shapes.length&&1==g.b.shapes.length){var P=g.a.shapes[0].collides(g.b.shapes[0]);null!=P&&g.data.push(P)}else for(var S=g.a.shapes,T=0,E=S.length;T<E;){for(var M=T++,O=g.b.shapes,X=S[M].bounds(),R=0,A=O.length;R<A;){var k,L=R++,F=O[L].bounds();X.min_x<F.max_x&&X.max_x>=F.min_x&&X.min_y<F.max_y&&X.max_y>=F.min_y&&(null!=(k=S[M].collides(O[L]))&&g.data.push(k)),F.put()}X.put()}if(0!=g.data.length)if(null==n.condition||n.condition(g.a,g.b,g.data)&&!g.a.disposed&&!g.b.disposed){for(var C=0,q=g.data;C<q.length;){var G=q[C];++C,G.sa.collided=G.sb.collided=!0}g.a.collided=g.b.collided=!0,n.collisions.push(g)}else g.put();else g.put()}}else g.put()}}},H.notify=function(t,r){for(var i=null==r?t.listeners.members:r.members,e=0;e<i.length;){var n=i[e];if(++e,null!=n.enter||null!=n.stay)for(var o=0,l=n.collisions;o<l.length;){var s,_=l[o];if(++o,!_.a.disposed&&!_.b.disposed){if(null!=n.enter){for(var a=!1,d=0,y=n.last_collisions;d<y.length;){var c=y[d];if(++d,c.a==_.a&&c.b==_.b||c.a==_.b&&c.b==_.a){a=!0;break}}s=!a}else s=!1;s?n.enter(_.a,_.b,_.data):null!=n.stay&&n.stay(_.a,_.b,_.data)}}if(null!=n.exit)for(var h=0,u=n.last_collisions;h<u.length;){var f,v=u[h];if(++h,v.a.disposed||v.b.disposed)f=!1;else{for(var m=!1,p=0,g=n.collisions;p<g.length;){var x=g[p];if(++p,x.a==v.a&&x.b==v.b||x.a==v.b&&x.b==v.a){m=!0;break}}f=!m}f&&n.exit(v.a,v.b)}}},H.overlap_bodies_and_bodies_bounds=function(t,r,i,e){if(0!=t.length&&0!=r.length)for(var n=0;n<t.length;)H.overlap_body_and_bodies_bounds(t[n++],r,i,e)},H.overlap_body_and_bodies_bounds=function(t,r,i,e){if(!(t.disposed||0==t.shapes.length||!t.active||t.mass<=0)){var n=t.bounds();H.qr.length=0,H.sqr.length=0,i.quadtree.query(n,H.qr),i.static_quadtree.query(n,H.sqr);for(var o=0;o<r.length;){var l=r[o];if(++o,!l.disposed&&0!=l.shapes.length&&l.active&&(0==t.layer_mask||0!=(t.layer_mask&1<<I.to_int(l.layers))))for(var s,_=0,a=0<l.mass?H.qr:H.sqr;_<a.length;){a[_++].id==l.id&&((s=x._pool.get()).a=t,s.b=l,s.data.length=0,s.pooled=!1,e.push(s))}}n.put()}},H.overlap_body_and_body_bounds=function(t,r){if(t.disposed||r.disposed||0==t.shapes.length||0==r.shapes.length||!t.active||!r.active||t==r||0!=t.layer_mask&&0==(t.layer_mask&1<<I.to_int(r.layers))||t.mass<=0&&r.mass<=0)return null;var i=t.bounds(),e=r.bounds(),n=i.min_x<e.max_x&&i.max_x>=e.min_x&&i.min_y<e.max_y&&i.max_y>=e.min_y;if(i.put(),e.put(),n){var o=x._pool.get();return o.a=t,o.b=r,o.data.length=0,o.pooled=!1,o}return null};function f(t){this.members=null==t?[]:t}f.__name__=!0,f.prototype={add:function(t,r,i){i=N.copy_fields(i,m.get_defaults());var e=new m(t,r,i.separate,[],[],null,null,null,null,[],i.percent_correction,i.correction_threshold);return null!=i.enter&&(e.enter=i.enter),null!=i.stay&&(e.stay=i.stay),null!=i.exit&&(e.exit=i.exit),null!=i.condition&&(e.condition=i.condition),this.members.push(e),e},clear:function(){this.members.length=0}};var hi=function(t,r){this.x=t,this.y=r};hi.__name__=!0;var W=t.echo.Echo=function(){};W.__name__=!0,W.start=function(t){return new p(t)},W.make=function(t,r){return t.add(new j(r))},W.listen=function(t,r,i,e){return null==r?null==i?t.listeners.add(k.Right(t.members),k.Right(t.members),e):t.listeners.add(i,i,e):null==i?t.listeners.add(r,r,e):t.listeners.add(r,i,e)},W.check=function(t,r,i,e){W.cached_listeners.clear(),null==r&&null==i?W.cached_listeners.add(k.Right(t.members),k.Right(t.members),e):null==r?W.cached_listeners.add(i,i,e):null==i?W.cached_listeners.add(r,r,e):W.cached_listeners.add(r,i,e),H.query(t,W.cached_listeners),ht.separate(t,W.cached_listeners),H.notify(t,W.cached_listeners)},W.step=function(t,r){if(null!=t.history){for(var i=t.history,e=[],n=0,o=t.members;n<o.length;){var l=o[n];++n,e.push(new g(l.id,l.transform.local_x,l.transform.local_y,l.transform.local_rotation,l.velocity,l.acceleration,l.rotational_velocity))}i.add(e)}for(var s=r/t.iterations,e=0,n=t.iterations;e<n;)++e,ht.step(t,s),H.query(t),ht.separate(t),H.notify(t)},W.linecast_floats=function(t,r,i,e,n,o){var l=t,s=r,_=i,a=null==e?1:e;null==i&&(_=1),null==r&&(s=0),null==t&&(l=0);var d=Wt._pool.get();null==(e=a)&&(e=1),null==(i=_)&&(i=1),null==(r=s)&&(r=0),null==(t=l)&&(t=0);var y=d.start;y.x=t,y.y=r,(y=d.end).x=i,y.y=e,d.pooled=!1;var c=W.linecast(d,n,o);return d.pooled||(d.pooled=!0,Wt._pool.put_unsafe(d)),c},W.linecast_vector=function(t,r,i,e,n){var o=Wt._pool.get();o.set_from_vector(t,r,i),o.pooled=!1;var l=W.linecast(o,e,n);return o.pooled||(o.pooled=!0,Wt._pool.put_unsafe(o)),l},W.linecast_vectors=function(t,r,i,e){var n=t.x,o=t.y,l=r.x,s=r.y;null==s&&(s=1),null==l&&(l=1),null==o&&(o=0),null==n&&(n=0);var _=Wt._pool.get(),a=n,d=o,y=l,c=s;null==c&&(c=1),null==y&&(y=1),null==d&&(d=0),null==a&&(a=0);var h=_.start;h.x=a,h.y=d,(h=_.end).x=y,h.y=c,_.pooled=!1;var u=W.linecast(_,i,e);return _.pooled||(_.pooled=!0,Wt._pool.put_unsafe(_)),u},W.linecast=function(t,r,i){var e=null,n=Math.min(t.start.x,t.end.x),o=Math.min(t.start.y,t.end.y),l=Math.max(t.start.x,t.end.x),s=Math.max(t.start.y,t.end.y),_=ui._pool.get();switch(_.min_x=n,_.max_x=l,_.min_y=o,_.max_y=s,_.pooled=!1,null!=i&&null==W.cached_body&&(W.cached_body=new j),(h=r)._hx_index){case 0:var a=(c=h.v).bounds();if(_.min_x<a.max_x&&_.max_x>=a.min_x&&_.min_y<a.max_y&&_.max_y>=a.min_y)for(var d=0,y=c.shapes.length;d<y;){null!=(D=c.shapes[d++].intersect(t))&&(null==e&&((A=B._pool.get()).line=t,A.body=c,A.data.length=0,A.pooled=!1,e=A),e.data.push(D))}a.put();break;case 1:var c=h.v;if(null==i)for(var h=0;h<c.length;){var u=c[h];if(++h,null!=u){a=u.bounds();if((A=B._pool.get()).line=t,A.body=u,A.data.length=0,A.pooled=!1,_.min_x<a.max_x&&_.max_x>=a.min_x&&_.min_y<a.max_y&&_.max_y>=a.min_y)for(d=0,y=u.shapes.length;d<y;){null!=(D=u.shapes[d++].intersect(t))&&A.data.push(D)}if(a.put(),0<A.data.length)if(null!=e){if(0==e.data.length)U=null;else if(1==e.data.length)U=e.data[0];else{for(var f=e.data[0],v=1,m=e.data.length;v<m;){var p=v++;null!=e.data[p]&&e.data[p].distance<f.distance&&(f=e.data[p])}U=f}var g=U.distance;if(0==A.data.length)z=null;else if(1==A.data.length)z=A.data[0];else{for(var x=A.data[0],w=1,I=A.data.length;w<I;){var b=w++;null!=A.data[b]&&A.data[b].distance<x.distance&&(x=A.data[b])}z=x}N=g>z.distance}else N=!0;else N=!1;N?(null!=e&&e.put(),e=A):A.put()}}else{for(h=0,d=W.cached_collisions;h<d.length;)d[h++].put();W.cached_collisions.length=0;var P=W.cached_body,n=_.min_x,o=_.min_y,l=_.max_x,s=_.max_y,S=K._pool.get(),T=.5*(n+l),E=.5*(o+s),M=l-n,O=s-o;if(null==O&&(O=0),null==M&&(M=1),null==E&&(E=0),null==T&&(T=0),!(q=S.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){var X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){var R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}if(q.local_x=T,!(q=S.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}if(q.local_y=E,S.ex=.5*M,null!=S.transformed_rect){(q=S.transformed_rect).count=4;for(h=0,d=q.count;h<d;){var A=h++;null==q.local_vertices[A]&&(q.local_vertices[A]=new hi(0,0))}(C=q.local_vertices[0]).x=-S.ex,C.y=-S.ey,(C=q.local_vertices[1]).x=S.ex,C.y=-S.ey,(C=q.local_vertices[2]).x=S.ex,C.y=S.ey,(C=q.local_vertices[3]).x=-S.ex,C.y=S.ey;var k=S.transform.local_x;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_x=k;k=S.transform.local_y;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_y=k;k=S.transform.local_rotation;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_rotation=k;k=S.transform.local_scale_x;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_x=k;k=S.transform.local_scale_y;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_y=k,q.dirty_vertices=!0,q.dirty_bounds=!0}if(S.ey=.5*(O<=0?M:O),null!=S.transformed_rect){(q=S.transformed_rect).count=4;for(h=0,d=q.count;h<d;){A=h++;null==q.local_vertices[A]&&(q.local_vertices[A]=new hi(0,0))}(C=q.local_vertices[0]).x=-S.ex,C.y=-S.ey,(C=q.local_vertices[1]).x=S.ex,C.y=-S.ey,(C=q.local_vertices[2]).x=S.ex,C.y=S.ey,(C=q.local_vertices[3]).x=-S.ex,C.y=S.ey;k=S.transform.local_x;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_x=k;k=S.transform.local_y;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_y=k;k=S.transform.local_rotation;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_rotation=k;k=S.transform.local_scale_x;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_x=k;var L,k=S.transform.local_scale_y;if(!(L=q.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(h=0,d=L.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_y=k,q.dirty_vertices=!0,q.dirty_bounds=!0}if(!(q=S.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}if(q.local_rotation=0,!(q=S.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}if(q.local_scale_x=1,!(q=S.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}if(q.local_scale_y=1,N=null==S.transformed_rect&&0!=(U=null==(q=S.transform).parent?q.local_rotation:(q.sync(),q._rotation))){var F=J._pool.get();F.count=4;for(var C,h=0,d=F.count;h<d;){A=h++;null==F.local_vertices[A]&&(F.local_vertices[A]=new hi(0,0))}(C=F.local_vertices[0]).x=-S.ex,C.y=-S.ey,(C=F.local_vertices[1]).x=S.ex,C.y=-S.ey,(C=F.local_vertices[2]).x=S.ex,C.y=S.ey,(C=F.local_vertices[3]).x=-S.ex,C.y=S.ey;k=S.transform.local_x;if(!(q=F.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_x=k;k=S.transform.local_y;if(!(q=F.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_y=k;k=S.transform.local_rotation;if(!(q=F.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_rotation=k;k=S.transform.local_scale_x;if(!(q=F.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_scale_x=k;k=S.transform.local_scale_y;if(!(q=F.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_scale_y=k,F.dirty_vertices=!0,F.dirty_bounds=!0,F.pooled=!1,S.transformed_rect=F,S.transformed_rect.set_parent(S.parent)}else if(null!=S.transformed_rect){k=S.transform.local_x;if(!(q=S.transformed_rect.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_x=k;k=S.transform.local_y;if(!(q=S.transformed_rect.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_y=k;k=S.transform.local_rotation;if(!(q=S.transformed_rect.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_rotation=k;k=S.transform.local_scale_x;if(!(q=S.transformed_rect.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_scale_x=k;var q,k=S.transform.local_scale_y;if(!(q=S.transformed_rect.transform).dirty){q.dirty=q.inverse_dirty=q.coordinates_dirty=!0;for(h=0,d=q.children;h<d.length;){X=d[h];++h,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(y=0,v=X.children;y<v.length;){R=v[y];++y,R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(m=0,w=R.children;m<w.length;)w[m++].set_dirty(!0);null!=R.on_dirty&&R.on_dirty(R)}null!=X.on_dirty&&X.on_dirty(X)}null!=q.on_dirty&&q.on_dirty(q)}q.local_scale_y=k}S.pooled=!1,null!=P.shapes[0]&&P.shapes[0].put(),P.shapes[0]=S,P.shapes[0].set_parent(P),P.dirty=!0,P.mass<=0&&null!=P.world&&(P.bounds(P.quadtree_data.bounds),P.world.static_quadtree.update(P.quadtree_data)),H.update_quadtree(i),H.overlap_body_and_bodies_bounds(W.cached_body,c,i,W.cached_collisions);for(h=0,c=W.cached_collisions;h<c.length;){var G=c[h];++h;u=G.b;(A=B._pool.get()).line=t,A.body=u,A.data.length=0,A.pooled=!1;for(var D,N,U,d=0,y=G.b.shapes.length;d<y;){null!=(D=G.b.shapes[d++].intersect(t))&&A.data.push(D)}if(0<A.data.length)if(null!=e){if(0==e.data.length)U=null;else if(1==e.data.length)U=e.data[0];else{for(f=e.data[0],v=1,m=e.data.length;v<m;){p=v++;null!=e.data[p]&&e.data[p].distance<f.distance&&(f=e.data[p])}U=f}var z,g=U.distance;if(0==A.data.length)z=null;else if(1==A.data.length)z=A.data[0];else{for(x=A.data[0],w=1,I=A.data.length;w<I;){b=w++;null!=A.data[b]&&A.data[b].distance<x.distance&&(x=A.data[b])}z=x}N=g>z.distance}else N=!0;else N=!1;N?(null!=e&&e.put(),e=A):A.put()}}}return _.put(),e},W.linecast_all=function(t,r,i){var e=[],n=Math.min(t.start.x,t.end.x),o=Math.min(t.start.y,t.end.y),l=Math.max(t.start.x,t.end.x),s=Math.max(t.start.y,t.end.y),_=ui._pool.get();switch(_.min_x=n,_.max_x=l,_.min_y=o,_.max_y=s,_.pooled=!1,null!=i&&null==W.cached_body&&(W.cached_body=new j),(h=r)._hx_index){case 0:var a=h.v;(T=B._pool.get()).line=t,T.body=a,T.data.length=0,T.pooled=!1;var d=a.bounds();if(_.min_x<d.max_x&&_.max_x>=d.min_x&&_.min_y<d.max_y&&_.max_y>=d.min_y)for(var y=0,c=a.shapes.length;y<c;){null!=(k=a.shapes[y++].intersect(t))&&T.data.push(k)}d.put(),0<T.data.length?e.push(T):T.put();break;case 1:a=h.v;if(null==i)for(var h=0;h<a.length;){var u=a[h];if(++h,null!=u){d=u.bounds();if((T=B._pool.get()).line=t,T.body=u,T.data.length=0,T.pooled=!1,_.min_x<d.max_x&&_.max_x>=d.min_x&&_.min_y<d.max_y&&_.max_y>=d.min_y)for(y=0,c=u.shapes.length;y<c;){null!=(k=u.shapes[y++].intersect(t))&&T.data.push(k)}d.put(),0<T.data.length?e.push(T):T.put()}}else{for(h=0,y=W.cached_collisions;h<y.length;)y[h++].put();W.cached_collisions.length=0;var f=W.cached_body,n=_.min_x,o=_.min_y,l=_.max_x,s=_.max_y,v=K._pool.get(),m=.5*(n+l),p=.5*(o+s),g=l-n,x=s-o;if(null==x&&(x=0),null==g&&(g=1),null==p&&(p=0),null==m&&(m=0),!(R=v.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){var w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(var c=0,I=w.children;c<I.length;){var b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(var P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}if(R.local_x=m,!(R=v.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}if(R.local_y=p,v.ex=.5*g,null!=v.transformed_rect){(R=v.transformed_rect).count=4;for(h=0,y=R.count;h<y;){var T=h++;null==R.local_vertices[T]&&(R.local_vertices[T]=new hi(0,0))}(X=R.local_vertices[0]).x=-v.ex,X.y=-v.ey,(X=R.local_vertices[1]).x=v.ex,X.y=-v.ey,(X=R.local_vertices[2]).x=v.ex,X.y=v.ey,(X=R.local_vertices[3]).x=-v.ex,X.y=v.ey;var E=v.transform.local_x;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_x=E;E=v.transform.local_y;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_y=E;E=v.transform.local_rotation;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_rotation=E;E=v.transform.local_scale_x;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_scale_x=E;E=v.transform.local_scale_y;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_scale_y=E,R.dirty_vertices=!0,R.dirty_bounds=!0}if(v.ey=.5*(x<=0?g:x),null!=v.transformed_rect){(R=v.transformed_rect).count=4;for(h=0,y=R.count;h<y;){T=h++;null==R.local_vertices[T]&&(R.local_vertices[T]=new hi(0,0))}(X=R.local_vertices[0]).x=-v.ex,X.y=-v.ey,(X=R.local_vertices[1]).x=v.ex,X.y=-v.ey,(X=R.local_vertices[2]).x=v.ex,X.y=v.ey,(X=R.local_vertices[3]).x=-v.ex,X.y=v.ey;E=v.transform.local_x;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_x=E;E=v.transform.local_y;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_y=E;E=v.transform.local_rotation;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_rotation=E;E=v.transform.local_scale_x;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_scale_x=E;var M,E=v.transform.local_scale_y;if(!(M=R.transform).dirty){M.dirty=M.inverse_dirty=M.coordinates_dirty=!0;for(h=0,y=M.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=M.on_dirty&&M.on_dirty(M)}M.local_scale_y=E,R.dirty_vertices=!0,R.dirty_bounds=!0}if(!(R=v.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}if(R.local_rotation=0,!(R=v.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}if(R.local_scale_x=1,!(R=v.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}if(R.local_scale_y=1,null==v.transformed_rect&&0!=(null==(R=v.transform).parent?R.local_rotation:(R.sync(),R._rotation))){var O=J._pool.get();O.count=4;for(var X,h=0,y=O.count;h<y;){T=h++;null==O.local_vertices[T]&&(O.local_vertices[T]=new hi(0,0))}(X=O.local_vertices[0]).x=-v.ex,X.y=-v.ey,(X=O.local_vertices[1]).x=v.ex,X.y=-v.ey,(X=O.local_vertices[2]).x=v.ex,X.y=v.ey,(X=O.local_vertices[3]).x=-v.ex,X.y=v.ey;E=v.transform.local_x;if(!(R=O.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_x=E;E=v.transform.local_y;if(!(R=O.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_y=E;E=v.transform.local_rotation;if(!(R=O.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_rotation=E;E=v.transform.local_scale_x;if(!(R=O.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_scale_x=E;E=v.transform.local_scale_y;if(!(R=O.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_scale_y=E,O.dirty_vertices=!0,O.dirty_bounds=!0,O.pooled=!1,v.transformed_rect=O,v.transformed_rect.set_parent(v.parent)}else if(null!=v.transformed_rect){E=v.transform.local_x;if(!(R=v.transformed_rect.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_x=E;E=v.transform.local_y;if(!(R=v.transformed_rect.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_y=E;E=v.transform.local_rotation;if(!(R=v.transformed_rect.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_rotation=E;E=v.transform.local_scale_x;if(!(R=v.transformed_rect.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_scale_x=E;var R,E=v.transform.local_scale_y;if(!(R=v.transformed_rect.transform).dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(h=0,y=R.children;h<y.length;){w=y[h];++h,w.dirty=w.inverse_dirty=w.coordinates_dirty=!0;for(c=0,I=w.children;c<I.length;){b=I[c];++c,b.dirty=b.inverse_dirty=b.coordinates_dirty=!0;for(P=0,S=b.children;P<S.length;)S[P++].set_dirty(!0);null!=b.on_dirty&&b.on_dirty(b)}null!=w.on_dirty&&w.on_dirty(w)}null!=R.on_dirty&&R.on_dirty(R)}R.local_scale_y=E}v.pooled=!1,null!=f.shapes[0]&&f.shapes[0].put(),f.shapes[0]=v,f.shapes[0].set_parent(f),f.dirty=!0,f.mass<=0&&null!=f.world&&(f.bounds(f.quadtree_data.bounds),f.world.static_quadtree.update(f.quadtree_data)),H.update_quadtree(i),H.overlap_body_and_bodies_bounds(W.cached_body,a,i,W.cached_collisions);for(h=0,a=W.cached_collisions;h<a.length;){var A=a[h];++h;u=A.b;(T=B._pool.get()).line=t,T.body=u,T.data.length=0,T.pooled=!1;for(var k,y=0,c=A.b.shapes.length;y<c;){null!=(k=A.b.shapes[y++].intersect(t))&&T.data.push(k)}0<T.data.length?e.push(T):T.put()}}}return _.put(),e},W.undo=function(t){if(null!=t.history){var r=t.history.undo();if(null!=r){for(var i=0;i<r.length;){var e=r[i];++i;for(var n=0,o=t.members;n<o.length;){var l=o[n];if(++n,e.id==l.id){var s=e.x,_=l.transform;if(!_.dirty){_.dirty=_.inverse_dirty=_.coordinates_dirty=!0;for(var a=0,d=_.children;a<d.length;){var y=d[a];++a,y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(var c=0,h=y.children;c<h.length;)h[c++].set_dirty(!0);null!=y.on_dirty&&y.on_dirty(y)}null!=_.on_dirty&&_.on_dirty(_)}_.local_x=s,null!=l.on_move&&l.on_move(l.transform.local_x,l.transform.local_y);var u=e.y,f=l.transform;if(!f.dirty){f.dirty=f.inverse_dirty=f.coordinates_dirty=!0;for(var v=0,m=f.children;v<m.length;){var p=m[v];++v,p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(var g=0,x=p.children;g<x.length;)x[g++].set_dirty(!0);null!=p.on_dirty&&p.on_dirty(p)}null!=f.on_dirty&&f.on_dirty(f)}f.local_y=u,null!=l.on_move&&l.on_move(l.transform.local_x,l.transform.local_y);var w=e.rotation,I=l.transform;if(!I.dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(var b=0,P=I.children;b<P.length;){var S=P[b];++b,S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(var T=0,E=S.children;T<E.length;)E[T++].set_dirty(!0);null!=S.on_dirty&&S.on_dirty(S)}null!=I.on_dirty&&I.on_dirty(I)}I.local_rotation=w,null!=l.on_rotate&&l.on_rotate(l.transform.local_rotation),l.velocity=e.velocity}}}t.reset_quadtrees()}}return t},W.redo=function(t){if(null!=t.history){var r=t.history.redo();if(null!=r)for(var i=0;i<r.length;){var e=r[i];++i;for(var n=0,o=t.members;n<o.length;){var l=o[n];if(++n,e.id==l.id){var s=e.x,_=l.transform;if(!_.dirty){_.dirty=_.inverse_dirty=_.coordinates_dirty=!0;for(var a=0,d=_.children;a<d.length;){var y=d[a];++a,y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(var c=0,h=y.children;c<h.length;)h[c++].set_dirty(!0);null!=y.on_dirty&&y.on_dirty(y)}null!=_.on_dirty&&_.on_dirty(_)}_.local_x=s,null!=l.on_move&&l.on_move(l.transform.local_x,l.transform.local_y);var u=e.y,f=l.transform;if(!f.dirty){f.dirty=f.inverse_dirty=f.coordinates_dirty=!0;for(var v=0,m=f.children;v<m.length;){var p=m[v];++v,p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(var g=0,x=p.children;g<x.length;)x[g++].set_dirty(!0);null!=p.on_dirty&&p.on_dirty(p)}null!=f.on_dirty&&f.on_dirty(f)}f.local_y=u,null!=l.on_move&&l.on_move(l.transform.local_x,l.transform.local_y);var w=e.rotation,I=l.transform;if(!I.dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(var b=0,P=I.children;b<P.length;){var S=P[b];++b,S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(var T=0,E=S.children;T<E.length;)E[T++].set_dirty(!0);null!=S.on_dirty&&S.on_dirty(S)}null!=I.on_dirty&&I.on_dirty(I)}I.local_rotation=w,null!=l.on_rotate&&l.on_rotate(l.transform.local_rotation),l.velocity=e.velocity,l.acceleration=e.acceleration,l.rotational_velocity=e.rotational_velocity}}}t.reset_quadtrees()}return t};function v(t){this.type=t,this.pool=[],this.count=0}v.__name__=!0,v.prototype={get:function(){return 0==this.count?a.createInstance(this.type,[]):this.pool[--this.count]},put_unsafe:function(t){null!=t&&(this.pool[this.count++]=t)}};var Wt=function(t,r,i,e){null==e&&(e=1),null==i&&(i=1),null==r&&(r=0),null==t&&(t=0),this.start=new hi(t,r),this.end=new hi(i,e)};Wt.__name__=!0,Wt.prototype={set_from_vector:function(t,r,i){var e=Math.PI/180*r,n=t.x+i*Math.cos(e),o=t.y+i*Math.sin(e),l=t.x,s=t.y,_=n,a=null==o?1:o;null==n&&(_=1),null==s&&(s=0),null==l&&(l=0);var d=this.start;return d.x=l,d.y=s,(d=this.end).x=_,d.y=a,this},get_x:function(){return this.start.x},get_y:function(){return this.start.y},get_dx:function(){return this.end.x},get_dy:function(){return this.end.y},__properties__:{get_dy:"get_dy",get_dx:"get_dx",get_y:"get_y",get_x:"get_x"}};var m=function(t,r,i,e,n,o,l,s,_,a,d,y){this.a=t,this.b=r,this.separate=i,this.collisions=e,this.last_collisions=n,this.enter=o,this.stay=l,this.exit=s,this.condition=_,this.quadtree_results=a,this.percent_correction=d,this.correction_threshold=y};m.__name__=!0,m.__properties__={get_defaults:"get_defaults"},m.get_defaults=function(){return{separate:!0,percent_correction:.9,correction_threshold:.013}};var ht=function(){};ht.__name__=!0,ht.step=function(t,r){for(var i=0,e=t.members;i<e.length;){var n=e[i];if(++i,0<n.mass&&!n.disposed&&n.active){n.last_x=n.transform.local_x,n.last_y=n.transform.local_y,n.last_rotation=n.transform.local_rotation;var o=n.acceleration.x,l=n.acceleration.y;n.kinematic||(o+=t.gravity.x*n.gravity_scale,l+=t.gravity.y*n.gravity_scale);var s,_=n.velocity.x,a=n.drag.x,d=n.max_velocity.x;Math.abs(o)<=1e-5?Math.abs(a)<=1e-5||(0<_-(a*=r)?_-=a:_+a<0?_+=a:_=0):_+=o*r,Math.abs(d)<=1e-5||(_<(s=-d)?_=s:d<_&&(_=d)),n.velocity.x=_;var y,c,h,u,f,v,m,p,g,x,w,I=n.velocity.y,b=n.drag.y,P=n.max_velocity.y;Math.abs(l)<=1e-5?Math.abs(b)<=1e-5||(0<I-(b*=r)?I-=b:I+b<0?I+=b:I=0):I+=l*r,Math.abs(P)<=1e-5||(I<(y=-P)?I=y:P<I&&(I=P)),n.velocity.y=I,0<n.drag_length&&(c=n.acceleration,h=ht.zero,null==c&&null==h||null!=c&&null!=h&&c.x==h.x&&c.y==h.y)&&n.velocity!=ht.zero&&(u=n.velocity,f=Math.sqrt(u.x*u.x+u.y*u.y)-n.drag_length*r,v=n.velocity,0<(m=Math.sqrt(v.x*v.x+v.y*v.y))&&(v.x/=m,v.y/=m),v.x*=f,v.y*=f),0<n.max_velocity_length&&(p=n.velocity,Math.sqrt(p.x*p.x+p.y*p.y)>n.max_velocity_length)&&(g=n.max_velocity_length,x=n.velocity,0<(w=Math.sqrt(x.x*x.x+x.y*x.y))&&(x.x/=w,x.y/=w),x.x*=g,x.y*=g);var S=n.transform.local_x+n.velocity.x*n.inverse_mass*r,T=n.transform;if(!T.dirty){T.dirty=T.inverse_dirty=T.coordinates_dirty=!0;for(var E=0,M=T.children;E<M.length;){var O=M[E];++E,O.dirty=O.inverse_dirty=O.coordinates_dirty=!0;for(var X=0,R=O.children;X<R.length;){var A=R[X];++X,A.dirty=A.inverse_dirty=A.coordinates_dirty=!0;for(var k=0,L=A.children;k<L.length;){var F=L[k];++k,F.dirty=F.inverse_dirty=F.coordinates_dirty=!0;for(var C=0,q=F.children;C<q.length;)q[C++].set_dirty(!0);null!=F.on_dirty&&F.on_dirty(F)}null!=A.on_dirty&&A.on_dirty(A)}null!=O.on_dirty&&O.on_dirty(O)}null!=T.on_dirty&&T.on_dirty(T)}T.local_x=S,null!=n.on_move&&n.on_move(n.transform.local_x,n.transform.local_y);var G,D,N,U=n.transform.local_y+n.velocity.y*n.inverse_mass*r,z=n.transform;if(!z.dirty){z.dirty=z.inverse_dirty=z.coordinates_dirty=!0;for(var j=0,H=z.children;j<H.length;){var W=H[j];++j,W.dirty=W.inverse_dirty=W.coordinates_dirty=!0;for(var B=0,J=W.children;B<J.length;){var K=J[B];++B,K.dirty=K.inverse_dirty=K.coordinates_dirty=!0;for(var Y=0,V=K.children;Y<V.length;){var Z=V[Y];++Y,Z.dirty=Z.inverse_dirty=Z.coordinates_dirty=!0;for(var $=0,Q=Z.children;$<Q.length;)Q[$++].set_dirty(!0);null!=Z.on_dirty&&Z.on_dirty(Z)}null!=K.on_dirty&&K.on_dirty(K)}null!=W.on_dirty&&W.on_dirty(W)}null!=z.on_dirty&&z.on_dirty(z)}z.local_y=U,null!=n.on_move&&n.on_move(n.transform.local_x,n.transform.local_y),0<n.max_rotational_velocity&&(G=n.rotational_velocity,D=-n.max_rotational_velocity,N=n.max_rotational_velocity,n.rotational_velocity=G<D?D:N<G?N:G),0<n.rotational_drag&&(0<n.rotational_velocity?(n.rotational_velocity-=n.rotational_drag*r,n.rotational_velocity<0&&(n.rotational_velocity=0)):(n.rotational_velocity+=n.rotational_drag*r,0<n.rotational_velocity&&(n.rotational_velocity=0)));var tt=n.transform.local_rotation+n.rotational_velocity*r,rt=n.transform;if(!rt.dirty){rt.dirty=rt.inverse_dirty=rt.coordinates_dirty=!0;for(var it=0,et=rt.children;it<et.length;){var nt=et[it];++it,nt.dirty=nt.inverse_dirty=nt.coordinates_dirty=!0;for(var ot=0,lt=nt.children;ot<lt.length;){var st=lt[ot];++ot,st.dirty=st.inverse_dirty=st.coordinates_dirty=!0;for(var _t=0,at=st.children;_t<at.length;){var dt=at[_t];++_t,dt.dirty=dt.inverse_dirty=dt.coordinates_dirty=!0;for(var yt=0,ct=dt.children;yt<ct.length;)ct[yt++].set_dirty(!0);null!=dt.on_dirty&&dt.on_dirty(dt)}null!=st.on_dirty&&st.on_dirty(st)}null!=nt.on_dirty&&nt.on_dirty(nt)}null!=rt.on_dirty&&rt.on_dirty(rt)}rt.local_rotation=tt,null!=n.on_rotate&&n.on_rotate(n.transform.local_rotation)}}},ht.separate=function(t,r){for(var i=null==r?t.listeners.members:r.members,e=0;e<i.length;){var n=i[e];if(++e,n.separate)for(var o=0,l=n.collisions;o<l.length;){var s=l[o];++o;for(var _=0,a=s.data.length;_<a;){var d=s.a,y=s.b,c=s.data[_++],h=n.correction_threshold,u=n.percent_correction;if(null==u&&(u=.9),null==h&&(h=.013),c.sa.solid&&c.sb.solid&&d.active&&y.active&&!d.disposed&&!y.disposed&&!(d.mass<=0&&y.mass<=0)){var f,v,m,p=(d.velocity.x-y.velocity.x)*c.normal.x+(d.velocity.y-y.velocity.y)*c.normal.y,g=d.inverse_mass+y.inverse_mass;0<p&&(v=-(f=-(1+.5*(d.elasticity+y.elasticity))*p/g)*c.normal.x,m=-f*c.normal.y,d.kinematic||(d.velocity.x-=v*d.inverse_mass,d.velocity.y-=m*d.inverse_mass),y.kinematic||(y.velocity.x+=v*y.inverse_mass,y.velocity.y+=m*y.inverse_mass));var x=Math.max(c.overlap-h,0)/g*u,w=x*c.normal.x,I=x*c.normal.y;if(!d.kinematic){var b=d.transform.local_x-d.inverse_mass*w,P=d.transform;if(!P.dirty){P.dirty=P.inverse_dirty=P.coordinates_dirty=!0;for(var S=0,T=P.children;S<T.length;){var E=T[S];++S,E.dirty=E.inverse_dirty=E.coordinates_dirty=!0;for(var M=0,O=E.children;M<O.length;)O[M++].set_dirty(!0);null!=E.on_dirty&&E.on_dirty(E)}null!=P.on_dirty&&P.on_dirty(P)}P.local_x=b,null!=d.on_move&&d.on_move(d.transform.local_x,d.transform.local_y);var X=d.transform.local_y-d.inverse_mass*I,R=d.transform;if(!R.dirty){R.dirty=R.inverse_dirty=R.coordinates_dirty=!0;for(var A=0,k=R.children;A<k.length;){var L=k[A];++A,L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(var F=0,C=L.children;F<C.length;)C[F++].set_dirty(!0);null!=L.on_dirty&&L.on_dirty(L)}null!=R.on_dirty&&R.on_dirty(R)}R.local_y=X,null!=d.on_move&&d.on_move(d.transform.local_x,d.transform.local_y)}if(!y.kinematic){var q=y.transform.local_x+y.inverse_mass*w,G=y.transform;if(!G.dirty){G.dirty=G.inverse_dirty=G.coordinates_dirty=!0;for(var D=0,N=G.children;D<N.length;){var U=N[D];++D,U.dirty=U.inverse_dirty=U.coordinates_dirty=!0;for(var z=0,j=U.children;z<j.length;)j[z++].set_dirty(!0);null!=U.on_dirty&&U.on_dirty(U)}null!=G.on_dirty&&G.on_dirty(G)}G.local_x=q,null!=y.on_move&&y.on_move(y.transform.local_x,y.transform.local_y);var H=y.transform.local_y+y.inverse_mass*I,W=y.transform;if(!W.dirty){W.dirty=W.inverse_dirty=W.coordinates_dirty=!0;for(var B=0,J=W.children;B<J.length;){var K=J[B];++B,K.dirty=K.inverse_dirty=K.coordinates_dirty=!0;for(var Y=0,V=K.children;Y<V.length;)V[Y++].set_dirty(!0);null!=K.on_dirty&&K.on_dirty(K)}null!=W.on_dirty&&W.on_dirty(W)}W.local_y=H,null!=y.on_move&&y.on_move(y.transform.local_x,y.transform.local_y)}}}}}};var G=function(t,r,i){null==i&&(i=0),null==r&&(r=0),null==t&&(t=0),this.solid=!0,this.transform=new O;var e=this.transform;if(!e.dirty){e.dirty=e.inverse_dirty=e.coordinates_dirty=!0;for(var n=0,o=e.children;n<o.length;){var l=o[n];++n,l.dirty=l.inverse_dirty=l.coordinates_dirty=!0;for(var s=0,_=l.children;s<_.length;)_[s++].set_dirty(!0);null!=l.on_dirty&&l.on_dirty(l)}null!=e.on_dirty&&e.on_dirty(e)}if(e.local_x=t,!(e=this.transform).dirty){e.dirty=e.inverse_dirty=e.coordinates_dirty=!0;for(n=0,o=e.children;n<o.length;){l=o[n];++n,l.dirty=l.inverse_dirty=l.coordinates_dirty=!0;for(s=0,_=l.children;s<_.length;)_[s++].set_dirty(!0);null!=l.on_dirty&&l.on_dirty(l)}null!=e.on_dirty&&e.on_dirty(e)}if(e.local_y=r,!(e=this.transform).dirty){e.dirty=e.inverse_dirty=e.coordinates_dirty=!0;for(n=0,o=e.children;n<o.length;){l=o[n];++n,l.dirty=l.inverse_dirty=l.coordinates_dirty=!0;for(s=0,_=l.children;s<_.length;)_[s++].set_dirty(!0);null!=l.on_dirty&&l.on_dirty(l)}null!=e.on_dirty&&e.on_dirty(e)}e.local_rotation=i};G.__name__=!0,G.__properties__={get_defaults:"get_defaults"},G.get=function(t){var r;switch((t=N.copy_fields(t,G.get_defaults())).type){case 0:var i=t.offset_x,e=t.offset_y,n=t.width,o=t.height,l=t.rotation,s=t.scale_x;null==(T=t.scale_y)&&(T=1),null==s&&(s=1),null==l&&(l=0),null==o&&(o=0),null==n&&(n=1),null==e&&(e=0),null==i&&(i=0);var _=K._pool.get(),a=n,d=o;if(null==(k=T)&&(k=1),null==(A=s)&&(A=1),null==(R=l)&&(R=0),null==d&&(d=0),null==a&&(a=1),null==(X=e)&&(X=0),null==(O=i)&&(O=0),!(L=_.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(var y=0,c=L.children;y<c.length;){var h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(var u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_x=O,!(L=_.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_y=X,_.ex=.5*a,null!=_.transformed_rect){(L=_.transformed_rect).count=4;for(y=0,c=L.count;y<c;){var v=y++;null==L.local_vertices[v]&&(L.local_vertices[v]=new hi(0,0))}(g=L.local_vertices[0]).x=-_.ex,g.y=-_.ey,(g=L.local_vertices[1]).x=_.ex,g.y=-_.ey,(g=L.local_vertices[2]).x=_.ex,g.y=_.ey,(g=L.local_vertices[3]).x=-_.ex,g.y=_.ey;var m=_.transform.local_x;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_x=m;m=_.transform.local_y;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_y=m;m=_.transform.local_rotation;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_rotation=m;m=_.transform.local_scale_x;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_x=m;m=_.transform.local_scale_y;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=m,L.dirty_vertices=!0,L.dirty_bounds=!0}if(_.ey=.5*(d<=0?a:d),null!=_.transformed_rect){(L=_.transformed_rect).count=4;for(y=0,c=L.count;y<c;){v=y++;null==L.local_vertices[v]&&(L.local_vertices[v]=new hi(0,0))}(g=L.local_vertices[0]).x=-_.ex,g.y=-_.ey,(g=L.local_vertices[1]).x=_.ex,g.y=-_.ey,(g=L.local_vertices[2]).x=_.ex,g.y=_.ey,(g=L.local_vertices[3]).x=-_.ex,g.y=_.ey;m=_.transform.local_x;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_x=m;m=_.transform.local_y;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_y=m;m=_.transform.local_rotation;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_rotation=m;m=_.transform.local_scale_x;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_x=m;var p,m=_.transform.local_scale_y;if(!(p=L.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=m,L.dirty_vertices=!0,L.dirty_bounds=!0}if(!(L=_.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_rotation=R,!(L=_.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_scale_x=A,!(L=_.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_scale_y=k,w=null==_.transformed_rect&&0!=(null==(L=_.transform).parent?L.local_rotation:(L.sync(),L._rotation))){(F=J._pool.get()).count=4;for(var g,y=0,c=F.count;y<c;){v=y++;null==F.local_vertices[v]&&(F.local_vertices[v]=new hi(0,0))}(g=F.local_vertices[0]).x=-_.ex,g.y=-_.ey,(g=F.local_vertices[1]).x=_.ex,g.y=-_.ey,(g=F.local_vertices[2]).x=_.ex,g.y=_.ey,(g=F.local_vertices[3]).x=-_.ex,g.y=_.ey;m=_.transform.local_x;if(!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_x=m;m=_.transform.local_y;if(!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_y=m;m=_.transform.local_rotation;if(!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_rotation=m;m=_.transform.local_scale_x;if(!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_x=m;m=_.transform.local_scale_y;if(!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_y=m,F.dirty_vertices=!0,F.dirty_bounds=!0,F.pooled=!1,_.transformed_rect=F,_.transformed_rect.set_parent(_.parent)}else if(null!=_.transformed_rect){m=_.transform.local_x;if(!(L=_.transformed_rect.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_x=m;m=_.transform.local_y;if(!(L=_.transformed_rect.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_y=m;m=_.transform.local_rotation;if(!(L=_.transformed_rect.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_rotation=m;m=_.transform.local_scale_x;if(!(L=_.transformed_rect.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_x=m;m=_.transform.local_scale_y;if(!(L=_.transformed_rect.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_y=m}_.pooled=!1,r=_;break;case 1:var i=t.offset_x,e=t.offset_y,x=t.radius,l=t.rotation,s=t.scale_x;null==(T=t.scale_y)&&(T=1),null==s&&(s=1),null==l&&(l=0),null==x&&(x=1),null==e&&(e=0),null==i&&(i=0);var w,I=D._pool.get(),b=x;if(null==(k=T)&&(k=1),null==(A=s)&&(A=1),null==(R=l)&&(R=0),null==b&&(b=1),null==(X=e)&&(X=0),null==(O=i)&&(O=0),!(L=I.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_x=O,!(L=I.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_y=X,!(L=I.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_rotation=R,!(L=I.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_scale_x=A,!(L=I.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_y=k,w=null==(L=I.transform).parent?L.local_scale_x:(L.sync(),L._scale_x),I.local_radius=b/w,I.pooled=!1,r=I;break;case 2:if(null!=t.vertices){var i=t.offset_x,e=t.offset_y,l=t.rotation,P=t.vertices,s=t.scale_x;if(null==(T=t.scale_y)&&(T=1),null==s&&(s=1),null==l&&(l=0),null==e&&(e=0),null==i&&(i=0),null==(k=T)&&(k=1),null==(A=s)&&(A=1),null==(R=l)&&(R=0),null==(X=e)&&(X=0),null==(O=i)&&(O=0),!(L=(F=J._pool.get()).transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_x=O,!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_y=X,!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_rotation=R,!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_scale_x=A,!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_y=k;var S=null;if(F.local_vertices=null==P?[]:P,F.count=F.local_vertices.length,S>F.local_vertices.length)for(y=F.local_vertices.length;y<S;)F.local_vertices[y++]=new hi(0,0);F.dirty_vertices=!0,F.dirty_bounds=!0,F.pooled=!1,r=F}else{var T,i=t.offset_x,e=t.offset_y,E=t.sides,x=t.radius,l=t.rotation,s=t.scale_x;if(null==(T=t.scale_y)&&(T=1),null==s&&(s=1),null==l&&(l=0),null==x&&(x=1),null==E&&(E=3),null==e&&(e=0),null==i&&(i=0),E<3)throw U.thrown("Polygons require 3 sides as a minimum");for(var M,O,X,R,A,k,L,F=J._pool.get(),C=2*Math.PI/E,q=[],y=0,c=E;y<c;)M=y++*C+.5*(Math.PI-C),q.push(new hi(Math.cos(M)*x,Math.sin(M)*x));if(null==(k=T)&&(k=1),null==(A=s)&&(A=1),null==(R=l)&&(R=0),null==(X=e)&&(X=0),null==(O=i)&&(O=0),!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_x=O,!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_y=X,!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_rotation=R,!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}if(L.local_scale_x=A,!(L=F.transform).dirty){L.dirty=L.inverse_dirty=L.coordinates_dirty=!0;for(y=0,c=L.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=L.on_dirty&&L.on_dirty(L)}L.local_scale_y=k;S=null;if(F.local_vertices=null==q?[]:q,F.count=F.local_vertices.length,S>F.local_vertices.length)for(y=F.local_vertices.length;y<S;)F.local_vertices[y++]=new hi(0,0);F.dirty_vertices=!0,F.dirty_bounds=!0,F.pooled=!1,r=F}}return r.solid=t.solid,r},G.get_defaults=function(){return{type:0,radius:1,width:1,height:0,sides:3,rotation:0,scale_x:1,scale_y:1,offset_x:0,offset_y:0,solid:!0}},G.prototype={put:function(){this.transform.set_parent(null),this.parent=null,this.collided=!1},set_parent:function(t){this.parent!=t&&(this.parent=t,this.transform.set_parent(null==t?null:t.transform))},bounds:function(t){if(null!=t)return r=null==(i=this.transform).parent?i.local_x:(i.sync(),i._x),null==(e=null==(i=this.transform).parent?i.local_y:(i.sync(),i._y))&&(e=0),null==r&&(r=0),t.min_x=r,t.min_y=e,t.max_x=r,t.max_y=e,t;var r,i,e;r=null==(i=this.transform).parent?i.local_x:(i.sync(),i._x),null==(e=null==(i=this.transform).parent?i.local_y:(i.sync(),i._y))&&(e=0),null==r&&(r=0);var n=ui._pool.get(),o=r,l=e;return null==l&&(l=0),null==o&&(o=0),n.min_x=o,n.min_y=l,n.max_x=o,n.max_y=l,n.pooled=!1,n},intersect:function(t){return null},collides:function(t){return null},collide_rect:function(t){return null},collide_circle:function(t){return null},collide_polygon:function(t){return null}};var p=function(t){var r;if(this.members=null==t.members?[]:t.members,this.init=!1,t.width<1)throw U.thrown("World must have a width of at least 1");if(r=t.width,this.width=r,this.init&&this.reset_quadtrees(),t.height<1)throw U.thrown("World must have a width of at least 1");r=t.height,this.height=r,this.init&&this.reset_quadtrees(),this.x=null==t.x?0:t.x,this.init&&this.reset_quadtrees(),this.y=null==t.y?0:t.y,this.init&&this.reset_quadtrees(),this.gravity=new hi(null==t.gravity_x?0:t.gravity_x,null==t.gravity_y?0:t.gravity_y),this.reset_quadtrees(),this.listeners=new f(t.listeners),this.iterations=null==t.iterations?5:t.iterations,null!=t.history&&(this.history=new b(t.history))};p.__name__=!0,p.prototype={add:function(t){return t.world==this||(null!=t.world&&(null!=t.world&&t.world.remove(t),null!=t.quadtree_data&&null!=t.quadtree_data.bounds&&t.quadtree_data.bounds.put()),t.world=this,t.dirty=!0,this.members.push(t),t.quadtree_data=new w(t.id,t.bounds(),!1),t.mass<=0?this.static_quadtree.insert(t.quadtree_data):this.quadtree.insert(t.quadtree_data)),t},remove:function(t){return this.quadtree.remove(t.quadtree_data),this.static_quadtree.remove(t.quadtree_data),s.remove(this.members,t),t.world=null,t},clear:function(){for(;0<this.members.length;){var t=this.members.pop();null!=t&&(null!=t.world&&t.world.remove(t),null!=t.quadtree_data&&null!=t.quadtree_data.bounds&&t.quadtree_data.bounds.put())}this.reset_quadtrees(),this.listeners.clear()},reset_quadtrees:function(){if((this.init=!0,null!=this.quadtree)&&!(x=this.quadtree).pooled){x.pooled=!0;for(var t=0,r=x.children.length;t<r;){var i=t++;null!=x.children[i]&&(x.children[i].clear_children(),(m=x.children[i]).pooled||(m.pooled=!0,m.clear_children(),m.contents.length=0,m.contents_count=0,m.nodes_list.length=0,C._pool.put_unsafe(m)),x.children[i]=null)}x.contents.length=0,x.contents_count=0,x.nodes_list.length=0,C._pool.put_unsafe(x)}var e=C._pool.get(),n=0,o=0;e.min_x=n-.5,e.min_y=o-.5,e.max_x=n+.5,e.max_y=o+.5;for(t=0,r=e.children.length;t<r;){i=t++;null!=e.children[i]&&(e.children[i].clear_children(),(x=e.children[i]).pooled||(x.pooled=!0,x.clear_children(),x.contents.length=0,x.contents_count=0,x.nodes_list.length=0,C._pool.put_unsafe(x)),e.children[i]=null)}if((e.contents.length=0,e.contents_count=0,e.pooled=!1,this.quadtree=e,null!=this.static_quadtree)&&!(x=this.static_quadtree).pooled){x.pooled=!0;for(t=0,r=x.children.length;t<r;){i=t++;null!=x.children[i]&&(x.children[i].clear_children(),(m=x.children[i]).pooled||(m.pooled=!0,m.clear_children(),m.contents.length=0,m.contents_count=0,m.nodes_list.length=0,C._pool.put_unsafe(m)),x.children[i]=null)}x.contents.length=0,x.contents_count=0,x.nodes_list.length=0,C._pool.put_unsafe(x)}n=0,o=0;(e=C._pool.get()).min_x=n-.5,e.min_y=o-.5,e.max_x=n+.5,e.max_y=o+.5;for(t=0,r=e.children.length;t<r;){i=t++;null!=e.children[i]&&(e.children[i].clear_children(),(x=e.children[i]).pooled||(x.pooled=!0,x.clear_children(),x.contents.length=0,x.contents_count=0,x.nodes_list.length=0,C._pool.put_unsafe(x)),e.children[i]=null)}e.contents.length=0,e.contents_count=0,e.pooled=!1,this.static_quadtree=e;var n=this.x+.5*this.width,o=this.y+.5*this.height,l=this.width,s=this.height;null==s&&(s=0),null==l&&(l=1),null==o&&(o=0),null==n&&(n=0);var _=K._pool.get(),a=n,d=o,y=l,c=s;if(null==c&&(c=0),null==y&&(y=1),null==d&&(d=0),null==a&&(a=0),!(x=_.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){var h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(var u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}if(x.local_x=a,!(x=_.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}if(x.local_y=d,_.ex=.5*y,null!=_.transformed_rect){(x=_.transformed_rect).count=4;for(t=0,r=x.count;t<r;){i=t++;null==x.local_vertices[i]&&(x.local_vertices[i]=new hi(0,0))}(g=x.local_vertices[0]).x=-_.ex,g.y=-_.ey,(g=x.local_vertices[1]).x=_.ex,g.y=-_.ey,(g=x.local_vertices[2]).x=_.ex,g.y=_.ey,(g=x.local_vertices[3]).x=-_.ex,g.y=_.ey;var v=_.transform.local_x;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_x=v;v=_.transform.local_y;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_y=v;v=_.transform.local_rotation;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_rotation=v;v=_.transform.local_scale_x;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_scale_x=v;v=_.transform.local_scale_y;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_scale_y=v,x.dirty_vertices=!0,x.dirty_bounds=!0}if(_.ey=.5*(c<=0?y:c),null!=_.transformed_rect){(x=_.transformed_rect).count=4;for(t=0,r=x.count;t<r;){i=t++;null==x.local_vertices[i]&&(x.local_vertices[i]=new hi(0,0))}(g=x.local_vertices[0]).x=-_.ex,g.y=-_.ey,(g=x.local_vertices[1]).x=_.ex,g.y=-_.ey,(g=x.local_vertices[2]).x=_.ex,g.y=_.ey,(g=x.local_vertices[3]).x=-_.ex,g.y=_.ey;v=_.transform.local_x;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_x=v;v=_.transform.local_y;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_y=v;v=_.transform.local_rotation;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_rotation=v;v=_.transform.local_scale_x;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_scale_x=v;var m,v=_.transform.local_scale_y;if(!(m=x.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(t=0,r=m.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=m.on_dirty&&m.on_dirty(m)}m.local_scale_y=v,x.dirty_vertices=!0,x.dirty_bounds=!0}if(!(x=_.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}if(x.local_rotation=0,!(x=_.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}if(x.local_scale_x=1,!(x=_.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}if(x.local_scale_y=1,w=null==_.transformed_rect&&0!=(null==(x=_.transform).parent?x.local_rotation:(x.sync(),x._rotation))){var p=J._pool.get();p.count=4;for(var g,t=0,r=p.count;t<r;){i=t++;null==p.local_vertices[i]&&(p.local_vertices[i]=new hi(0,0))}(g=p.local_vertices[0]).x=-_.ex,g.y=-_.ey,(g=p.local_vertices[1]).x=_.ex,g.y=-_.ey,(g=p.local_vertices[2]).x=_.ex,g.y=_.ey,(g=p.local_vertices[3]).x=-_.ex,g.y=_.ey;v=_.transform.local_x;if(!(x=p.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_x=v;v=_.transform.local_y;if(!(x=p.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_y=v;v=_.transform.local_rotation;if(!(x=p.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_rotation=v;v=_.transform.local_scale_x;if(!(x=p.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_scale_x=v;v=_.transform.local_scale_y;if(!(x=p.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_scale_y=v,p.dirty_vertices=!0,p.dirty_bounds=!0,p.pooled=!1,_.transformed_rect=p,_.transformed_rect.set_parent(_.parent)}else if(null!=_.transformed_rect){v=_.transform.local_x;if(!(x=_.transformed_rect.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_x=v;v=_.transform.local_y;if(!(x=_.transformed_rect.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_y=v;v=_.transform.local_rotation;if(!(x=_.transformed_rect.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_rotation=v;v=_.transform.local_scale_x;if(!(x=_.transformed_rect.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_scale_x=v;v=_.transform.local_scale_y;if(!(x=_.transformed_rect.transform).dirty){x.dirty=x.inverse_dirty=x.coordinates_dirty=!0;for(t=0,r=x.children;t<r.length;){h=r[t];++t,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=x.on_dirty&&x.on_dirty(x)}x.local_scale_y=v}_.pooled=!1;var x,w=_.to_aabb(!0);(x=this.quadtree).min_x=w.min_x,x.max_x=w.max_x,x.min_y=w.min_y,x.max_y=w.max_y,(x=this.static_quadtree).min_x=w.min_x,x.max_x=w.max_x,x.min_y=w.min_y,x.max_y=w.max_y;for(t=0,r=this.members;t<r.length;){var I=r[t];++t,0<I.mass?I.dirty=!0:(I.bounds(I.quadtree_data.bounds),this.static_quadtree.update(I.quadtree_data))}}};var g=function(t,r,i,e,n,o,l){this.id=t,this.x=r,this.y=i,this.rotation=e,this.velocity=new hi(n.x,n.y),this.acceleration=new hi(n.x,n.y),this.rotational_velocity=l};g.__name__=!0;var x=function(){this.data=[]};x.__name__=!0,x.prototype={put:function(){if(!this.pooled){for(var t=0,r=this.data;t<r.length;)r[t++].put();this.pooled=!0,x._pool.put_unsafe(this)}}};function Ur(){this.normal=new hi(0,0)}Ur.__name__=!0,Ur.prototype={put:function(){this.pooled||(this.pooled=!0,Ur._pool.put_unsafe(this))}};var B=function(){this.data=[]};B.__name__=!0,B.prototype={put:function(){if(!this.pooled){for(var t=0,r=this.data;t<r.length;)r[t++].put();this.pooled=!0,B._pool.put_unsafe(this)}}};function Bt(){this.hit=new hi(0,0),this.normal=new hi(0,0)}Bt.__name__=!0,Bt.prototype={put:function(){this.pooled||(this.pooled=!0,Bt._pool.put_unsafe(this))}};var w=function(t,r,i){this.flag=!1,this.id=t,this.bounds=r,null!=i&&(this.flag=i)};w.__name__=!0;var D=function(){G.call(this),this.type=1;var t=this.transform,r=null==t.parent?t.local_scale_x:(t.sync(),t._scale_x);this.local_radius=0/r};D.__name__=!0,D.get=function(t,r,i,e,n,o){null==o&&(o=1),null==n&&(n=1),null==e&&(e=0),null==i&&(i=1),null==r&&(r=0),null==t&&(t=0);var l=D._pool.get(),s=t,_=r,a=i,d=e,y=n,c=null==o?1:o;null==n&&(y=1),null==e&&(d=0),null==i&&(a=1),null==r&&(_=0),null==t&&(s=0);var h=l.transform;if(!h.dirty){h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(var u=0,f=h.children;u<f.length;){var v=f[u];++u,v.dirty=v.inverse_dirty=v.coordinates_dirty=!0;for(var m=0,p=v.children;m<p.length;)p[m++].set_dirty(!0);null!=v.on_dirty&&v.on_dirty(v)}null!=h.on_dirty&&h.on_dirty(h)}if(h.local_x=s,!(h=l.transform).dirty){h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;){v=f[u];++u,v.dirty=v.inverse_dirty=v.coordinates_dirty=!0;for(m=0,p=v.children;m<p.length;)p[m++].set_dirty(!0);null!=v.on_dirty&&v.on_dirty(v)}null!=h.on_dirty&&h.on_dirty(h)}if(h.local_y=_,!(h=l.transform).dirty){h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;){v=f[u];++u,v.dirty=v.inverse_dirty=v.coordinates_dirty=!0;for(m=0,p=v.children;m<p.length;)p[m++].set_dirty(!0);null!=v.on_dirty&&v.on_dirty(v)}null!=h.on_dirty&&h.on_dirty(h)}if(h.local_rotation=d,!(h=l.transform).dirty){h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;){v=f[u];++u,v.dirty=v.inverse_dirty=v.coordinates_dirty=!0;for(m=0,p=v.children;m<p.length;)p[m++].set_dirty(!0);null!=v.on_dirty&&v.on_dirty(v)}null!=h.on_dirty&&h.on_dirty(h)}if(h.local_scale_x=y,!(h=l.transform).dirty){h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;){v=f[u];++u,v.dirty=v.inverse_dirty=v.coordinates_dirty=!0;for(m=0,p=v.children;m<p.length;)p[m++].set_dirty(!0);null!=v.on_dirty&&v.on_dirty(v)}null!=h.on_dirty&&h.on_dirty(h)}h.local_scale_y=c;var g=null==(h=l.transform).parent?h.local_scale_x:(h.sync(),h._scale_x);return l.local_radius=a/g,l.pooled=!1,l},D.__super__=G,D.prototype=e(G.prototype,{put:function(){G.prototype.put.call(this),this.pooled||(this.pooled=!0,D._pool.put_unsafe(this))},bounds:function(t){var r,i,e=this.local_radius,n=this.transform,o=null==n.parent?n.local_scale_x:(n.sync(),n._scale_x),l=e*o*2;if(null==t){r=null==(n=this.transform).parent?n.local_x:(n.sync(),n._x);var s=l,_=null==l?1:l;null==l&&(s=1),null==(i=null==(n=this.transform).parent?n.local_y:(n.sync(),n._y))&&(i=0),null==r&&(r=0);var a=ui._pool.get(),d=r,y=i,c=s,h=_;return null==h&&(h=1),null==c&&(c=1),null==y&&(y=0),null==d&&(d=0),c*=.5,h*=.5,a.min_x=d-c,a.min_y=y-h,a.max_x=d+c,a.max_y=y+h,a.pooled=!1,a}r=null==(n=this.transform).parent?n.local_x:(n.sync(),n._x);s=l,_=null==l?1:l;return null==l&&(s=1),null==(i=null==(n=this.transform).parent?n.local_y:(n.sync(),n._y))&&(i=0),null==r&&(r=0),s*=.5,_*=.5,t.min_x=r-s,t.min_y=i-_,t.max_x=r+s,t.max_y=i+_,t},intersect:function(t){return ar.line_intersects_circle(t,this)},collides:function(t){return t.collide_circle(this)},collide_rect:function(t){return ar.rect_and_circle(t,this,!0)},collide_circle:function(t){return ar.circle_and_circle(t,this)},collide_polygon:function(t){return ar.circle_and_polygon(this,t,!0)}});var J=function(t){this.sync_pos=new hi(0,0),G.call(this),this.type=2,this._vertices=[],this._normals=[];var r=ui._pool.get();r.min_x=-.5,r.min_y=-.5,r.max_x=.5,r.max_y=.5,r.pooled=!1,this._bounds=r,this.transform.on_dirty=tr(this,this.on_dirty);var i=null;if(this.local_vertices=null==t?[]:t,this.count=this.local_vertices.length,i>this.local_vertices.length)for(var e=this.local_vertices.length;e<i;)this.local_vertices[e++]=new hi(0,0);this.dirty_vertices=!0,this.dirty_bounds=!0};J.__name__=!0,J.get=function(t,r,i,e,n,o,l){if(null==l&&(l=1),null==o&&(o=1),null==n&&(n=0),null==e&&(e=1),null==i&&(i=3),null==r&&(r=0),null==t&&(t=0),i<3)throw U.thrown("Polygons require 3 sides as a minimum");for(var s,_=J._pool.get(),a=2*Math.PI/i,d=[],y=0;y<i;)s=y++*a+.5*(Math.PI-a),d.push(new hi(Math.cos(s)*e,Math.sin(s)*e));var c=t,h=r,u=n,f=o,v=null==l?1:l;null==o&&(f=1),null==n&&(u=0),null==r&&(h=0),null==t&&(c=0);var m=_.transform;if(!m.dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(var y=0,p=m.children;y<p.length;){var g=p[y];++y,g.dirty=g.inverse_dirty=g.coordinates_dirty=!0;for(var x=0,w=g.children;x<w.length;)w[x++].set_dirty(!0);null!=g.on_dirty&&g.on_dirty(g)}null!=m.on_dirty&&m.on_dirty(m)}if(m.local_x=c,!(m=_.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(y=0,p=m.children;y<p.length;){g=p[y];++y,g.dirty=g.inverse_dirty=g.coordinates_dirty=!0;for(x=0,w=g.children;x<w.length;)w[x++].set_dirty(!0);null!=g.on_dirty&&g.on_dirty(g)}null!=m.on_dirty&&m.on_dirty(m)}if(m.local_y=h,!(m=_.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(y=0,p=m.children;y<p.length;){g=p[y];++y,g.dirty=g.inverse_dirty=g.coordinates_dirty=!0;for(x=0,w=g.children;x<w.length;)w[x++].set_dirty(!0);null!=g.on_dirty&&g.on_dirty(g)}null!=m.on_dirty&&m.on_dirty(m)}if(m.local_rotation=u,!(m=_.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(y=0,p=m.children;y<p.length;){g=p[y];++y,g.dirty=g.inverse_dirty=g.coordinates_dirty=!0;for(x=0,w=g.children;x<w.length;)w[x++].set_dirty(!0);null!=g.on_dirty&&g.on_dirty(g)}null!=m.on_dirty&&m.on_dirty(m)}if(m.local_scale_x=f,!(m=_.transform).dirty){m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(y=0,p=m.children;y<p.length;){g=p[y];++y,g.dirty=g.inverse_dirty=g.coordinates_dirty=!0;for(x=0,w=g.children;x<w.length;)w[x++].set_dirty(!0);null!=g.on_dirty&&g.on_dirty(g)}null!=m.on_dirty&&m.on_dirty(m)}m.local_scale_y=v;var I=null;if(_.local_vertices=null==d?[]:d,_.count=_.local_vertices.length,I>_.local_vertices.length)for(y=_.local_vertices.length;y<I;)_.local_vertices[y++]=new hi(0,0);return _.dirty_vertices=!0,_.dirty_bounds=!0,_.pooled=!1,_},J.__super__=G,J.prototype=e(G.prototype,{put:function(){G.prototype.put.call(this),this.pooled||(this.pooled=!0,J._pool.put_unsafe(this))},bounds:function(t){if(this.dirty_bounds){if(this.dirty_bounds=!1,this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var r=0,i=this.count;r<i;){var e=r++;null!=this.local_vertices[e]&&(null==this._vertices[e]&&(this._vertices[e]=new hi(0,0)),u=this.local_vertices[e].x,null==(f=this.local_vertices[e].y)&&(f=0),null==u&&(u=0),l=this.transform.get_local_to_world_matrix(),v=u,m=f,p=1,(o=this._vertices[e]).x=l.m00*v+l.m10*m+l.m20*p,o.y=l.m01*v+l.m11*m+l.m21*p)}for(r=0,i=this.count;r<i;){var e=r++,n=this.sync_pos,o=this._vertices[(e+1)%this.count];n.x=o.x,n.y=o.y;var l=this._vertices[e];(b=this.sync_pos).x-=l.x,b.y-=l.y,null==this._normals[e]?this._normals[e]=new hi(-this.sync_pos.y,this.sync_pos.x):(f=this.sync_pos.x,(P=this._normals[e]).x=-this.sync_pos.y,P.y=f);var s=this._normals[e];0<(E=Math.sqrt(s.x*s.x+s.y*s.y))&&(s.x/=E,s.y/=E)}}var _=this._vertices[0].x;if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(r=0,i=this.count;r<i;){e=r++;null!=this.local_vertices[e]&&(null==this._vertices[e]&&(this._vertices[e]=new hi(0,0)),u=this.local_vertices[e].x,null==(f=this.local_vertices[e].y)&&(f=0),null==u&&(u=0),l=this.transform.get_local_to_world_matrix(),v=u,m=f,p=1,(o=this._vertices[e]).x=l.m00*v+l.m10*m+l.m20*p,o.y=l.m01*v+l.m11*m+l.m21*p)}for(r=0,i=this.count;r<i;){e=r++,n=this.sync_pos,o=this._vertices[(e+1)%this.count];n.x=o.x,n.y=o.y;l=this._vertices[e];(b=this.sync_pos).x-=l.x,b.y-=l.y,null==this._normals[e]?this._normals[e]=new hi(-this.sync_pos.y,this.sync_pos.x):(f=this.sync_pos.x,(P=this._normals[e]).x=-this.sync_pos.y,P.y=f);s=this._normals[e];0<(E=Math.sqrt(s.x*s.x+s.y*s.y))&&(s.x/=E,s.y/=E)}}var a=this._vertices[0].y;if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(r=0,i=this.count;r<i;){e=r++;null!=this.local_vertices[e]&&(null==this._vertices[e]&&(this._vertices[e]=new hi(0,0)),u=this.local_vertices[e].x,null==(f=this.local_vertices[e].y)&&(f=0),null==u&&(u=0),l=this.transform.get_local_to_world_matrix(),v=u,m=f,p=1,(o=this._vertices[e]).x=l.m00*v+l.m10*m+l.m20*p,o.y=l.m01*v+l.m11*m+l.m21*p)}for(r=0,i=this.count;r<i;){e=r++,n=this.sync_pos,o=this._vertices[(e+1)%this.count];n.x=o.x,n.y=o.y;l=this._vertices[e];(b=this.sync_pos).x-=l.x,b.y-=l.y,null==this._normals[e]?this._normals[e]=new hi(-this.sync_pos.y,this.sync_pos.x):(f=this.sync_pos.x,(P=this._normals[e]).x=-this.sync_pos.y,P.y=f);s=this._normals[e];0<(E=Math.sqrt(s.x*s.x+s.y*s.y))&&(s.x/=E,s.y/=E)}}var d=this._vertices[0].x;if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(r=0,i=this.count;r<i;){e=r++;null!=this.local_vertices[e]&&(null==this._vertices[e]&&(this._vertices[e]=new hi(0,0)),u=this.local_vertices[e].x,null==(f=this.local_vertices[e].y)&&(f=0),null==u&&(u=0),l=this.transform.get_local_to_world_matrix(),v=u,m=f,p=1,(o=this._vertices[e]).x=l.m00*v+l.m10*m+l.m20*p,o.y=l.m01*v+l.m11*m+l.m21*p)}for(r=0,i=this.count;r<i;){e=r++,n=this.sync_pos,o=this._vertices[(e+1)%this.count];n.x=o.x,n.y=o.y;l=this._vertices[e];(b=this.sync_pos).x-=l.x,b.y-=l.y,null==this._normals[e]?this._normals[e]=new hi(-this.sync_pos.y,this.sync_pos.x):(f=this.sync_pos.x,(P=this._normals[e]).x=-this.sync_pos.y,P.y=f);s=this._normals[e];0<(E=Math.sqrt(s.x*s.x+s.y*s.y))&&(s.x/=E,s.y/=E)}}for(var y=this._vertices[0].y,r=1,i=this.count;r<i;){e=r++;if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var c=0,h=this.count;c<h;){var u,f,v,m,p,g=c++;null!=this.local_vertices[g]&&(null==this._vertices[g]&&(this._vertices[g]=new hi(0,0)),u=this.local_vertices[g].x,null==(f=this.local_vertices[g].y)&&(f=0),null==u&&(u=0),l=this.transform.get_local_to_world_matrix(),v=u,m=f,p=1,(o=this._vertices[g]).x=l.m00*v+l.m10*m+l.m20*p,o.y=l.m01*v+l.m11*m+l.m21*p)}for(var x=0,w=this.count;x<w;){var I=x++,n=this.sync_pos,b=this._vertices[(1+I)%this.count];n.x=b.x,n.y=b.y;var P,S,T=this._vertices[I];(P=this.sync_pos).x-=T.x,P.y-=T.y,null==this._normals[I]?this._normals[I]=new hi(-this.sync_pos.y,this.sync_pos.x):(S=this.sync_pos.x,(s=this._normals[I]).x=-this.sync_pos.y,s.y=S);var E,M=this._normals[I];0<(E=Math.sqrt(M.x*M.x+M.y*M.y))&&(M.x/=E,M.y/=E)}}if(this._vertices[e].x<_){if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var O=0,X=this.count;O<X;){var R,A,k,L,F,C,q=O++;null!=this.local_vertices[q]&&(null==this._vertices[q]&&(this._vertices[q]=new hi(0,0)),R=this.local_vertices[q].x,null==(A=this.local_vertices[q].y)&&(A=0),null==R&&(R=0),k=this.transform.get_local_to_world_matrix(),L=R,F=A,(C=this._vertices[q]).x=k.m00*L+k.m10*F+ +k.m20,C.y=k.m01*L+k.m11*F+ +k.m21)}for(var G=0,D=this.count;G<D;){var N=G++,U=this.sync_pos,z=this._vertices[(1+N)%this.count];U.x=z.x,U.y=z.y;var j,H,W=this._vertices[N],B=this.sync_pos;B.x-=W.x,B.y-=W.y,null==this._normals[N]?this._normals[N]=new hi(-this.sync_pos.y,this.sync_pos.x):(j=this.sync_pos.x,(H=this._normals[N]).x=-this.sync_pos.y,H.y=j);var J=this._normals[N],K=Math.sqrt(J.x*J.x+J.y*J.y);0<K&&(J.x/=K,J.y/=K)}}_=this._vertices[e].x}if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var Y=0,V=this.count;Y<V;){var Z,$,Q,tt,rt,it,et=Y++;null!=this.local_vertices[et]&&(null==this._vertices[et]&&(this._vertices[et]=new hi(0,0)),Z=this.local_vertices[et].x,null==($=this.local_vertices[et].y)&&($=0),null==Z&&(Z=0),Q=this.transform.get_local_to_world_matrix(),tt=Z,rt=$,(it=this._vertices[et]).x=Q.m00*tt+Q.m10*rt+ +Q.m20,it.y=Q.m01*tt+Q.m11*rt+ +Q.m21)}for(var nt=0,ot=this.count;nt<ot;){var lt=nt++,st=this.sync_pos,_t=this._vertices[(1+lt)%this.count];st.x=_t.x,st.y=_t.y;var at,dt,yt=this._vertices[lt],ct=this.sync_pos;ct.x-=yt.x,ct.y-=yt.y,null==this._normals[lt]?this._normals[lt]=new hi(-this.sync_pos.y,this.sync_pos.x):(at=this.sync_pos.x,(dt=this._normals[lt]).x=-this.sync_pos.y,dt.y=at);var ht=this._normals[lt],ut=Math.sqrt(ht.x*ht.x+ht.y*ht.y);0<ut&&(ht.x/=ut,ht.y/=ut)}}if(this._vertices[e].y<a){if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var ft=0,vt=this.count;ft<vt;){var mt,pt,gt,xt,wt,It,bt=ft++;null!=this.local_vertices[bt]&&(null==this._vertices[bt]&&(this._vertices[bt]=new hi(0,0)),mt=this.local_vertices[bt].x,null==(pt=this.local_vertices[bt].y)&&(pt=0),null==mt&&(mt=0),gt=this.transform.get_local_to_world_matrix(),xt=mt,wt=pt,(It=this._vertices[bt]).x=gt.m00*xt+gt.m10*wt+ +gt.m20,It.y=gt.m01*xt+gt.m11*wt+ +gt.m21)}for(var Pt=0,St=this.count;Pt<St;){var Tt=Pt++,Et=this.sync_pos,Mt=this._vertices[(1+Tt)%this.count];Et.x=Mt.x,Et.y=Mt.y;var Ot,Xt,Rt=this._vertices[Tt],At=this.sync_pos;At.x-=Rt.x,At.y-=Rt.y,null==this._normals[Tt]?this._normals[Tt]=new hi(-this.sync_pos.y,this.sync_pos.x):(Ot=this.sync_pos.x,(Xt=this._normals[Tt]).x=-this.sync_pos.y,Xt.y=Ot);var kt=this._normals[Tt],Lt=Math.sqrt(kt.x*kt.x+kt.y*kt.y);0<Lt&&(kt.x/=Lt,kt.y/=Lt)}}a=this._vertices[e].y}if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var Ft=0,Ct=this.count;Ft<Ct;){var qt,Gt,Dt,Nt,Ut,zt,jt=Ft++;null!=this.local_vertices[jt]&&(null==this._vertices[jt]&&(this._vertices[jt]=new hi(0,0)),qt=this.local_vertices[jt].x,null==(Gt=this.local_vertices[jt].y)&&(Gt=0),null==qt&&(qt=0),Dt=this.transform.get_local_to_world_matrix(),Nt=qt,Ut=Gt,(zt=this._vertices[jt]).x=Dt.m00*Nt+Dt.m10*Ut+ +Dt.m20,zt.y=Dt.m01*Nt+Dt.m11*Ut+ +Dt.m21)}for(var Ht=0,Wt=this.count;Ht<Wt;){var Bt=Ht++,Jt=this.sync_pos,Kt=this._vertices[(1+Bt)%this.count];Jt.x=Kt.x,Jt.y=Kt.y;var Yt,Vt,Zt=this._vertices[Bt],$t=this.sync_pos;$t.x-=Zt.x,$t.y-=Zt.y,null==this._normals[Bt]?this._normals[Bt]=new hi(-this.sync_pos.y,this.sync_pos.x):(Yt=this.sync_pos.x,(Vt=this._normals[Bt]).x=-this.sync_pos.y,Vt.y=Yt);var Qt=this._normals[Bt],tr=Math.sqrt(Qt.x*Qt.x+Qt.y*Qt.y);0<tr&&(Qt.x/=tr,Qt.y/=tr)}}if(this._vertices[e].x>d){if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var rr=0,ir=this.count;rr<ir;){var er,nr,or,lr,sr,_r,ar=rr++;null!=this.local_vertices[ar]&&(null==this._vertices[ar]&&(this._vertices[ar]=new hi(0,0)),er=this.local_vertices[ar].x,null==(nr=this.local_vertices[ar].y)&&(nr=0),null==er&&(er=0),or=this.transform.get_local_to_world_matrix(),lr=er,sr=nr,(_r=this._vertices[ar]).x=or.m00*lr+or.m10*sr+ +or.m20,_r.y=or.m01*lr+or.m11*sr+ +or.m21)}for(var dr=0,yr=this.count;dr<yr;){var cr=dr++,hr=this.sync_pos,ur=this._vertices[(1+cr)%this.count];hr.x=ur.x,hr.y=ur.y;var fr,vr,mr=this._vertices[cr],pr=this.sync_pos;pr.x-=mr.x,pr.y-=mr.y,null==this._normals[cr]?this._normals[cr]=new hi(-this.sync_pos.y,this.sync_pos.x):(fr=this.sync_pos.x,(vr=this._normals[cr]).x=-this.sync_pos.y,vr.y=fr);var gr=this._normals[cr],xr=Math.sqrt(gr.x*gr.x+gr.y*gr.y);0<xr&&(gr.x/=xr,gr.y/=xr)}}d=this._vertices[e].x}if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var wr=0,Ir=this.count;wr<Ir;){var br,Pr,Sr,Tr,Er,Mr,Or=wr++;null!=this.local_vertices[Or]&&(null==this._vertices[Or]&&(this._vertices[Or]=new hi(0,0)),br=this.local_vertices[Or].x,null==(Pr=this.local_vertices[Or].y)&&(Pr=0),null==br&&(br=0),Sr=this.transform.get_local_to_world_matrix(),Tr=br,Er=Pr,(Mr=this._vertices[Or]).x=Sr.m00*Tr+Sr.m10*Er+ +Sr.m20,Mr.y=Sr.m01*Tr+Sr.m11*Er+ +Sr.m21)}for(var Xr=0,Rr=this.count;Xr<Rr;){var Ar=Xr++,kr=this.sync_pos,Lr=this._vertices[(1+Ar)%this.count];kr.x=Lr.x,kr.y=Lr.y;var Fr,Cr,qr=this._vertices[Ar],Gr=this.sync_pos;Gr.x-=qr.x,Gr.y-=qr.y,null==this._normals[Ar]?this._normals[Ar]=new hi(-this.sync_pos.y,this.sync_pos.x):(Fr=this.sync_pos.x,(Cr=this._normals[Ar]).x=-this.sync_pos.y,Cr.y=Fr);var Dr=this._normals[Ar],Nr=Math.sqrt(Dr.x*Dr.x+Dr.y*Dr.y);0<Nr&&(Dr.x/=Nr,Dr.y/=Nr)}}if(this._vertices[e].y>y){if(this.dirty_vertices){for(this.dirty_vertices=!1;this._vertices.length>this.count;)this._vertices.pop();for(var Ur=0,zr=this.count;Ur<zr;){var jr,Hr,Wr,Br,Jr,Kr,Yr=Ur++;null!=this.local_vertices[Yr]&&(null==this._vertices[Yr]&&(this._vertices[Yr]=new hi(0,0)),jr=this.local_vertices[Yr].x,null==(Hr=this.local_vertices[Yr].y)&&(Hr=0),null==jr&&(jr=0),Wr=this.transform.get_local_to_world_matrix(),Br=jr,Jr=Hr,(Kr=this._vertices[Yr]).x=Wr.m00*Br+Wr.m10*Jr+ +Wr.m20,Kr.y=Wr.m01*Br+Wr.m11*Jr+ +Wr.m21)}for(var Vr=0,Zr=this.count;Vr<Zr;){var $r=Vr++,Qr=this.sync_pos,ti=this._vertices[(1+$r)%this.count];Qr.x=ti.x,Qr.y=ti.y;var ri,ii,ei=this._vertices[$r],ni=this.sync_pos;ni.x-=ei.x,ni.y-=ei.y,null==this._normals[$r]?this._normals[$r]=new hi(-this.sync_pos.y,this.sync_pos.x):(ri=this.sync_pos.x,(ii=this._normals[$r]).x=-this.sync_pos.y,ii.y=ri);var oi=this._normals[$r],li=Math.sqrt(oi.x*oi.x+oi.y*oi.y);0<li&&(oi.x/=li,oi.y/=li)}}y=this._vertices[e].y}}(si=this._bounds).min_x=_,si.max_x=d,si.min_y=a,si.max_y=y}if(null==t){var si,_i=(si=this._bounds).min_x,ai=si.min_y,di=si.max_x,yi=si.max_y;return(ci=ui._pool.get()).min_x=_i,ci.max_x=di,ci.min_y=ai,ci.max_y=yi,ci.pooled=!1,ci}var ci=this._bounds;return t.min_x=ci.min_x,t.max_x=ci.max_x,t.min_y=ci.min_y,t.max_y=ci.max_y,t},intersect:function(t){return ar.line_intersects_polygon(t,this)},collides:function(t){return t.collide_polygon(this)},collide_rect:function(t){return ar.rect_and_polygon(t,this,!0)},collide_circle:function(t){return ar.circle_and_polygon(t,this)},collide_polygon:function(t){return ar.polygon_and_polygon(t,this,!0)},on_dirty:function(t){this.dirty_vertices=!0,this.dirty_bounds=!0}});var K=function(){if(G.call(this),this.ex=0,null!=this.transformed_rect){(s=this.transformed_rect).count=4;for(var t=0,r=s.count;t<r;){var i=t++;null==s.local_vertices[i]&&(s.local_vertices[i]=new hi(0,0))}(_=s.local_vertices[0]).x=-this.ex,_.y=-this.ey,(_=s.local_vertices[1]).x=this.ex,_.y=-this.ey,(_=s.local_vertices[2]).x=this.ex,_.y=this.ey,(_=s.local_vertices[3]).x=-this.ex,_.y=this.ey;var e=this.transform.local_x;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){var n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(var o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_x=e;e=this.transform.local_y;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_y=e;e=this.transform.local_rotation;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_rotation=e;e=this.transform.local_scale_x;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_scale_x=e;e=this.transform.local_scale_y;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_scale_y=e,s.dirty_vertices=!0,s.dirty_bounds=!0}if(this.ey=0,null!=this.transformed_rect){var s;(s=this.transformed_rect).count=4;for(var _,t=0,r=s.count;t<r;){i=t++;null==s.local_vertices[i]&&(s.local_vertices[i]=new hi(0,0))}(_=s.local_vertices[0]).x=-this.ex,_.y=-this.ey,(_=s.local_vertices[1]).x=this.ex,_.y=-this.ey,(_=s.local_vertices[2]).x=this.ex,_.y=this.ey,(_=s.local_vertices[3]).x=-this.ex,_.y=this.ey;e=this.transform.local_x;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_x=e;e=this.transform.local_y;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_y=e;e=this.transform.local_rotation;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_rotation=e;e=this.transform.local_scale_x;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_scale_x=e;var a,e=this.transform.local_scale_y;if(!(a=s.transform).dirty){a.dirty=a.inverse_dirty=a.coordinates_dirty=!0;for(t=0,r=a.children;t<r.length;){n=r[t];++t,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=a.on_dirty&&a.on_dirty(a)}a.local_scale_y=e,s.dirty_vertices=!0,s.dirty_bounds=!0}this.type=0,this.transform.on_dirty=tr(this,this.on_dirty)};K.__name__=!0,K.get=function(t,r,i,e,n,o,l){null==l&&(l=1),null==o&&(o=1),null==n&&(n=0),null==e&&(e=0),null==i&&(i=1),null==r&&(r=0),null==t&&(t=0);var s=K._pool.get(),_=t,a=r,d=i,y=e,c=n,h=o,u=null==l?1:l;if(null==o&&(h=1),null==n&&(c=0),null==e&&(y=0),null==i&&(d=1),null==r&&(a=0),null==t&&(_=0),!(S=s.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(var f=0,v=S.children;f<v.length;){var m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(var p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}if(S.local_x=_,!(S=s.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}if(S.local_y=a,s.ex=.5*d,null!=s.transformed_rect){(S=s.transformed_rect).count=4;for(f=0,v=S.count;f<v;){var x=f++;null==S.local_vertices[x]&&(S.local_vertices[x]=new hi(0,0))}(P=S.local_vertices[0]).x=-s.ex,P.y=-s.ey,(P=S.local_vertices[1]).x=s.ex,P.y=-s.ey,(P=S.local_vertices[2]).x=s.ex,P.y=s.ey,(P=S.local_vertices[3]).x=-s.ex,P.y=s.ey;var w=s.transform.local_x;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_x=w;w=s.transform.local_y;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_y=w;w=s.transform.local_rotation;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_rotation=w;w=s.transform.local_scale_x;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_scale_x=w;w=s.transform.local_scale_y;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_scale_y=w,S.dirty_vertices=!0,S.dirty_bounds=!0}if(s.ey=.5*(y<=0?d:y),null!=s.transformed_rect){(S=s.transformed_rect).count=4;for(f=0,v=S.count;f<v;){x=f++;null==S.local_vertices[x]&&(S.local_vertices[x]=new hi(0,0))}(P=S.local_vertices[0]).x=-s.ex,P.y=-s.ey,(P=S.local_vertices[1]).x=s.ex,P.y=-s.ey,(P=S.local_vertices[2]).x=s.ex,P.y=s.ey,(P=S.local_vertices[3]).x=-s.ex,P.y=s.ey;w=s.transform.local_x;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_x=w;w=s.transform.local_y;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_y=w;w=s.transform.local_rotation;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_rotation=w;w=s.transform.local_scale_x;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_scale_x=w;var I,w=s.transform.local_scale_y;if(!(I=S.transform).dirty){I.dirty=I.inverse_dirty=I.coordinates_dirty=!0;for(f=0,v=I.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=I.on_dirty&&I.on_dirty(I)}I.local_scale_y=w,S.dirty_vertices=!0,S.dirty_bounds=!0}if(!(S=s.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}if(S.local_rotation=c,!(S=s.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}if(S.local_scale_x=h,!(S=s.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}if(S.local_scale_y=u,null==s.transformed_rect&&0!=(null==(S=s.transform).parent?S.local_rotation:(S.sync(),S._rotation))){var b=J._pool.get();b.count=4;for(var P,f=0,v=b.count;f<v;){x=f++;null==b.local_vertices[x]&&(b.local_vertices[x]=new hi(0,0))}(P=b.local_vertices[0]).x=-s.ex,P.y=-s.ey,(P=b.local_vertices[1]).x=s.ex,P.y=-s.ey,(P=b.local_vertices[2]).x=s.ex,P.y=s.ey,(P=b.local_vertices[3]).x=-s.ex,P.y=s.ey;w=s.transform.local_x;if(!(S=b.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_x=w;w=s.transform.local_y;if(!(S=b.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_y=w;w=s.transform.local_rotation;if(!(S=b.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_rotation=w;w=s.transform.local_scale_x;if(!(S=b.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_scale_x=w;w=s.transform.local_scale_y;if(!(S=b.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_scale_y=w,b.dirty_vertices=!0,b.dirty_bounds=!0,b.pooled=!1,s.transformed_rect=b,s.transformed_rect.set_parent(s.parent)}else if(null!=s.transformed_rect){w=s.transform.local_x;if(!(S=s.transformed_rect.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_x=w;w=s.transform.local_y;if(!(S=s.transformed_rect.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_y=w;w=s.transform.local_rotation;if(!(S=s.transformed_rect.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_rotation=w;w=s.transform.local_scale_x;if(!(S=s.transformed_rect.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_scale_x=w;var S,w=s.transform.local_scale_y;if(!(S=s.transformed_rect.transform).dirty){S.dirty=S.inverse_dirty=S.coordinates_dirty=!0;for(f=0,v=S.children;f<v.length;){m=v[f];++f,m.dirty=m.inverse_dirty=m.coordinates_dirty=!0;for(p=0,g=m.children;p<g.length;)g[p++].set_dirty(!0);null!=m.on_dirty&&m.on_dirty(m)}null!=S.on_dirty&&S.on_dirty(S)}S.local_scale_y=w}return s.pooled=!1,s},K.__super__=G,K.prototype=e(G.prototype,{put:function(){G.prototype.put.call(this),null!=this.transformed_rect&&(this.transformed_rect.put(),this.transformed_rect=null),this.pooled||(this.pooled=!0,K._pool.put_unsafe(this))},to_aabb:function(t){var r,i,e;if(null==t&&(t=!1),t)return l=(r=null!=this.transformed_rect&&0!=(null==(n=this.transform).parent?n.local_rotation:(n.sync(),n._rotation)))?this.transformed_rect.bounds(null):(i=null==(n=this.transform).parent?n.local_x:(n.sync(),n._x),e=null==(n=this.transform).parent?n.local_y:(n.sync(),n._y),y=(a=2*this.ex)*(null==(n=this.transform).parent?n.local_scale_x:(n.sync(),n._scale_x)),null==(o=(d=2*this.ey)*(null==(n=this.transform).parent?n.local_scale_y:(n.sync(),n._scale_y)))&&(o=1),null==y&&(y=1),null==e&&(e=0),null==i&&(i=0),null==(d=o)&&(d=1),null==(a=y)&&(a=1),null==(_=e)&&(_=0),null==(s=i)&&(s=0),a*=.5,d*=.5,(r=ui._pool.get()).min_x=s-a,r.min_y=_-d,r.max_x=s+a,r.max_y=_+d,r.pooled=!1,r),this.put(),l;if(null!=this.transformed_rect&&0!=(null==(n=this.transform).parent?n.local_rotation:(n.sync(),n._rotation)))return this.transformed_rect.bounds(null);i=null==(n=this.transform).parent?n.local_x:(n.sync(),n._x),e=null==(n=this.transform).parent?n.local_y:(n.sync(),n._y);var n,o,l,s,_,a,d,y=(a=2*this.ex)*(null==(n=this.transform).parent?n.local_scale_x:(n.sync(),n._scale_x));return null==(o=(d=2*this.ey)*(null==(n=this.transform).parent?n.local_scale_y:(n.sync(),n._scale_y)))&&(o=1),null==y&&(y=1),null==e&&(e=0),null==i&&(i=0),null==(d=o)&&(d=1),null==(a=y)&&(a=1),null==(_=e)&&(_=0),null==(s=i)&&(s=0),a*=.5,d*=.5,(l=ui._pool.get()).min_x=s-a,l.min_y=_-d,l.max_x=s+a,l.max_y=_+d,l.pooled=!1,l},bounds:function(t){var r,i;if(null!=this.transformed_rect&&0!=(null==(a=this.transform).parent?a.local_rotation:(a.sync(),a._rotation)))return this.transformed_rect.bounds(t);if(null==t){r=null==(a=this.transform).parent?a.local_x:(a.sync(),a._x),i=null==(a=this.transform).parent?a.local_y:(a.sync(),a._y);var e=(n=2*this.ex)*(null==(a=this.transform).parent?a.local_scale_x:(a.sync(),a._scale_x));null==(d=(_=2*this.ey)*(null==(a=this.transform).parent?a.local_scale_y:(a.sync(),a._scale_y)))&&(d=1),null==e&&(e=1),null==i&&(i=0),null==r&&(r=0);var n,o=ui._pool.get(),l=r,s=i;return null==(_=d)&&(_=1),null==(n=e)&&(n=1),null==s&&(s=0),null==l&&(l=0),n*=.5,_*=.5,o.min_x=l-n,o.min_y=s-_,o.max_x=l+n,o.max_y=s+_,o.pooled=!1,o}r=null==(a=this.transform).parent?a.local_x:(a.sync(),a._x),i=null==(a=this.transform).parent?a.local_y:(a.sync(),a._y);var _,a,d,e=(n=2*this.ex)*(null==(a=this.transform).parent?a.local_scale_x:(a.sync(),a._scale_x));return null==(d=(_=2*this.ey)*(null==(a=this.transform).parent?a.local_scale_y:(a.sync(),a._scale_y)))&&(d=1),null==e&&(e=1),null==i&&(i=0),null==r&&(r=0),e*=.5,d*=.5,t.min_x=r-e,t.min_y=i-d,t.max_x=r+e,t.max_y=i+d,t},intersect:function(t){return ar.line_intersects_rect(t,this)},collides:function(t){return t.collide_rect(this)},collide_rect:function(t){return ar.rect_and_rect(t,this)},collide_circle:function(t){return ar.rect_and_circle(this,t)},collide_polygon:function(t){return ar.rect_and_polygon(this,t)},set_parent:function(t){if(G.prototype.set_parent.call(this,t),null==this.transformed_rect&&0!=(null==(d=this.transform).parent?d.local_rotation:(d.sync(),d._rotation))){var r=J._pool.get();r.count=4;for(var i=0,e=r.count;i<e;){var n=i++;null==r.local_vertices[n]&&(r.local_vertices[n]=new hi(0,0))}var o=r.local_vertices[0];o.x=-this.ex,o.y=-this.ey,(o=r.local_vertices[1]).x=this.ex,o.y=-this.ey,(o=r.local_vertices[2]).x=this.ex,o.y=this.ey,(o=r.local_vertices[3]).x=-this.ex,o.y=this.ey;var l=this.transform.local_x;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){var s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(var _=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_x=l;l=this.transform.local_y;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_y=l;l=this.transform.local_rotation;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_rotation=l;l=this.transform.local_scale_x;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_x=l;l=this.transform.local_scale_y;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_y=l,r.dirty_vertices=!0,r.dirty_bounds=!0,r.pooled=!1,this.transformed_rect=r,this.transformed_rect.set_parent(this.parent)}else if(null!=this.transformed_rect){l=this.transform.local_x;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_x=l;l=this.transform.local_y;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_y=l;l=this.transform.local_rotation;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_rotation=l;l=this.transform.local_scale_x;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_x=l;var d,l=this.transform.local_scale_y;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_y=l}null!=this.transformed_rect&&this.transformed_rect.set_parent(t)},on_dirty:function(t){if(null==this.transformed_rect&&0!=(null==(d=this.transform).parent?d.local_rotation:(d.sync(),d._rotation))){var r=J._pool.get();r.count=4;for(var i=0,e=r.count;i<e;){var n=i++;null==r.local_vertices[n]&&(r.local_vertices[n]=new hi(0,0))}var o=r.local_vertices[0];o.x=-this.ex,o.y=-this.ey,(o=r.local_vertices[1]).x=this.ex,o.y=-this.ey,(o=r.local_vertices[2]).x=this.ex,o.y=this.ey,(o=r.local_vertices[3]).x=-this.ex,o.y=this.ey;var l=this.transform.local_x;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){var s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(var _=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_x=l;l=this.transform.local_y;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_y=l;l=this.transform.local_rotation;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_rotation=l;l=this.transform.local_scale_x;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_x=l;l=this.transform.local_scale_y;if(!(d=r.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_y=l,r.dirty_vertices=!0,r.dirty_bounds=!0,r.pooled=!1,this.transformed_rect=r,this.transformed_rect.set_parent(this.parent)}else if(null!=this.transformed_rect){l=this.transform.local_x;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_x=l;l=this.transform.local_y;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_y=l;l=this.transform.local_rotation;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_rotation=l;l=this.transform.local_scale_x;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_x=l;var d,l=this.transform.local_scale_y;if(!(d=this.transformed_rect.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(i=0,e=d.children;i<e.length;){s=e[i];++i,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_y=l}}});var ui=function(){this.min_x=0,this.max_x=1,this.min_y=0,this.max_y=1};ui.__name__=!0,ui.prototype={put:function(){this.pooled||(this.pooled=!0,ui._pool.put_unsafe(this))}};var I={to_int:function(t){return 1<<t},_new:function(){return 0}},b=function(t){this.re=new P(t),this.un=new P(t)};b.__name__=!0,b.prototype={redo:function(){var t=this.re.pop();return null!=t&&this.un.push(t),t},undo:function(){var t=this.un.pop();return null!=t&&this.re.push(t),t},add:function(t){this.un.push(t),this.re.reset()}};var N=function(){};N.__name__=!0,N.copy_fields=function(t,r){if(null==t)return r;if(null==r)r=_.copy(t);else for(var i=0,e=_.fields(t);i<e.length;){var n=e[i];++i,r[n]=_.field(t,n)}return r};var C=function(t,r){null==r&&(r=0),this.nodes_list=[],this.max_contents=10,this.max_depth=5,ui.call(this),null!=t&&(this.min_x=t.min_x,this.max_x=t.max_x,this.min_y=t.min_y,this.max_y=t.max_y),this.depth=r,this.children=new Array(4),this.contents=[],this.contents_count=0};C.__name__=!0,C.__super__=ui,C.prototype=e(ui.prototype,{put:function(){if(!this.pooled){this.pooled=!0;for(var t=0,r=this.children.length;t<r;){var i,e=t++;null!=this.children[e]&&(this.children[e].clear_children(),(i=this.children[e]).pooled||(i.pooled=!0,i.clear_children(),i.contents.length=0,i.contents_count=0,i.nodes_list.length=0,C._pool.put_unsafe(i)),this.children[e]=null)}this.contents.length=0,this.contents_count=0,this.nodes_list.length=0,C._pool.put_unsafe(this)}},insert:function(t){if(null!=t.bounds){var r=t.bounds;if(r.min_x<this.max_x&&r.max_x>=this.min_x&&r.min_y<this.max_y&&r.max_y>=this.min_y)if(null==this.children[0]&&this.contents_count+1>this.max_contents&&this.split(),null==this.children[0]){var i=this.get_first_null(this.contents);-1==i?this.contents.push(t):this.contents[i]=t,this.contents_count++}else for(var e=0,n=this.children;e<n.length;)n[e++].insert(t)}},remove:function(t,r){if(null==r&&(r=!0),null==this.children[0]){for(var i=0;i<this.contents.length;){if(null!=this.contents[i]&&this.contents[i].id==t.id)return this.contents[i]=null,this.contents_count--,!0;++i}return!1}for(var e=!1,n=0,o=this.children;n<o.length;){var l=o[n];++n,null!=l&&l.remove(t)&&(e=!0)}return r&&e&&this.shake(),e},update:function(t,r){null==r&&(r=!0),this.remove(t,r),this.insert(t)},query:function(t,r){if(this.min_x<t.max_x&&this.max_x>=t.min_x&&this.min_y<t.max_y&&this.max_y>=t.min_y)if(null==this.children[0])for(var i=0,e=this.contents;i<e.length;){var n,o=e[i];++i,null!=o&&((n=o.bounds).min_x<t.max_x&&n.max_x>=t.min_x&&n.min_y<t.max_y&&n.max_y>=t.min_y)&&r.push(o)}else for(i=0,e=this.children;i<e.length;)e[i++].query(t,r)},shake:function(){if(null==this.children[0])return!1;var t=this.get_count();if(0==t)for(var r=0,i=this.children.length;r<i;){var e=r++;if(null!=this.children[e]){for(var n=0,o=(h=this.children[e]).children.length;n<o;){var l=n++;null!=h.children[l]&&(h.children[l].clear_children(),(f=h.children[l]).pooled||(f.pooled=!0,f.clear_children(),f.contents.length=0,f.contents_count=0,f.nodes_list.length=0,C._pool.put_unsafe(f)),h.children[l]=null)}if(!(u=this.children[e]).pooled){u.pooled=!0;for(var s=0,_=u.children.length;s<_;){var a=s++;null!=u.children[a]&&(u.children[a].clear_children(),(v=u.children[a]).pooled||(v.pooled=!0,v.clear_children(),v.contents.length=0,v.contents_count=0,v.nodes_list.length=0,C._pool.put_unsafe(v)),u.children[a]=null)}u.contents.length=0,u.contents_count=0,u.nodes_list.length=0,C._pool.put_unsafe(u)}this.children[e]=null}}else if(t<this.max_contents){for(this.nodes_list.length=0,this.nodes_list.push(this);0<this.nodes_list.length;){var d=this.nodes_list.shift();if(d!=this&&null==d.children[0])for(r=0,i=d.contents;r<i.length;){var y,c=i[r];++r,-1==this.contents.indexOf(c)&&(-1==(y=this.get_first_null(this.contents))?this.contents.push(c):this.contents[y]=c,this.contents_count++)}else for(n=0,o=d.children;n<o.length;)this.nodes_list.push(o[n++])}for(r=0,i=this.children.length;r<i;){e=r++;if(null!=this.children[e]){for(var h,u,n=0,o=(h=this.children[e]).children.length;n<o;){var f,l=n++;null!=h.children[l]&&(h.children[l].clear_children(),(f=h.children[l]).pooled||(f.pooled=!0,f.clear_children(),f.contents.length=0,f.contents_count=0,f.nodes_list.length=0,C._pool.put_unsafe(f)),h.children[l]=null)}if(!(u=this.children[e]).pooled){u.pooled=!0;for(s=0,_=u.children.length;s<_;){var v,a=s++;null!=u.children[a]&&(u.children[a].clear_children(),(v=u.children[a]).pooled||(v.pooled=!0,v.clear_children(),v.contents.length=0,v.contents_count=0,v.nodes_list.length=0,C._pool.put_unsafe(v)),u.children[a]=null)}u.contents.length=0,u.contents_count=0,u.nodes_list.length=0,C._pool.put_unsafe(u)}this.children[e]=null}}return!0}return!1},split:function(){if(!(this.depth+1>=this.max_depth)){for(var t=.5*(this.max_x-this.min_x),r=.5*(this.max_y-this.min_y),i=0;i<4;){var e=i++,n=C._pool.get();n.min_x=-.5,n.min_y=-.5,n.max_x=.5,n.max_y=.5;for(var o=0,l=n.children.length;o<l;){var s,_=o++;null!=n.children[_]&&(n.children[_].clear_children(),(s=n.children[_]).pooled||(s.pooled=!0,s.clear_children(),s.contents.length=0,s.contents_count=0,s.nodes_list.length=0,C._pool.put_unsafe(s)),n.children[_]=null)}switch(n.contents.length=0,n.contents_count=0,n.pooled=!1,e){case 0:var a=this.min_x+t,d=this.min_y+r;n.min_x=this.min_x,n.max_x=a,n.min_y=this.min_y,n.max_y=d;break;case 1:var y=this.min_y+r;n.min_x=this.min_x+t,n.max_x=this.max_x,n.min_y=this.min_y,n.max_y=y;break;case 2:var c=this.min_x+t;n.min_x=this.min_x,n.max_x=c,n.min_y=this.min_y+r,n.max_y=this.max_y;break;case 3:n.min_x=this.min_x+t,n.max_x=this.max_x,n.min_y=this.min_y+r,n.max_y=this.max_y}n.depth=this.depth+1;for(var h=this.max_depth,u=0,f=n.children.length;u<f;){var v=u++;if(null!=n.children[v]){for(var m=n.children[v],p=0,g=m.children.length;p<g;){var x=p++;null!=m.children[x]&&m.children[x].set_max_depth(h)}m.max_depth=h}}n.max_depth=h;for(var w=this.max_contents,I=0,b=n.children.length;I<b;){var P=I++;if(null!=n.children[P]){for(var S=n.children[P],T=0,E=S.children.length;T<E;){var M=T++;if(null!=S.children[M]){for(var O=S.children[M],X=0,R=O.children.length;X<R;){var A=X++;null!=O.children[A]&&O.children[A].set_max_depth(w)}O.max_depth=w}}S.max_depth=w}}n.max_contents=w,n.shake();for(var k=0,L=this.contents.length;k<L;){var F=k++;null!=this.contents[F]&&n.insert(this.contents[F])}this.children[e]=n}this.contents.length=0,this.contents_count=0}},clear_children:function(){for(var t=0,r=this.children.length;t<r;){var i,e=t++;null!=this.children[e]&&(this.children[e].clear_children(),(i=this.children[e]).pooled||(i.pooled=!0,i.clear_children(),i.contents.length=0,i.contents_count=0,i.nodes_list.length=0,C._pool.put_unsafe(i)),this.children[e]=null)}},reset_data_flags:function(){for(var t=0,r=this.contents.length;t<r;){var i=t++;null!=this.contents[i]&&(this.contents[i].flag=!1)}for(t=0,r=this.children.length;t<r;){i=t++;null!=this.children[i]&&this.children[i].reset_data_flags()}},get_count:function(){this.reset_data_flags();for(var t=0,r=0,i=this.contents.length;r<i;){var e=r++;null!=this.contents[e]&&(this.contents[e].flag=!0,++t)}for(this.nodes_list.length=0,this.nodes_list.push(this);0<this.nodes_list.length;){var n=this.nodes_list.shift();if(null==n.children[0])for(r=0,i=n.contents.length;r<i;){e=r++;null==n.contents[e]||n.contents[e].flag||(++t,n.contents[e].flag=!0)}else for(var o=0,l=n.children.length;o<l;)this.nodes_list.push(n.children[o++])}return t},get_first_null:function(t){for(var r=0,i=t.length;r<i;){var e=r++;if(null==t[e])return e}return-1},set_max_depth:function(t){for(var r=0,i=this.children.length;r<i;){var e=r++;null!=this.children[e]&&this.children[e].set_max_depth(t)}return this.max_depth=t},__properties__:{get_count:"get_count",set_max_depth:"set_max_depth"}});var P=function(t){this.a=new Array(t),this.reset()};P.__name__=!0,P.prototype={pop:function(){return this.i+this.left-this.start<=0?null:(0==this.i&&(this.i=this.a.length,this.left=0),this.a[--this.i])},push:function(t){this.i==this.a.length&&(0<this.left&&this.start==this.i&&(this.start=0),this.i=0,this.left=this.a.length),this.i+this.left-this.start==this.a.length&&this.start++,this.a[this.i++]=t},reset:function(){this.i=0,this.start=0,this.left=0}};var ar=function(){};ar.__name__=!0,ar.line_intersects_rect=function(t,r){if(null!=r.transformed_rect&&0!=(null==(C=r.transform).parent?C.local_rotation:(C.sync(),C._rotation)))return r.transformed_rect.intersect(t);var i,e=null;if(c=null==r.transformed_rect||0==(null==(C=r.transform).parent?C.local_rotation:(C.sync(),C._rotation)))var n=(c=null==(C=r.transform).parent?C.local_x:(C.sync(),C._x))-r.ex*(null==(C=r.transform).parent?C.local_scale_x:(C.sync(),C._scale_x));else{if(0!=(C=r.transformed_rect).count){if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(var o=0,l=C.count;o<l;){var s=o++;null!=C.local_vertices[s]&&(null==C._vertices[s]&&(C._vertices[s]=new hi(0,0)),It=C.local_vertices[s].x,null==(bt=C.local_vertices[s].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[s]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(o=0,l=C.count;o<l;){var s=o++,_=C.sync_pos,a=C._vertices[(s+1)%C.count];_.x=a.x,_.y=a.y;var d=C._vertices[s];(g=C.sync_pos).x-=d.x,g.y-=d.y,null==C._normals[s]?C._normals[s]=new hi(-C.sync_pos.y,C.sync_pos.x):(bt=C.sync_pos.x,(z=C._normals[s]).x=-C.sync_pos.y,z.y=bt);var y=C._normals[s];0<(j=Math.sqrt(y.x*y.x+y.y*y.y))&&(y.x/=j,y.y/=j)}}c=null==C._vertices[0]}else c=!0;if(c){n=null==(i=C.transform).parent?i.local_x:(i.sync(),i._x)}else{if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(o=0,l=C.count;o<l;){s=o++;null!=C.local_vertices[s]&&(null==C._vertices[s]&&(C._vertices[s]=new hi(0,0)),It=C.local_vertices[s].x,null==(bt=C.local_vertices[s].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[s]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(o=0,l=C.count;o<l;){s=o++,_=C.sync_pos,a=C._vertices[(s+1)%C.count];_.x=a.x,_.y=a.y;d=C._vertices[s];(g=C.sync_pos).x-=d.x,g.y-=d.y,null==C._normals[s]?C._normals[s]=new hi(-C.sync_pos.y,C.sync_pos.x):(bt=C.sync_pos.x,(z=C._normals[s]).x=-C.sync_pos.y,z.y=bt);y=C._normals[s];0<(j=Math.sqrt(y.x*y.x+y.y*y.y))&&(y.x/=j,y.y/=j)}}for(var c=C._vertices[0].x,o=1,l=C.count;o<l;){s=o++;if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(var h=0,u=C.count;h<u;){var f=h++;null!=C.local_vertices[f]&&(null==C._vertices[f]&&(C._vertices[f]=new hi(0,0)),It=C.local_vertices[f].x,null==(bt=C.local_vertices[f].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[f]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(var v=0,m=C.count;v<m;){var p=v++,_=C.sync_pos,g=C._vertices[(p+1)%C.count];_.x=g.x,_.y=g.y;var x=C._vertices[p];(z=C.sync_pos).x-=x.x,z.y-=x.y,null==C._normals[p]?C._normals[p]=new hi(-C.sync_pos.y,C.sync_pos.x):(et=C.sync_pos.x,(y=C._normals[p]).x=-C.sync_pos.y,y.y=et);var w=C._normals[p];0<(j=Math.sqrt(w.x*w.x+w.y*w.y))&&(w.x/=j,w.y/=j)}}if(C._vertices[s].x<c){if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(var I=0,b=C.count;I<b;){var P=I++;null!=C.local_vertices[P]&&(null==C._vertices[P]&&(C._vertices[P]=new hi(0,0)),it=C.local_vertices[P].x,null==(H=C.local_vertices[P].y)&&(H=0),null==it&&(it=0),W=C.transform.get_local_to_world_matrix(),B=it,J=H,K=1,(Y=C._vertices[P]).x=W.m00*B+W.m10*J+W.m20*K,Y.y=W.m01*B+W.m11*J+W.m21*K)}for(var S=0,T=C.count;S<T;){var E=S++,M=C.sync_pos,O=C._vertices[(E+1)%C.count];M.x=O.x,M.y=O.y;var X=C._vertices[E];(V=C.sync_pos).x-=X.x,V.y-=X.y,null==C._normals[E]?C._normals[E]=new hi(-C.sync_pos.y,C.sync_pos.x):(Z=C.sync_pos.x,($=C._normals[E]).x=-C.sync_pos.y,$.y=Z);var R=C._normals[E];0<(Q=Math.sqrt(R.x*R.x+R.y*R.y))&&(R.x/=Q,R.y/=Q)}}c=C._vertices[s].x}}n=c}}if(k=null==r.transformed_rect||0==(null==(C=r.transform).parent?C.local_rotation:(C.sync(),C._rotation)))var A=(k=null==(C=r.transform).parent?C.local_x:(C.sync(),C._x))+r.ex*(null==(C=r.transform).parent?C.local_scale_x:(C.sync(),C._scale_x));else{if(0!=(C=r.transformed_rect).count){if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(o=0,l=C.count;o<l;){s=o++;null!=C.local_vertices[s]&&(null==C._vertices[s]&&(C._vertices[s]=new hi(0,0)),It=C.local_vertices[s].x,null==(bt=C.local_vertices[s].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[s]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(o=0,l=C.count;o<l;){s=o++,_=C.sync_pos,a=C._vertices[(s+1)%C.count];_.x=a.x,_.y=a.y;d=C._vertices[s];(g=C.sync_pos).x-=d.x,g.y-=d.y,null==C._normals[s]?C._normals[s]=new hi(-C.sync_pos.y,C.sync_pos.x):(bt=C.sync_pos.x,(z=C._normals[s]).x=-C.sync_pos.y,z.y=bt);y=C._normals[s];0<(j=Math.sqrt(y.x*y.x+y.y*y.y))&&(y.x/=j,y.y/=j)}}k=null==C._vertices[0]}else k=!0;if(k){A=null==(i=C.transform).parent?i.local_x:(i.sync(),i._x)}else{if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(o=0,l=C.count;o<l;){s=o++;null!=C.local_vertices[s]&&(null==C._vertices[s]&&(C._vertices[s]=new hi(0,0)),It=C.local_vertices[s].x,null==(bt=C.local_vertices[s].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[s]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(o=0,l=C.count;o<l;){s=o++,_=C.sync_pos,a=C._vertices[(s+1)%C.count];_.x=a.x,_.y=a.y;d=C._vertices[s];(g=C.sync_pos).x-=d.x,g.y-=d.y,null==C._normals[s]?C._normals[s]=new hi(-C.sync_pos.y,C.sync_pos.x):(bt=C.sync_pos.x,(z=C._normals[s]).x=-C.sync_pos.y,z.y=bt);y=C._normals[s];0<(j=Math.sqrt(y.x*y.x+y.y*y.y))&&(y.x/=j,y.y/=j)}}for(var k=C._vertices[0].x,o=1,l=C.count;o<l;){s=o++;if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(h=0,u=C.count;h<u;){f=h++;null!=C.local_vertices[f]&&(null==C._vertices[f]&&(C._vertices[f]=new hi(0,0)),It=C.local_vertices[f].x,null==(bt=C.local_vertices[f].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[f]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(v=0,m=C.count;v<m;){p=v++,_=C.sync_pos,g=C._vertices[(p+1)%C.count];_.x=g.x,_.y=g.y;x=C._vertices[p];(z=C.sync_pos).x-=x.x,z.y-=x.y,null==C._normals[p]?C._normals[p]=new hi(-C.sync_pos.y,C.sync_pos.x):(et=C.sync_pos.x,(y=C._normals[p]).x=-C.sync_pos.y,y.y=et);w=C._normals[p];0<(j=Math.sqrt(w.x*w.x+w.y*w.y))&&(w.x/=j,w.y/=j)}}if(C._vertices[s].x>k){if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(I=0,b=C.count;I<b;){P=I++;null!=C.local_vertices[P]&&(null==C._vertices[P]&&(C._vertices[P]=new hi(0,0)),it=C.local_vertices[P].x,null==(H=C.local_vertices[P].y)&&(H=0),null==it&&(it=0),W=C.transform.get_local_to_world_matrix(),B=it,J=H,K=1,(Y=C._vertices[P]).x=W.m00*B+W.m10*J+W.m20*K,Y.y=W.m01*B+W.m11*J+W.m21*K)}for(S=0,T=C.count;S<T;){E=S++,M=C.sync_pos,O=C._vertices[(E+1)%C.count];M.x=O.x,M.y=O.y;X=C._vertices[E];(V=C.sync_pos).x-=X.x,V.y-=X.y,null==C._normals[E]?C._normals[E]=new hi(-C.sync_pos.y,C.sync_pos.x):(Z=C.sync_pos.x,($=C._normals[E]).x=-C.sync_pos.y,$.y=Z);R=C._normals[E];0<(Q=Math.sqrt(R.x*R.x+R.y*R.y))&&(R.x/=Q,R.y/=Q)}}k=C._vertices[s].x}}A=k}}if(F=null==r.transformed_rect||0==(null==(C=r.transform).parent?C.local_rotation:(C.sync(),C._rotation)))var L=(F=null==(C=r.transform).parent?C.local_y:(C.sync(),C._y))-r.ey*(null==(C=r.transform).parent?C.local_scale_y:(C.sync(),C._scale_y));else{if(0!=(C=r.transformed_rect).count){if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(o=0,l=C.count;o<l;){s=o++;null!=C.local_vertices[s]&&(null==C._vertices[s]&&(C._vertices[s]=new hi(0,0)),It=C.local_vertices[s].x,null==(bt=C.local_vertices[s].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[s]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(o=0,l=C.count;o<l;){s=o++,_=C.sync_pos,a=C._vertices[(s+1)%C.count];_.x=a.x,_.y=a.y;d=C._vertices[s];(g=C.sync_pos).x-=d.x,g.y-=d.y,null==C._normals[s]?C._normals[s]=new hi(-C.sync_pos.y,C.sync_pos.x):(bt=C.sync_pos.x,(z=C._normals[s]).x=-C.sync_pos.y,z.y=bt);y=C._normals[s];0<(j=Math.sqrt(y.x*y.x+y.y*y.y))&&(y.x/=j,y.y/=j)}}F=null==C._vertices[0]}else F=!0;if(F){L=null==(i=C.transform).parent?i.local_y:(i.sync(),i._y)}else{if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(o=0,l=C.count;o<l;){s=o++;null!=C.local_vertices[s]&&(null==C._vertices[s]&&(C._vertices[s]=new hi(0,0)),It=C.local_vertices[s].x,null==(bt=C.local_vertices[s].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[s]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(o=0,l=C.count;o<l;){s=o++,_=C.sync_pos,a=C._vertices[(s+1)%C.count];_.x=a.x,_.y=a.y;d=C._vertices[s];(g=C.sync_pos).x-=d.x,g.y-=d.y,null==C._normals[s]?C._normals[s]=new hi(-C.sync_pos.y,C.sync_pos.x):(bt=C.sync_pos.x,(z=C._normals[s]).x=-C.sync_pos.y,z.y=bt);y=C._normals[s];0<(j=Math.sqrt(y.x*y.x+y.y*y.y))&&(y.x/=j,y.y/=j)}}for(var F=C._vertices[0].y,o=1,l=C.count;o<l;){s=o++;if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(h=0,u=C.count;h<u;){f=h++;null!=C.local_vertices[f]&&(null==C._vertices[f]&&(C._vertices[f]=new hi(0,0)),It=C.local_vertices[f].x,null==(bt=C.local_vertices[f].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[f]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(v=0,m=C.count;v<m;){p=v++,_=C.sync_pos,g=C._vertices[(p+1)%C.count];_.x=g.x,_.y=g.y;x=C._vertices[p];(z=C.sync_pos).x-=x.x,z.y-=x.y,null==C._normals[p]?C._normals[p]=new hi(-C.sync_pos.y,C.sync_pos.x):(et=C.sync_pos.x,(y=C._normals[p]).x=-C.sync_pos.y,y.y=et);w=C._normals[p];0<(j=Math.sqrt(w.x*w.x+w.y*w.y))&&(w.x/=j,w.y/=j)}}if(C._vertices[s].y<F){if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(I=0,b=C.count;I<b;){P=I++;null!=C.local_vertices[P]&&(null==C._vertices[P]&&(C._vertices[P]=new hi(0,0)),it=C.local_vertices[P].x,null==(H=C.local_vertices[P].y)&&(H=0),null==it&&(it=0),W=C.transform.get_local_to_world_matrix(),B=it,J=H,K=1,(Y=C._vertices[P]).x=W.m00*B+W.m10*J+W.m20*K,Y.y=W.m01*B+W.m11*J+W.m21*K)}for(S=0,T=C.count;S<T;){E=S++,M=C.sync_pos,O=C._vertices[(E+1)%C.count];M.x=O.x,M.y=O.y;X=C._vertices[E];(V=C.sync_pos).x-=X.x,V.y-=X.y,null==C._normals[E]?C._normals[E]=new hi(-C.sync_pos.y,C.sync_pos.x):(Z=C.sync_pos.x,($=C._normals[E]).x=-C.sync_pos.y,$.y=Z);R=C._normals[E];0<(Q=Math.sqrt(R.x*R.x+R.y*R.y))&&(R.x/=Q,R.y/=Q)}}F=C._vertices[s].y}}L=F}}if(G=null==r.transformed_rect||0==(null==(C=r.transform).parent?C.local_rotation:(C.sync(),C._rotation)))var C,q=(G=null==(C=r.transform).parent?C.local_y:(C.sync(),C._y))+r.ey*(null==(C=r.transform).parent?C.local_scale_y:(C.sync(),C._scale_y));else{if(0!=(C=r.transformed_rect).count){if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(o=0,l=C.count;o<l;){s=o++;null!=C.local_vertices[s]&&(null==C._vertices[s]&&(C._vertices[s]=new hi(0,0)),It=C.local_vertices[s].x,null==(bt=C.local_vertices[s].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[s]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(o=0,l=C.count;o<l;){s=o++,_=C.sync_pos,a=C._vertices[(s+1)%C.count];_.x=a.x,_.y=a.y;d=C._vertices[s];(g=C.sync_pos).x-=d.x,g.y-=d.y,null==C._normals[s]?C._normals[s]=new hi(-C.sync_pos.y,C.sync_pos.x):(bt=C.sync_pos.x,(z=C._normals[s]).x=-C.sync_pos.y,z.y=bt);y=C._normals[s];0<(j=Math.sqrt(y.x*y.x+y.y*y.y))&&(y.x/=j,y.y/=j)}}G=null==C._vertices[0]}else G=!0;if(G){q=null==(i=C.transform).parent?i.local_y:(i.sync(),i._y)}else{if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(o=0,l=C.count;o<l;){s=o++;null!=C.local_vertices[s]&&(null==C._vertices[s]&&(C._vertices[s]=new hi(0,0)),It=C.local_vertices[s].x,null==(bt=C.local_vertices[s].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[s]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(o=0,l=C.count;o<l;){s=o++,_=C.sync_pos,a=C._vertices[(s+1)%C.count];_.x=a.x,_.y=a.y;d=C._vertices[s];(g=C.sync_pos).x-=d.x,g.y-=d.y,null==C._normals[s]?C._normals[s]=new hi(-C.sync_pos.y,C.sync_pos.x):(bt=C.sync_pos.x,(z=C._normals[s]).x=-C.sync_pos.y,z.y=bt);y=C._normals[s];0<(j=Math.sqrt(y.x*y.x+y.y*y.y))&&(y.x/=j,y.y/=j)}}for(var G=C._vertices[0].y,o=1,l=C.count;o<l;){s=o++;if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(h=0,u=C.count;h<u;){var D,N,U,f=h++;null!=C.local_vertices[f]&&(null==C._vertices[f]&&(C._vertices[f]=new hi(0,0)),It=C.local_vertices[f].x,null==(bt=C.local_vertices[f].y)&&(bt=0),null==It&&(It=0),d=C.transform.get_local_to_world_matrix(),D=It,N=bt,U=1,(a=C._vertices[f]).x=d.m00*D+d.m10*N+d.m20*U,a.y=d.m01*D+d.m11*N+d.m21*U)}for(v=0,m=C.count;v<m;){p=v++,_=C.sync_pos,g=C._vertices[(p+1)%C.count];_.x=g.x,_.y=g.y;var z,x=C._vertices[p];(z=C.sync_pos).x-=x.x,z.y-=x.y,null==C._normals[p]?C._normals[p]=new hi(-C.sync_pos.y,C.sync_pos.x):(et=C.sync_pos.x,(y=C._normals[p]).x=-C.sync_pos.y,y.y=et);var j,w=C._normals[p];0<(j=Math.sqrt(w.x*w.x+w.y*w.y))&&(w.x/=j,w.y/=j)}}if(C._vertices[s].y>G){if(C.dirty_vertices){for(C.dirty_vertices=!1;C._vertices.length>C.count;)C._vertices.pop();for(I=0,b=C.count;I<b;){var H,W,B,J,K,Y,P=I++;null!=C.local_vertices[P]&&(null==C._vertices[P]&&(C._vertices[P]=new hi(0,0)),it=C.local_vertices[P].x,null==(H=C.local_vertices[P].y)&&(H=0),null==it&&(it=0),W=C.transform.get_local_to_world_matrix(),B=it,J=H,K=1,(Y=C._vertices[P]).x=W.m00*B+W.m10*J+W.m20*K,Y.y=W.m01*B+W.m11*J+W.m21*K)}for(S=0,T=C.count;S<T;){E=S++,M=C.sync_pos,O=C._vertices[(E+1)%C.count];M.x=O.x,M.y=O.y;var V,Z,$,X=C._vertices[E];(V=C.sync_pos).x-=X.x,V.y-=X.y,null==C._normals[E]?C._normals[E]=new hi(-C.sync_pos.y,C.sync_pos.x):(Z=C.sync_pos.x,($=C._normals[E]).x=-C.sync_pos.y,$.y=Z);var Q,R=C._normals[E];0<(Q=Math.sqrt(R.x*R.x+R.y*R.y))&&(R.x/=Q,R.y/=Q)}}G=C._vertices[s].y}}q=G}}var tt=A,rt=L;null==rt&&(rt=1),null==tt&&(tt=1),null==(bt=L)&&(bt=0),null==(It=n)&&(It=0);var it,et,nt=Wt._pool.get(),ot=tt,lt=rt;null==lt&&(lt=1),null==ot&&(ot=1),null==(et=bt)&&(et=0),null==(it=It)&&(it=0),(a=nt.start).x=it,a.y=et,(a=nt.end).x=ot,a.y=lt,nt.pooled=!1;var st,_t=(nt.get_dy()-nt.get_y())*(t.get_dx()-t.get_x())-(nt.get_dx()-nt.get_x())*(t.get_dy()-t.get_y());null!=(st=Math.abs(_t)<=1e-5?null:(at=((nt.get_dx()-nt.get_x())*(t.get_y()-nt.get_y())-(nt.get_dy()-nt.get_y())*(t.get_x()-nt.get_x()))/_t,dt=((t.get_dx()-t.get_x())*(t.get_y()-nt.get_y())-(t.get_dy()-t.get_y())*(t.get_x()-nt.get_x()))/_t,at<0||1<at||dt<0||1<dt?null:(d=t.start,x=t.end,pt=t.start,gt=It=x.x,xt=bt=x.y,yt=It=gt=It-pt.x,ct=bt=xt=bt-pt.y,yt=It*at,ct=bt*at,ht=It=d.x,ut=bt=d.y,ht=It+yt,ut=bt+ct,gt=It=(a=t.start).x,xt=bt=a.y,gt=It-ht,xt=bt-ut,ft=Math.sqrt(gt*gt+xt*xt),pt=t.end,gt=It=(a=t.start).x,xt=bt=a.y,gt=It-pt.x,xt=bt-pt.y,vt=Math.sqrt(gt*gt+xt*xt)-ft,mt=0<=_t,pt=nt.end,gt=It=(a=nt.start).x,xt=bt=a.y,gt=It-pt.x,xt=bt-pt.y,wt=Math.sqrt(gt*gt+xt*xt)*(mt?-1:1),It=(nt.get_dy()-nt.get_y())/wt,bt=-(nt.get_dx()-nt.get_x())/wt,(a=ar.norm).x=It,a.y=bt,Pt=ar.norm.x,St=ar.norm.y,Tt=null!=mt&&mt,(s=Bt._pool.get()).line=null,s.shape=null,(s.line2=null)==(Et=Tt)&&(Et=!1),s.distance=ft,s.overlap=vt,s.inverse_normal=Et,(a=s.hit).x=ht,a.y=ut,(a=s.normal).x=Pt,a.y=St,s.pooled=!1,s.line=t,s.line2=nt,s)))&&(e=st),null==(rt=q)&&(rt=1),null==(tt=A)&&(tt=1),null==(bt=L)&&(bt=0),null==(It=A)&&(It=0),(a=nt.start).x=It,a.y=bt,(a=nt.end).x=tt,a.y=rt;_t=(nt.get_dy()-nt.get_y())*(t.get_dx()-t.get_x())-(nt.get_dx()-nt.get_x())*(t.get_dy()-t.get_y());null!=(st=Math.abs(_t)<=1e-5?null:(at=((nt.get_dx()-nt.get_x())*(t.get_y()-nt.get_y())-(nt.get_dy()-nt.get_y())*(t.get_x()-nt.get_x()))/_t,dt=((t.get_dx()-t.get_x())*(t.get_y()-nt.get_y())-(t.get_dy()-t.get_y())*(t.get_x()-nt.get_x()))/_t,at<0||1<at||dt<0||1<dt?null:(d=t.start,x=t.end,pt=t.start,gt=It=x.x,xt=bt=x.y,yt=It=gt=It-pt.x,ct=bt=xt=bt-pt.y,yt=It*at,ct=bt*at,ht=It=d.x,ut=bt=d.y,ht=It+yt,ut=bt+ct,gt=It=(a=t.start).x,xt=bt=a.y,gt=It-ht,xt=bt-ut,ft=Math.sqrt(gt*gt+xt*xt),pt=t.end,gt=It=(a=t.start).x,xt=bt=a.y,gt=It-pt.x,xt=bt-pt.y,vt=Math.sqrt(gt*gt+xt*xt)-ft,mt=0<=_t,pt=nt.end,gt=It=(a=nt.start).x,xt=bt=a.y,gt=It-pt.x,xt=bt-pt.y,wt=Math.sqrt(gt*gt+xt*xt)*(mt?-1:1),It=(nt.get_dy()-nt.get_y())/wt,bt=-(nt.get_dx()-nt.get_x())/wt,(a=ar.norm).x=It,a.y=bt,Pt=ar.norm.x,St=ar.norm.y,Tt=null!=mt&&mt,(s=Bt._pool.get()).line=null,s.shape=null,(s.line2=null)==(Et=Tt)&&(Et=!1),s.distance=ft,s.overlap=vt,s.inverse_normal=Et,(a=s.hit).x=ht,a.y=ut,(a=s.normal).x=Pt,a.y=St,s.pooled=!1,s.line=t,s.line2=nt,s)))&&(null==e||e.distance>st.distance)&&(e=st),null==(rt=q)&&(rt=1),null==(tt=n)&&(tt=1),null==(bt=q)&&(bt=0),null==(It=A)&&(It=0),(a=nt.start).x=It,a.y=bt,(a=nt.end).x=tt,a.y=rt;_t=(nt.get_dy()-nt.get_y())*(t.get_dx()-t.get_x())-(nt.get_dx()-nt.get_x())*(t.get_dy()-t.get_y());null!=(st=Math.abs(_t)<=1e-5?null:(at=((nt.get_dx()-nt.get_x())*(t.get_y()-nt.get_y())-(nt.get_dy()-nt.get_y())*(t.get_x()-nt.get_x()))/_t,dt=((t.get_dx()-t.get_x())*(t.get_y()-nt.get_y())-(t.get_dy()-t.get_y())*(t.get_x()-nt.get_x()))/_t,at<0||1<at||dt<0||1<dt?null:(d=t.start,x=t.end,pt=t.start,gt=It=x.x,xt=bt=x.y,yt=It=gt=It-pt.x,ct=bt=xt=bt-pt.y,yt=It*at,ct=bt*at,ht=It=d.x,ut=bt=d.y,ht=It+yt,ut=bt+ct,gt=It=(a=t.start).x,xt=bt=a.y,gt=It-ht,xt=bt-ut,ft=Math.sqrt(gt*gt+xt*xt),pt=t.end,gt=It=(a=t.start).x,xt=bt=a.y,gt=It-pt.x,xt=bt-pt.y,vt=Math.sqrt(gt*gt+xt*xt)-ft,mt=0<=_t,pt=nt.end,gt=It=(a=nt.start).x,xt=bt=a.y,gt=It-pt.x,xt=bt-pt.y,wt=Math.sqrt(gt*gt+xt*xt)*(mt?-1:1),It=(nt.get_dy()-nt.get_y())/wt,bt=-(nt.get_dx()-nt.get_x())/wt,(a=ar.norm).x=It,a.y=bt,Pt=ar.norm.x,St=ar.norm.y,Tt=null!=mt&&mt,(s=Bt._pool.get()).line=null,s.shape=null,(s.line2=null)==(Et=Tt)&&(Et=!1),s.distance=ft,s.overlap=vt,s.inverse_normal=Et,(a=s.hit).x=ht,a.y=ut,(a=s.normal).x=Pt,a.y=St,s.pooled=!1,s.line=t,s.line2=nt,s)))&&(null==e||e.distance>st.distance)&&(e=st),null==(rt=L)&&(rt=1),null==(tt=n)&&(tt=1),null==(bt=q)&&(bt=0),null==(It=n)&&(It=0),(a=nt.start).x=It,a.y=bt,(a=nt.end).x=tt,a.y=rt;var at,dt,yt,ct,ht,ut,ft,vt,mt,pt,gt,xt,wt,It,bt,Pt,St,Tt,Et,_t=(nt.get_dy()-nt.get_y())*(t.get_dx()-t.get_x())-(nt.get_dx()-nt.get_x())*(t.get_dy()-t.get_y());return null!=(st=Math.abs(_t)<=1e-5?null:(at=((nt.get_dx()-nt.get_x())*(t.get_y()-nt.get_y())-(nt.get_dy()-nt.get_y())*(t.get_x()-nt.get_x()))/_t,dt=((t.get_dx()-t.get_x())*(t.get_y()-nt.get_y())-(t.get_dy()-t.get_y())*(t.get_x()-nt.get_x()))/_t,at<0||1<at||dt<0||1<dt?null:(d=t.start,x=t.end,pt=t.start,gt=It=x.x,xt=bt=x.y,yt=It=gt=It-pt.x,ct=bt=xt=bt-pt.y,yt=It*at,ct=bt*at,ht=It=d.x,ut=bt=d.y,ht=It+yt,ut=bt+ct,gt=It=(a=t.start).x,xt=bt=a.y,gt=It-ht,xt=bt-ut,ft=Math.sqrt(gt*gt+xt*xt),pt=t.end,gt=It=(a=t.start).x,xt=bt=a.y,gt=It-pt.x,xt=bt-pt.y,vt=Math.sqrt(gt*gt+xt*xt)-ft,mt=0<=_t,pt=nt.end,gt=It=(a=nt.start).x,xt=bt=a.y,gt=It-pt.x,xt=bt-pt.y,wt=Math.sqrt(gt*gt+xt*xt)*(mt?-1:1),It=(nt.get_dy()-nt.get_y())/wt,bt=-(nt.get_dx()-nt.get_x())/wt,(a=ar.norm).x=It,a.y=bt,Pt=ar.norm.x,St=ar.norm.y,Tt=null!=mt&&mt,(s=Bt._pool.get()).line=null,s.shape=null,(s.line2=null)==(Et=Tt)&&(Et=!1),s.distance=ft,s.overlap=vt,s.inverse_normal=Et,(a=s.hit).x=ht,a.y=ut,(a=s.normal).x=Pt,a.y=St,s.pooled=!1,s.line=t,s.line2=nt,s)))&&(null==e||e.distance>st.distance)&&(e=st),null!=e&&(e.line=t,e.shape=r),e},ar.line_intersects_circle=function(t,r){var i=t.end,e=t.start,n=S=i.x,o=E=i.y,n=S-e.x,o=E-e.y,i=t.start;(T=r.transform).sync();var l=S=i.x,s=E=i.y,l=S-T._x,s=E-T._y,_=r.local_radius,a=null==(T=r.transform).parent?T.local_scale_x:(T.sync(),T._scale_x),d=_*a,y=(e=2*(l*n+s*o))*e-4*(i=n*n+o*o)*(l*l+s*s-d*d);if(y<0)return null;var c=(-e-(y=Math.sqrt(y)))/(2*i),h=(-e+y)/(2*i);if(0<=c&&c<=1){var i=t.start,u=t.end,e=t.start,f=S=u.x,v=E=u.y,m=S=f=S-e.x,p=E=v=E-e.y;m=S*c,p=E*c;var g=S=i.x,x=E=i.y;g=S+m,x=E+p;f=S=(X=t.start).x,v=E=X.y;f=S-g,v=E-x;var w=Math.sqrt(f*f+v*v),e=t.end,f=S=(X=t.start).x,v=E=X.y;f=S-e.x,v=E-e.y;var I=Math.sqrt(f*f+v*v)-w;S=null==(T=r.transform).parent?T.local_x:(T.sync(),T._x),E=null==(T=r.transform).parent?T.local_y:(T.sync(),T._y),(X=ar.norm).x=g-S,X.y=x-E,(M=X).x/=d,M.y/=d;var b=ar.norm.x,P=ar.norm.y;return(O=Bt._pool.get()).line=null,O.shape=null,O.line2=null,O.distance=w,O.overlap=I,O.inverse_normal=!1,(X=O.hit).x=g,X.y=x,(X=O.normal).x=b,X.y=P,O.pooled=!1,O.line=t,O.shape=r,O}if(0<=h&&h<=1){i=t.start,u=t.end,e=t.start,f=S=u.x,v=E=u.y,m=S=f=S-e.x,p=E=v=E-e.y;m=S*h,p=E*h;g=S=i.x,x=E=i.y;g=S+m,x=E+p;f=S=(X=t.start).x,v=E=X.y;f=S-g,v=E-x;w=Math.sqrt(f*f+v*v),e=t.end,f=S=(X=t.start).x,v=E=X.y;f=S-e.x,v=E-e.y;var S,T,E,M,I=Math.sqrt(f*f+v*v)-w;S=null==(T=r.transform).parent?T.local_x:(T.sync(),T._x),E=null==(T=r.transform).parent?T.local_y:(T.sync(),T._y),(X=ar.norm).x=g-S,X.y=x-E,(M=X).x=-M.x,M.y=-M.y,(X=M).x/=d,X.y/=d;var O,X,b=ar.norm.x,P=ar.norm.y;return(O=Bt._pool.get()).line=null,O.shape=null,O.line2=null,O.distance=w,O.overlap=I,O.inverse_normal=!0,(X=O.hit).x=g,X.y=x,(X=O.normal).x=b,X.y=P,O.pooled=!1,O.line=t,O.shape=r,O}return null},ar.line_intersects_polygon=function(t,r){var i=null,e=Wt._pool.get();(u=e.start).x=0,u.y=0,(u=e.end).x=1,u.y=1,e.pooled=!1;for(var n=0,o=r.count;n<o;){var l=n++;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(var s=0,_=r.count;s<_;){var a,d,y,c,h,u,f=s++;null!=r.local_vertices[f]&&(null==r._vertices[f]&&(r._vertices[f]=new hi(0,0)),a=r.local_vertices[f].x,null==(d=r.local_vertices[f].y)&&(d=0),null==a&&(a=0),y=r.transform.get_local_to_world_matrix(),c=a,h=d,(u=r._vertices[f]).x=y.m00*c+y.m10*h+ +y.m20,u.y=y.m01*c+y.m11*h+ +y.m21)}for(var v=0,m=r.count;v<m;){var p=v++,g=r.sync_pos,x=r._vertices[(1+p)%r.count];g.x=x.x,g.y=x.y;var w,I,b=r._vertices[p],P=r.sync_pos;P.x-=b.x,P.y-=b.y,null==r._normals[p]?r._normals[p]=new hi(-r.sync_pos.y,r.sync_pos.x):(w=r.sync_pos.x,(I=r._normals[p]).x=-r.sync_pos.y,I.y=w);var S=r._normals[p],T=Math.sqrt(S.x*S.x+S.y*S.y);0<T&&(S.x/=T,S.y/=T)}}var E=r._vertices[l];if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(var M=0,O=r.count;M<O;){var X,R,A,k,L,F,C=M++;null!=r.local_vertices[C]&&(null==r._vertices[C]&&(r._vertices[C]=new hi(0,0)),X=r.local_vertices[C].x,null==(R=r.local_vertices[C].y)&&(R=0),null==X&&(X=0),A=r.transform.get_local_to_world_matrix(),k=X,L=R,(F=r._vertices[C]).x=A.m00*k+A.m10*L+ +A.m20,F.y=A.m01*k+A.m11*L+ +A.m21)}for(var q=0,G=r.count;q<G;){var D=q++,N=r.sync_pos,U=r._vertices[(1+D)%r.count];N.x=U.x,N.y=U.y;var z,j,H=r._vertices[D],W=r.sync_pos;W.x-=H.x,W.y-=H.y,null==r._normals[D]?r._normals[D]=new hi(-r.sync_pos.y,r.sync_pos.x):(z=r.sync_pos.x,(j=r._normals[D]).x=-r.sync_pos.y,j.y=z);var B=r._normals[D],J=Math.sqrt(B.x*B.x+B.y*B.y);0<J&&(B.x/=J,B.y/=J)}}var K=r._vertices[(1+l)%r.count],Y=E.x,V=E.y,Z=K.x,$=K.y;null==$&&($=1),null==Z&&(Z=1),null==V&&(V=0),null==Y&&(Y=0);var Q=e.start;Q.x=Y,Q.y=V;var tt=e.end;tt.x=Z,tt.y=$;var rt,it,et,nt,ot,lt,st,_t,at,dt,yt,ct,ht,ut,ft,vt,mt,pt,gt,xt,wt,It,bt,Pt,St,Tt,Et,Mt,Ot,Xt,Rt,At,kt,Lt,Ft,Ct,qt,Gt,Dt,Nt,Ut,zt,jt,Ht=(e.get_dy()-e.get_y())*(t.get_dx()-t.get_x())-(e.get_dx()-e.get_x())*(t.get_dy()-t.get_y());null!=(jt=Math.abs(Ht)<=1e-5?null:(rt=((e.get_dx()-e.get_x())*(t.get_y()-e.get_y())-(e.get_dy()-e.get_y())*(t.get_x()-e.get_x()))/Ht,it=((t.get_dx()-t.get_x())*(t.get_y()-e.get_y())-(t.get_dy()-t.get_y())*(t.get_x()-e.get_x()))/Ht,rt<0||1<rt||it<0||1<it?null:(et=t.start,nt=t.end,ot=t.start,lt=nt.x,at=st=nt.y,dt=_t=(_t=lt)-ot.x,yt=at=st-ot.y,dt=_t*rt,yt=at*rt,ct=(ct=et.x)+dt,ht=(ht=et.y)+yt,ft=(ft=(ut=t.start).x)-ct,vt=(vt=ut.y)-ht,mt=Math.sqrt(ft*ft+vt*vt),pt=t.end,xt=(gt=t.start).x,bt=wt=gt.y,It=(It=xt)-pt.x,bt=wt-pt.y,Pt=Math.sqrt(It*It+bt*bt)-mt,St=0<=Ht,Tt=e.end,Mt=(Et=e.start).x,Rt=Ot=Et.y,Xt=(Xt=Mt)-Tt.x,Rt=Ot-Tt.y,At=Math.sqrt(Xt*Xt+Rt*Rt)*(St?-1:1),kt=(e.get_dy()-e.get_y())/At,Lt=-(e.get_dx()-e.get_x())/At,(Ft=ar.norm).x=kt,Ft.y=Lt,Ct=ar.norm.x,qt=ar.norm.y,null==(Gt=St)&&(Gt=!1),(Dt=Bt._pool.get()).line=null,Dt.shape=null,Nt=Gt,(Dt.line2=null)==Nt&&(Nt=!1),Dt.distance=mt,Dt.overlap=Pt,Dt.inverse_normal=Nt,(Ut=Dt.hit).x=ct,Ut.y=ht,(zt=Dt.normal).x=Ct,zt.y=qt,Dt.pooled=!1,Dt.line=t,Dt.line2=e,Dt)))&&(null==i||i.distance>jt.distance)&&(i=jt)}return null!=i&&(i.line=t,i.shape=r),i},ar.rect_and_rect=function(t,r,i){null==i&&(i=!1);var e=null,n=t.transform;if(0!=(null==n.parent?n.local_rotation:(n.sync(),n._rotation))||0!=(null==(n=r.transform).parent?n.local_rotation:(n.sync(),n._rotation))){if(null!=t.transformed_rect)return null==(e=ar.rect_and_polygon(r,t.transformed_rect,i))?null:(i?e.sa=t:e.sb=t,e);if(null!=r.transformed_rect)return null==(e=ar.rect_and_polygon(t,r.transformed_rect,!i))?null:(i?e.sa=r:e.sb=r,e)}var o,l,s,_=i?r:t,a=i?t:r,d=null==(n=a.transform).parent?n.local_x:(n.sync(),n._x),y=null==(n=_.transform).parent?n.local_x:(n.sync(),n._x),c=d-y,h=null==(n=a.transform).parent?n.local_y:(n.sync(),n._y),u=null==(n=_.transform).parent?n.local_y:(n.sync(),n._y),f=h-u,v=_.ex+a.ex-Math.abs(c);return 0<v&&(0<(o=_.ey+a.ey-Math.abs(f))&&((e=(v<o?((l=Ur._pool.get()).sa=null,l.sb=null,l.overlap=v,(s=l.normal).x=c<0?-1:1,s.y=0):((l=Ur._pool.get()).sa=null,l.sb=null,l.overlap=o,(s=l.normal).x=0,s.y=f<0?-1:1),l.pooled=!1,l)).sa=_,e.sb=a)),e},ar.circle_and_circle=function(t,r,i){null==i&&(i=!1);var e,n,o,l=i?r:t,s=i?t:r,_=s.transform,a=null==_.parent?_.local_x:(_.sync(),_._x),d=null==(_=l.transform).parent?_.local_x:(_.sync(),_._x),y=a-d,c=null==(_=s.transform).parent?_.local_y:(_.sync(),_._y),h=null==(_=l.transform).parent?_.local_y:(_.sync(),_._y),u=c-h,f=l.local_radius,v=null==(_=l.transform).parent?_.local_scale_x:(_.sync(),_._scale_x),m=s.local_radius,p=null==(_=s.transform).parent?_.local_scale_x:(_.sync(),_._scale_x),g=f*v+m*p,x=y*y+u*u,w=null;return g*g<=x||((w=(Math.abs(x)<=1e-5?(f=l.local_radius,e=null==(_=l.transform).parent?_.local_scale_x:(_.sync(),_._scale_x),(n=Ur._pool.get()).sa=null,n.sb=null,n.overlap=f*e,(o=n.normal).x=1,o.y=0):(y/=x=Math.sqrt(x),u/=x,(n=Ur._pool.get()).sa=null,n.sb=null,n.overlap=g-x,(o=n.normal).x=y,o.y=u),n.pooled=!1,n)).sa=l,w.sb=s),w},ar.polygon_and_polygon=function(t,r,i){null==i&&(i=!1);var e=ar.check_polygons(t,r,i);if(null==e)return null;var n=ar.check_polygons(r,t,!i);return null==n?null:(e.overlap<0&&(e.overlap=Math.abs(e.overlap)),n.overlap<0&&(n.overlap=Math.abs(n.overlap)),e.overlap<n.overlap?(n.put(),e):(e.put(),n))},ar.rect_and_circle=function(t,r,i){var e,n;if(null==i&&(i=!1),null!=t.transformed_rect&&0!=(null==(d=t.transform).parent?d.local_rotation:(d.sync(),d._rotation))){var o=ar.circle_and_polygon(r,t.transformed_rect,i);return null==o?null:(i?o.sa=t:o.sb=t,o)}var l=e=i?(null==(d=r.transform).parent?d.local_x:(d.sync(),d._x))-(null==(d=t.transform).parent?d.local_x:(d.sync(),d._x)):(null==(d=t.transform).parent?d.local_x:(d.sync(),d._x))-(null==(d=r.transform).parent?d.local_x:(d.sync(),d._x)),s=n=i?(null==(d=r.transform).parent?d.local_y:(d.sync(),d._y))-(null==(d=t.transform).parent?d.local_y:(d.sync(),d._y)):(null==(d=t.transform).parent?d.local_y:(d.sync(),d._y))-(null==(d=r.transform).parent?d.local_y:(d.sync(),d._y)),_=-t.ex,a=t.ex;l<_?l=_:a<l&&(l=a);_=-t.ey,a=t.ey;s<_?s=_:a<s&&(s=a);var d,y=!1,c=r.local_radius,h=null==(d=r.transform).parent?d.local_scale_x:(d.sync(),d._scale_x),u=c*h;Math.abs(e-l)<=1e-5&&Math.abs(n-s)<=1e-5&&(y=!0,Math.abs(e)>Math.abs(n)?l=0<l?t.ex+u+.1:-t.ex-u-.1:s=0<s?t.ey+u+.1:-t.ey-u-.1);var f=(e-=l)*e+(n-=s)*n;if(u*u<f&&!y)return null;e/=f=Math.sqrt(f),n/=f,y&&(e*=-1,n*=-1);var v=Math.abs(u-f);(c=Ur._pool.get()).sa=null,c.sb=null,c.overlap=v;var m=c.normal;return m.x=e,m.y=n,c.pooled=!1,c.sa=i?r:t,c.sb=i?t:r,c},ar.rect_and_polygon=function(t,r,i){null==i&&(i=!1);var e=null;if(null!=t.transformed_rect)e=ar.polygon_and_polygon(t.transformed_rect,r,i);else{var n=J._pool.get();n.count=4;for(var o=0,l=n.count;o<l;){var s=o++;null==n.local_vertices[s]&&(n.local_vertices[s]=new hi(0,0))}var _=n.local_vertices[0];_.x=-t.ex,_.y=-t.ey,(_=n.local_vertices[1]).x=t.ex,_.y=-t.ey,(_=n.local_vertices[2]).x=t.ex,_.y=t.ey,(_=n.local_vertices[3]).x=-t.ex,_.y=t.ey;var a=t.transform.local_x,d=n.transform;if(!d.dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(o=0,l=d.children;o<l.length;){var y=l[o];++o,y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(var c=0,h=y.children;c<h.length;)h[c++].set_dirty(!0);null!=y.on_dirty&&y.on_dirty(y)}null!=d.on_dirty&&d.on_dirty(d)}d.local_x=a;a=t.transform.local_y;if(!(d=n.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(o=0,l=d.children;o<l.length;){y=l[o];++o,y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(c=0,h=y.children;c<h.length;)h[c++].set_dirty(!0);null!=y.on_dirty&&y.on_dirty(y)}null!=d.on_dirty&&d.on_dirty(d)}d.local_y=a;a=t.transform.local_rotation;if(!(d=n.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(o=0,l=d.children;o<l.length;){y=l[o];++o,y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(c=0,h=y.children;c<h.length;)h[c++].set_dirty(!0);null!=y.on_dirty&&y.on_dirty(y)}null!=d.on_dirty&&d.on_dirty(d)}d.local_rotation=a;a=t.transform.local_scale_x;if(!(d=n.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(o=0,l=d.children;o<l.length;){y=l[o];++o,y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(c=0,h=y.children;c<h.length;)h[c++].set_dirty(!0);null!=y.on_dirty&&y.on_dirty(y)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_x=a;a=t.transform.local_scale_y;if(!(d=n.transform).dirty){d.dirty=d.inverse_dirty=d.coordinates_dirty=!0;for(o=0,l=d.children;o<l.length;){y=l[o];++o,y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(c=0,h=y.children;c<h.length;)h[c++].set_dirty(!0);null!=y.on_dirty&&y.on_dirty(y)}null!=d.on_dirty&&d.on_dirty(d)}d.local_scale_y=a,n.dirty_vertices=!0,n.dirty_bounds=!0,n.pooled=!1,n.set_parent(t.parent),e=ar.polygon_and_polygon(n,r,i),n.put()}return null==e?null:(i?e.sb=t:e.sa=t,e)},ar.circle_and_polygon=function(t,r,i){null==i&&(i=!1);var e=0,n=1073741823,o=t.transform;o.sync();for(var l=o._x,s=o._y,_=t.local_radius,a=null==(o=t.transform).parent?o.local_scale_x:(o.sync(),o._scale_x),d=_*a,y=0,c=r.count;y<c;){var h=y++;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(var u=0,f=r.count;u<f;){var v=u++;null!=r.local_vertices[v]&&(null==r._vertices[v]&&(r._vertices[v]=new hi(0,0)),st=r.local_vertices[v].x,null==(_t=r.local_vertices[v].y)&&(_t=0),null==st&&(st=0),V=r.transform.get_local_to_world_matrix(),dt=st,yt=_t,ct=1,(K=r._vertices[v]).x=V.m00*dt+V.m10*yt+V.m20*ct,K.y=V.m01*dt+V.m11*yt+V.m21*ct)}for(var m=0,p=r.count;m<p;){var g=m++,x=r.sync_pos,w=r._vertices[(g+1)%r.count];x.x=w.x,x.y=w.y;var I=r._vertices[g];(tt=r.sync_pos).x-=I.x,tt.y-=I.y,null==r._normals[g]?r._normals[g]=new hi(-r.sync_pos.y,r.sync_pos.x):(ut=r.sync_pos.x,(ht=r._normals[g]).x=-r.sync_pos.y,ht.y=ut);var b=r._normals[g];0<(ft=Math.sqrt(b.x*b.x+b.y*b.y))&&(b.x/=ft,b.y/=ft)}}var P=l,S=s;if((e=(P=l-(Z=r._vertices[h]).x)*P+(S=s-Z.y)*S)<n){if(n=e,r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(var T=0,E=r.count;T<E;){var M=T++;null!=r.local_vertices[M]&&(null==r._vertices[M]&&(r._vertices[M]=new hi(0,0)),vt=r.local_vertices[M].x,null==(mt=r.local_vertices[M].y)&&(mt=0),null==vt&&(vt=0),pt=r.transform.get_local_to_world_matrix(),gt=vt,xt=mt,wt=1,(rt=r._vertices[M]).x=pt.m00*gt+pt.m10*xt+pt.m20*wt,rt.y=pt.m01*gt+pt.m11*xt+pt.m21*wt)}for(var O=0,X=r.count;O<X;){var R=O++,A=r.sync_pos,k=r._vertices[(R+1)%r.count];A.x=k.x,A.y=k.y;var L=r._vertices[R];(It=r.sync_pos).x-=L.x,It.y-=L.y,null==r._normals[R]?r._normals[R]=new hi(-r.sync_pos.y,r.sync_pos.x):(Pt=r.sync_pos.x,(bt=r._normals[R]).x=-r.sync_pos.y,bt.y=Pt);var F=r._normals[R];0<(St=Math.sqrt(F.x*F.x+F.y*F.y))&&(F.x/=St,F.y/=St)}}var C=r._vertices[h].x;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(var q=0,G=r.count;q<G;){var D=q++;null!=r.local_vertices[D]&&(null==r._vertices[D]&&(r._vertices[D]=new hi(0,0)),Mt=r.local_vertices[D].x,null==(Et=r.local_vertices[D].y)&&(Et=0),null==Mt&&(Mt=0),Xt=r.transform.get_local_to_world_matrix(),Rt=Mt,At=Et,kt=1,(Tt=r._vertices[D]).x=Xt.m00*Rt+Xt.m10*At+Xt.m20*kt,Tt.y=Xt.m01*Rt+Xt.m11*At+Xt.m21*kt)}for(var N=0,U=r.count;N<U;){var z=N++,j=r.sync_pos,H=r._vertices[(z+1)%r.count];j.x=H.x,j.y=H.y;var W=r._vertices[z];(Lt=r.sync_pos).x-=W.x,Lt.y-=W.y,null==r._normals[z]?r._normals[z]=new hi(-r.sync_pos.y,r.sync_pos.x):(Ot=r.sync_pos.x,(Ft=r._normals[z]).x=-r.sync_pos.y,Ft.y=Ot);var B=r._normals[z];0<(Ct=Math.sqrt(B.x*B.x+B.y*B.y))&&(B.x/=Ct,B.y/=Ct)}}var J=r._vertices[h].y;(qt=ar.closest).x=C,qt.y=J}}var K=ar.closest;(w=new hi(K.x,K.y)).x-=l,w.y-=s;K=w;0<(ft=Math.sqrt(K.x*K.x+K.y*K.y))&&(K.x/=ft,K.y/=ft);var Y=0;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(y=0,c=r.count;y<c;){h=y++;null!=r.local_vertices[h]&&(null==r._vertices[h]&&(r._vertices[h]=new hi(0,0)),st=r.local_vertices[h].x,null==(_t=r.local_vertices[h].y)&&(_t=0),null==st&&(st=0),V=r.transform.get_local_to_world_matrix(),dt=st,yt=_t,ct=1,(w=r._vertices[h]).x=V.m00*dt+V.m10*yt+V.m20*ct,w.y=V.m01*dt+V.m11*yt+V.m21*ct)}for(y=0,c=r.count;y<c;){h=y++,x=r.sync_pos,w=r._vertices[(h+1)%r.count];x.x=w.x,x.y=w.y;var V=r._vertices[h];(tt=r.sync_pos).x-=V.x,tt.y-=V.y,null==r._normals[h]?r._normals[h]=new hi(-r.sync_pos.y,r.sync_pos.x):(_t=r.sync_pos.x,(ht=r._normals[h]).x=-r.sync_pos.y,ht.y=_t);b=r._normals[h];0<(ft=Math.sqrt(b.x*b.x+b.y*b.y))&&(b.x/=ft,b.y/=ft)}}for(var Z=r._vertices[0],$=Gt=K.x*Z.x+K.y*Z.y,y=1,c=r.count;y<c;){var Q=y++;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(u=0,f=r.count;u<f;){h=u++;null!=r.local_vertices[h]&&(null==r._vertices[h]&&(r._vertices[h]=new hi(0,0)),st=r.local_vertices[h].x,null==(_t=r.local_vertices[h].y)&&(_t=0),null==st&&(st=0),V=r.transform.get_local_to_world_matrix(),dt=st,yt=_t,ct=1,(w=r._vertices[h]).x=V.m00*dt+V.m10*yt+V.m20*ct,w.y=V.m01*dt+V.m11*yt+V.m21*ct)}for(m=0,p=r.count;m<p;){var v=m++,x=r.sync_pos,tt=r._vertices[(v+1)%r.count];x.x=tt.x,x.y=tt.y;I=r._vertices[v];(ht=r.sync_pos).x-=I.x,ht.y-=I.y,null==r._normals[v]?r._normals[v]=new hi(-r.sync_pos.y,r.sync_pos.x):(ut=r.sync_pos.x,(b=r._normals[v]).x=-r.sync_pos.y,b.y=ut);var rt=r._normals[v];0<(ft=Math.sqrt(rt.x*rt.x+rt.y*rt.y))&&(rt.x/=ft,rt.y/=ft)}}Z=r._vertices[Q];(Y=K.x*Z.x+K.y*Z.y)<Gt&&(Gt=Y),$<Y&&($=Y)}var it=-d,et=K.x*-l+K.y*-s,nt=(Gt+=et)-d,ot=it-($+=et);if(0<nt||0<ot)return null;var lt=-(d-Gt);i&&(lt*=-1);var st=K.x,_t=K.y;(_=Ur._pool.get()).sa=null,_.sb=null,_.overlap=lt,(w=_.normal).x=st,w.y=_t,_.pooled=!1;for(var at=Math.abs(lt),y=0,c=r.count;y<c;){h=y++;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(u=0,f=r.count;u<f;){var dt,yt,ct,v=u++;null!=r.local_vertices[v]&&(null==r._vertices[v]&&(r._vertices[v]=new hi(0,0)),st=r.local_vertices[v].x,null==(_t=r.local_vertices[v].y)&&(_t=0),null==st&&(st=0),V=r.transform.get_local_to_world_matrix(),dt=st,yt=_t,ct=1,(w=r._vertices[v]).x=V.m00*dt+V.m10*yt+V.m20*ct,w.y=V.m01*dt+V.m11*yt+V.m21*ct)}for(m=0,p=r.count;m<p;){g=m++,x=r.sync_pos,tt=r._vertices[(g+1)%r.count];x.x=tt.x,x.y=tt.y;var ht,ut,I=r._vertices[g];(ht=r.sync_pos).x-=I.x,ht.y-=I.y,null==r._normals[g]?r._normals[g]=new hi(-r.sync_pos.y,r.sync_pos.x):(ut=r.sync_pos.x,(b=r._normals[g]).x=-r.sync_pos.y,b.y=ut);var ft,rt=r._normals[g];0<(ft=Math.sqrt(rt.x*rt.x+rt.y*rt.y))&&(rt.x/=ft,rt.y/=ft)}}var vt=r._normals[h].x;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(T=0,E=r.count;T<E;){var mt,pt,gt,xt,wt,M=T++;null!=r.local_vertices[M]&&(null==r._vertices[M]&&(r._vertices[M]=new hi(0,0)),C=r.local_vertices[M].x,null==(mt=r.local_vertices[M].y)&&(mt=0),null==C&&(C=0),pt=r.transform.get_local_to_world_matrix(),gt=C,xt=mt,wt=1,(k=r._vertices[M]).x=pt.m00*gt+pt.m10*xt+pt.m20*wt,k.y=pt.m01*gt+pt.m11*xt+pt.m21*wt)}for(O=0,X=r.count;O<X;){var R=O++,A=r.sync_pos,It=r._vertices[(R+1)%r.count];A.x=It.x,A.y=It.y;var bt,Pt,L=r._vertices[R];(bt=r.sync_pos).x-=L.x,bt.y-=L.y,null==r._normals[R]?r._normals[R]=new hi(-r.sync_pos.y,r.sync_pos.x):(Pt=r.sync_pos.x,(F=r._normals[R]).x=-r.sync_pos.y,F.y=Pt);var St,Tt=r._normals[R];0<(St=Math.sqrt(Tt.x*Tt.x+Tt.y*Tt.y))&&(Tt.x/=St,Tt.y/=St)}}var Et=r._normals[h].y;if(K.x=vt,K.y=Et,r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(q=0,G=r.count;q<G;){var Mt,Ot,Xt,Rt,At,kt,D=q++;null!=r.local_vertices[D]&&(null==r._vertices[D]&&(r._vertices[D]=new hi(0,0)),Mt=r.local_vertices[D].x,null==(Ot=r.local_vertices[D].y)&&(Ot=0),null==Mt&&(Mt=0),Xt=r.transform.get_local_to_world_matrix(),Rt=Mt,At=Ot,kt=1,(H=r._vertices[D]).x=Xt.m00*Rt+Xt.m10*At+Xt.m20*kt,H.y=Xt.m01*Rt+Xt.m11*At+Xt.m21*kt)}for(N=0,U=r.count;N<U;){var z=N++,j=r.sync_pos,Lt=r._vertices[(z+1)%r.count];j.x=Lt.x,j.y=Lt.y;var Ft,W=r._vertices[z];(Ft=r.sync_pos).x-=W.x,Ft.y-=W.y,null==r._normals[z]?r._normals[z]=new hi(-r.sync_pos.y,r.sync_pos.x):(J=r.sync_pos.x,(B=r._normals[z]).x=-r.sync_pos.y,B.y=J);var Ct,qt=r._normals[z];0<(Ct=Math.sqrt(qt.x*qt.x+qt.y*qt.y))&&(qt.x/=Ct,qt.y/=Ct)}}for(var Gt,Dt,Z=r._vertices[0],$=Gt=K.x*Z.x+K.y*Z.y,Nt=1,Ut=r.count;Nt<Ut;){Q=Nt++;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(var zt=0,jt=r.count;zt<jt;){var Ht,Wt,Bt,Jt,Kt,Yt,Vt=zt++;null!=r.local_vertices[Vt]&&(null==r._vertices[Vt]&&(r._vertices[Vt]=new hi(0,0)),Ht=r.local_vertices[Vt].x,null==(Wt=r.local_vertices[Vt].y)&&(Wt=0),null==Ht&&(Ht=0),Bt=r.transform.get_local_to_world_matrix(),Jt=Ht,Kt=Wt,(Yt=r._vertices[Vt]).x=Bt.m00*Jt+Bt.m10*Kt+ +Bt.m20,Yt.y=Bt.m01*Jt+Bt.m11*Kt+ +Bt.m21)}for(var Zt=0,$t=r.count;Zt<$t;){var Qt=Zt++,tr=r.sync_pos,rr=r._vertices[(1+Qt)%r.count];tr.x=rr.x,tr.y=rr.y;var ir,er,nr=r._vertices[Qt],or=r.sync_pos;or.x-=nr.x,or.y-=nr.y,null==r._normals[Qt]?r._normals[Qt]=new hi(-r.sync_pos.y,r.sync_pos.x):(ir=r.sync_pos.x,(er=r._normals[Qt]).x=-r.sync_pos.y,er.y=ir);var lr=r._normals[Qt],sr=Math.sqrt(lr.x*lr.x+lr.y*lr.y);0<sr&&(lr.x/=sr,lr.y/=sr)}}var _r=r._vertices[Q];(Y=K.x*_r.x+K.y*_r.y)<Gt&&(Gt=Y),$<Y&&($=Y)}if(ot=-d-($+=et=K.x*-l+K.y*-s),0<(Gt+=et)-d||0<ot)return _.put(),null;lt=-(d-Gt),i&&(lt*=-1),Math.abs(lt)<at&&((Dt=_.normal).x=K.x,Dt.y=K.y,_.overlap=lt,at=Math.abs(lt))}return _.sa=i?r:t,_.sb=i?t:r,_.overlap=Math.abs(_.overlap),i&&((K=_.normal).x=-K.x,K.y=-K.y),_},ar.check_polygons=function(t,r,i){null==i&&(i=!1);for(var e=0,n=0,o=0,l=0,s=0,_=1073741823,a=null,d=0,y=t.count;d<y;){var c=d++;if(t.dirty_vertices){for(t.dirty_vertices=!1;t._vertices.length>t.count;)t._vertices.pop();for(var h=0,u=t.count;h<u;){var f,v,m,p,g,x,w=h++;null!=t.local_vertices[w]&&(null==t._vertices[w]&&(t._vertices[w]=new hi(0,0)),f=t.local_vertices[w].x,null==(v=t.local_vertices[w].y)&&(v=0),null==f&&(f=0),m=t.transform.get_local_to_world_matrix(),p=f,g=v,(x=t._vertices[w]).x=m.m00*p+m.m10*g+ +m.m20,x.y=m.m01*p+m.m11*g+ +m.m21)}for(var I=0,b=t.count;I<b;){var P=I++,S=t.sync_pos,T=t._vertices[(1+P)%t.count];S.x=T.x,S.y=T.y;var E,M,O=t._vertices[P],X=t.sync_pos;X.x-=O.x,X.y-=O.y,null==t._normals[P]?t._normals[P]=new hi(-t.sync_pos.y,t.sync_pos.x):(E=t.sync_pos.x,(M=t._normals[P]).x=-t.sync_pos.y,M.y=E);var R=t._normals[P],A=Math.sqrt(R.x*R.x+R.y*R.y);0<A&&(R.x/=A,R.y/=A)}}var k=t._normals[c].x;if(t.dirty_vertices){for(t.dirty_vertices=!1;t._vertices.length>t.count;)t._vertices.pop();for(var L=0,F=t.count;L<F;){var C,q,G,D,N,U,z=L++;null!=t.local_vertices[z]&&(null==t._vertices[z]&&(t._vertices[z]=new hi(0,0)),C=t.local_vertices[z].x,null==(q=t.local_vertices[z].y)&&(q=0),null==C&&(C=0),G=t.transform.get_local_to_world_matrix(),D=C,N=q,(U=t._vertices[z]).x=G.m00*D+G.m10*N+ +G.m20,U.y=G.m01*D+G.m11*N+ +G.m21)}for(var j=0,H=t.count;j<H;){var W=j++,B=t.sync_pos,J=t._vertices[(1+W)%t.count];B.x=J.x,B.y=J.y;var K,Y,V=t._vertices[W],Z=t.sync_pos;Z.x-=V.x,Z.y-=V.y,null==t._normals[W]?t._normals[W]=new hi(-t.sync_pos.y,t.sync_pos.x):(K=t.sync_pos.x,(Y=t._normals[W]).x=-t.sync_pos.y,Y.y=K);var $=t._normals[W],Q=Math.sqrt($.x*$.x+$.y*$.y);0<Q&&($.x/=Q,$.y/=Q)}}var tt=t._normals[c].y;if(t.dirty_vertices){for(t.dirty_vertices=!1;t._vertices.length>t.count;)t._vertices.pop();for(var rt=0,it=t.count;rt<it;){var et,nt,ot,lt,st,_t,at=rt++;null!=t.local_vertices[at]&&(null==t._vertices[at]&&(t._vertices[at]=new hi(0,0)),et=t.local_vertices[at].x,null==(nt=t.local_vertices[at].y)&&(nt=0),null==et&&(et=0),ot=t.transform.get_local_to_world_matrix(),lt=et,st=nt,(_t=t._vertices[at]).x=ot.m00*lt+ot.m10*st+ +ot.m20,_t.y=ot.m01*lt+ot.m11*st+ +ot.m21)}for(var dt=0,yt=t.count;dt<yt;){var ct=dt++,ht=t.sync_pos,ut=t._vertices[(1+ct)%t.count];ht.x=ut.x,ht.y=ut.y;var ft,vt,mt=t._vertices[ct],pt=t.sync_pos;pt.x-=mt.x,pt.y-=mt.y,null==t._normals[ct]?t._normals[ct]=new hi(-t.sync_pos.y,t.sync_pos.x):(ft=t.sync_pos.x,(vt=t._normals[ct]).x=-t.sync_pos.y,vt.y=ft);var gt=t._normals[ct],xt=Math.sqrt(gt.x*gt.x+gt.y*gt.y);0<xt&&(gt.x/=xt,gt.y/=xt)}}for(var wt=t._vertices[0],o=n=k*wt.x+tt*wt.y,It=1,bt=t.count;It<bt;){var Pt=It++;if(t.dirty_vertices){for(t.dirty_vertices=!1;t._vertices.length>t.count;)t._vertices.pop();for(var St=0,Tt=t.count;St<Tt;){var Et,Mt,Ot,Xt,Rt,At,kt=St++;null!=t.local_vertices[kt]&&(null==t._vertices[kt]&&(t._vertices[kt]=new hi(0,0)),Et=t.local_vertices[kt].x,null==(Mt=t.local_vertices[kt].y)&&(Mt=0),null==Et&&(Et=0),Ot=t.transform.get_local_to_world_matrix(),Xt=Et,Rt=Mt,(At=t._vertices[kt]).x=Ot.m00*Xt+Ot.m10*Rt+ +Ot.m20,At.y=Ot.m01*Xt+Ot.m11*Rt+ +Ot.m21)}for(var Lt=0,Ft=t.count;Lt<Ft;){var Ct=Lt++,qt=t.sync_pos,Gt=t._vertices[(1+Ct)%t.count];qt.x=Gt.x,qt.y=Gt.y;var Dt,Nt,Ut=t._vertices[Ct],zt=t.sync_pos;zt.x-=Ut.x,zt.y-=Ut.y,null==t._normals[Ct]?t._normals[Ct]=new hi(-t.sync_pos.y,t.sync_pos.x):(Dt=t.sync_pos.x,(Nt=t._normals[Ct]).x=-t.sync_pos.y,Nt.y=Dt);var jt=t._normals[Ct],Ht=Math.sqrt(jt.x*jt.x+jt.y*jt.y);0<Ht&&(jt.x/=Ht,jt.y/=Ht)}}var Wt=t._vertices[Pt];(e=k*Wt.x+tt*Wt.y)<n&&(n=e),o<e&&(o=e)}if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(var Bt=0,Jt=r.count;Bt<Jt;){var Kt,Yt,Vt,Zt,$t,Qt,tr=Bt++;null!=r.local_vertices[tr]&&(null==r._vertices[tr]&&(r._vertices[tr]=new hi(0,0)),Kt=r.local_vertices[tr].x,null==(Yt=r.local_vertices[tr].y)&&(Yt=0),null==Kt&&(Kt=0),Vt=r.transform.get_local_to_world_matrix(),Zt=Kt,$t=Yt,(Qt=r._vertices[tr]).x=Vt.m00*Zt+Vt.m10*$t+ +Vt.m20,Qt.y=Vt.m01*Zt+Vt.m11*$t+ +Vt.m21)}for(var rr=0,ir=r.count;rr<ir;){var er=rr++,nr=r.sync_pos,or=r._vertices[(1+er)%r.count];nr.x=or.x,nr.y=or.y;var lr,sr,_r=r._vertices[er],ar=r.sync_pos;ar.x-=_r.x,ar.y-=_r.y,null==r._normals[er]?r._normals[er]=new hi(-r.sync_pos.y,r.sync_pos.x):(lr=r.sync_pos.x,(sr=r._normals[er]).x=-r.sync_pos.y,sr.y=lr);var dr=r._normals[er],yr=Math.sqrt(dr.x*dr.x+dr.y*dr.y);0<yr&&(dr.x/=yr,dr.y/=yr)}}for(var cr=r._vertices[0],s=l=k*cr.x+tt*cr.y,hr=1,ur=r.count;hr<ur;){var fr=hr++;if(r.dirty_vertices){for(r.dirty_vertices=!1;r._vertices.length>r.count;)r._vertices.pop();for(var vr=0,mr=r.count;vr<mr;){var pr,gr,xr,wr,Ir,br,Pr=vr++;null!=r.local_vertices[Pr]&&(null==r._vertices[Pr]&&(r._vertices[Pr]=new hi(0,0)),pr=r.local_vertices[Pr].x,null==(gr=r.local_vertices[Pr].y)&&(gr=0),null==pr&&(pr=0),xr=r.transform.get_local_to_world_matrix(),wr=pr,Ir=gr,(br=r._vertices[Pr]).x=xr.m00*wr+xr.m10*Ir+ +xr.m20,br.y=xr.m01*wr+xr.m11*Ir+ +xr.m21)}for(var Sr=0,Tr=r.count;Sr<Tr;){var Er=Sr++,Mr=r.sync_pos,Or=r._vertices[(1+Er)%r.count];Mr.x=Or.x,Mr.y=Or.y;var Xr,Rr,Ar=r._vertices[Er],kr=r.sync_pos;kr.x-=Ar.x,kr.y-=Ar.y,null==r._normals[Er]?r._normals[Er]=new hi(-r.sync_pos.y,r.sync_pos.x):(Xr=r.sync_pos.x,(Rr=r._normals[Er]).x=-r.sync_pos.y,Rr.y=Xr);var Lr=r._normals[Er],Fr=Math.sqrt(Lr.x*Lr.x+Lr.y*Lr.y);0<Fr&&(Lr.x/=Fr,Lr.y/=Fr)}}var Cr=r._vertices[fr];(e=k*Cr.x+tt*Cr.y)<l&&(l=e),s<e&&(s=e)}if(0<n-s||0<l-o)return null;var qr,Gr,Dr,Nr=-(s-n);i&&(Nr*=-1),Math.abs(Nr)<_&&(null==a?((qr=Ur._pool.get()).sa=null,qr.sb=null,qr.overlap=Nr,(Gr=qr.normal).x=k,Gr.y=tt,qr.pooled=!1,a=qr):(a.overlap=Nr,(Dr=a.normal).x=k,Dr.y=tt),_=Math.abs(Nr))}return null==a?null:(a.sa=i?r:t,a.sb=i?t:r,i&&((x=a.normal).x=-x.x,x.y=-x.y),a)};var S=h["echo.util.SlopeDirection"]={__ename__:!0,__constructs__:null,TopLeft:{_hx_name:"TopLeft",_hx_index:0,__enum__:"echo.util.SlopeDirection",toString:r},TopRight:{_hx_name:"TopRight",_hx_index:1,__enum__:"echo.util.SlopeDirection",toString:r},BottomLeft:{_hx_name:"BottomLeft",_hx_index:2,__enum__:"echo.util.SlopeDirection",toString:r},BottomRight:{_hx_name:"BottomRight",_hx_index:3,__enum__:"echo.util.SlopeDirection",toString:r}};S.__constructs__=[S.TopLeft,S.TopRight,S.BottomLeft,S.BottomRight],S.__empty_constructs__=[S.TopLeft,S.TopRight,S.BottomLeft,S.BottomRight];var T=h["echo.util.SlopeAngle"]={__ename__:!0,__constructs__:null,Gentle:{_hx_name:"Gentle",_hx_index:0,__enum__:"echo.util.SlopeAngle",toString:r},Sharp:{_hx_name:"Sharp",_hx_index:1,__enum__:"echo.util.SlopeAngle",toString:r}};T.__constructs__=[T.Gentle,T.Sharp],T.__empty_constructs__=[T.Gentle,T.Sharp];var E=h["echo.util.SlopeSize"]={__ename__:!0,__constructs__:null,Thick:{_hx_name:"Thick",_hx_index:0,__enum__:"echo.util.SlopeSize",toString:r},Thin:{_hx_name:"Thin",_hx_index:1,__enum__:"echo.util.SlopeSize",toString:r}};E.__constructs__=[E.Thick,E.Thin],E.__empty_constructs__=[E.Thick,E.Thin];function M(){}M.__name__=!0,M.generate=function(t,g,x,r,i,w,I,u,e,f){null==u&&(u=1),null==I&&(I=0),null==w&&(w=0);for(var v=function(t){if(null==e||0==e.length)return null;for(var r=0;r<e.length;){var i=e[r];if(++r,i.index==t)return i}return null},n=[],o=[],l=0,s=t.length;l<s;){var _=l++;null==o[a=Math.floor(_/r)]&&(o[a]=[]),o[a][_%r]=t[_]}for(l=0,s=o.length;l<s;)for(var a,d=0,y=o[a=l++].length;d<y;){var c,h,m=d++,_=o[a][m];u<=_&&!(null!=f&&-1<f.indexOf(_))&&((h=null==(c=v(_))?function(t,r,i){i[r][t]=-1;for(var e=1,n=t+1,o=i[r].length;n<o;){var l=n++,s=i[r][l];if(!(u<=s&&null==v(s))||null!=f&&-1<f.indexOf(s))break;++e,i[r][l]=-1}for(var _=r+1,a=1,d=!1;_<i.length-1;)if(d)_=i.length;else{for(n=0,o=e;n<o;){var y=i[_][n+++t];(null!=v(y)||y<u||null!=f&&-1<f.indexOf(y))&&(d=!0)}if(!d){for(var c=0,h=e;c<h;)i[_][c+++t]=-1;++a}++_}return new j({x:t*g+g*e*.5+w,y:r*x+x*a*.5+I,mass:0,shape:{type:0,width:g*e,height:x*a}})}(m,a,o):function(t,r,i,e){e[r][t]=-1;var n=null;if(null!=i.custom_shape)n=G.get(i.custom_shape);else if(null!=i.slope_direction)switch(i.slope_direction._hx_index){case 0:if(null!=i.slope_shape)switch(i.slope_shape.angle._hx_index){case 0:switch(i.slope_shape.size._hx_index){case 0:var o=[new hi(0,.5*x),new hi(g,0),new hi(g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(var y=0,c=p.children;y<c.length;){var h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(var u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;var v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m;break;case 1:o=[new hi(g,.5*x),new hi(g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}break;case 1:switch(i.slope_shape.size._hx_index){case 0:o=[new hi(.5*g,0),new hi(g,0),new hi(g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m;break;case 1:o=[new hi(g,0),new hi(g,x),new hi(.5*g,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}}else{o=[new hi(g,0),new hi(g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}break;case 1:if(null!=i.slope_shape)switch(i.slope_shape.angle._hx_index){case 0:switch(i.slope_shape.size._hx_index){case 0:o=[new hi(0,0),new hi(g,.5*x),new hi(g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m;break;case 1:o=[new hi(0,.5*x),new hi(g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}break;case 1:switch(i.slope_shape.size._hx_index){case 0:o=[new hi(0,0),new hi(.5*g,0),new hi(g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m;break;case 1:o=[new hi(0,0),new hi(.5*g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}}else{o=[new hi(0,0),new hi(g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}break;case 2:if(null!=i.slope_shape)switch(i.slope_shape.angle._hx_index){case 0:switch(i.slope_shape.size._hx_index){case 0:o=[new hi(0,0),new hi(g,0),new hi(g,x),new hi(0,.5*x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m;break;case 1:o=[new hi(0,0),new hi(g,0),new hi(g,.5*x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}break;case 1:switch(i.slope_shape.size._hx_index){case 0:o=[new hi(0,0),new hi(g,0),new hi(g,x),new hi(.5*g,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m;break;case 1:o=[new hi(.5*g,0),new hi(g,0),new hi(g,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}}else{o=[new hi(0,0),new hi(g,0),new hi(g,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}break;case 3:if(null!=i.slope_shape)switch(i.slope_shape.angle._hx_index){case 0:switch(i.slope_shape.size._hx_index){case 0:o=[new hi(0,0),new hi(g,0),new hi(g,.5*x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m;break;case 1:o=[new hi(0,0),new hi(g,0),new hi(0,.5*x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}break;case 1:switch(i.slope_shape.size._hx_index){case 0:o=[new hi(0,0),new hi(g,0),new hi(.5*g,x),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m;break;case 1:o=[new hi(0,0),new hi(.5*g,0),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}}else{var m,p,o=[new hi(0,0),new hi(g,0),new hi(0,x)],l=0,s=0,_=0,a=1,d=1;if(!(p=(m=J._pool.get()).transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_x=l,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_y=s,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_rotation=_,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}if(p.local_scale_x=a,!(p=m.transform).dirty){p.dirty=p.inverse_dirty=p.coordinates_dirty=!0;for(y=0,c=p.children;y<c.length;){h=c[y];++y,h.dirty=h.inverse_dirty=h.coordinates_dirty=!0;for(u=0,f=h.children;u<f.length;)f[u++].set_dirty(!0);null!=h.on_dirty&&h.on_dirty(h)}null!=p.on_dirty&&p.on_dirty(p)}p.local_scale_y=d;v=null;if(m.local_vertices=null==o?[]:o,m.count=m.local_vertices.length,v>m.local_vertices.length)for(y=m.local_vertices.length;y<v;)m.local_vertices[y++]=new hi(0,0);m.dirty_vertices=!0,m.dirty_bounds=!0,m.pooled=!1,n=m}}return new j({x:t*g+w,y:r*x+I,mass:0,shape_instance:n})}(m,a,c,o)).data.tile_index=null==c?u:_,n.push(h))}return n};var O=function(t,r,i,e,n){if(null==n&&(n=1),null==e&&(e=1),null==i&&(i=0),null==r&&(r=0),null==t&&(t=0),this.coordinates_dirty=!1,this.inverse_dirty=!1,this.dirty=!1,this.local_to_world_matrix=new q(1,0,0,0,1,0,0,0,1),this.children=[],this._scale_y=1,this._scale_x=1,this._rotation=0,this._y=0,this._x=0,this.on_dirty=null,!this.dirty){this.dirty=this.inverse_dirty=this.coordinates_dirty=!0;for(var o=0,l=this.children;o<l.length;){var s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(var _=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=this.on_dirty&&this.on_dirty(this)}if(this.local_x=t,!this.dirty){this.dirty=this.inverse_dirty=this.coordinates_dirty=!0;for(o=0,l=this.children;o<l.length;){s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=this.on_dirty&&this.on_dirty(this)}if(this.local_y=r,!this.dirty){this.dirty=this.inverse_dirty=this.coordinates_dirty=!0;for(o=0,l=this.children;o<l.length;){s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=this.on_dirty&&this.on_dirty(this)}if(this.local_rotation=i,!this.dirty){this.dirty=this.inverse_dirty=this.coordinates_dirty=!0;for(o=0,l=this.children;o<l.length;){s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=this.on_dirty&&this.on_dirty(this)}if(this.local_scale_x=e,!this.dirty){this.dirty=this.inverse_dirty=this.coordinates_dirty=!0;for(o=0,l=this.children;o<l.length;){s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=this.on_dirty&&this.on_dirty(this)}this.local_scale_y=n};O.__name__=!0,O.prototype={set_parent:function(t,r){null==r&&(r=!1),null!=this.parent&&s.remove(this.parent.children,this),null!=(this.parent=t)&&this.parent.children.push(this),this.dirty=this.inverse_dirty=this.coordinates_dirty=!0;for(var i=0,e=this.children;i<e.length;){var n=e[i];++i,n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(var o=0,l=n.children;o<l.length;)l[o++].set_dirty(!0);null!=n.on_dirty&&n.on_dirty(n)}null!=this.on_dirty&&this.on_dirty(this)},get_local_to_world_matrix:function(){var t,r,i,e,n,o,l,s,_,a,d,y,c,h,u,f,v;return this.dirty&&(null==this.parent?(r=Math.PI/180*this.local_rotation,i=Math.sin(r),e=Math.cos(r),(v=this.local_to_world_matrix).m00=e*this.local_scale_x,v.m10=-i*this.local_scale_y,v.m20=this.local_x,v.m01=i*this.local_scale_x,v.m11=e*this.local_scale_y,v.m21=this.local_y,v.m02=0,v.m12=0,v.m22=1):(t=this.parent.get_local_to_world_matrix(),r=Math.PI/180*this.local_rotation,i=Math.sin(r),n=(e=Math.cos(r))*this.local_scale_x,o=-i*this.local_scale_y,l=this.local_x,s=i*this.local_scale_x,_=e*this.local_scale_y,a=this.local_y,0,d=t.m00*o+t.m10*_+0*t.m20,y=t.m00*l+t.m10*a+ +t.m20,c=t.m01*o+t.m11*_+0*t.m21,h=t.m01*l+t.m11*a+ +t.m21,u=t.m02*o+t.m12*_+0*t.m22,f=t.m02*l+t.m12*a+ +t.m22,(v=this.local_to_world_matrix).m00=t.m00*n+t.m10*s+0*t.m20,v.m10=d,v.m20=y,v.m01=t.m01*n+t.m11*s+0*t.m21,v.m11=c,v.m21=h,v.m02=t.m02*n+t.m12*s+0*t.m22,v.m12=u,v.m22=f),this.dirty=!1),this.local_to_world_matrix},sync:function(){var t,r,i,e,n;this.coordinates_dirty&&(t=this.get_local_to_world_matrix(),null==this.parent?(this._x=this.local_x,this._y=this.local_y,this._scale_x=this.local_scale_x,this._scale_y=this.local_scale_y,this._rotation=this.local_rotation):(r=t.m00,i=t.m01,e=t.m10,n=t.m11,this._x=t.m20,this._y=t.m21,this._scale_x=Math.sqrt(r*r+i*i),this._scale_y=Math.sqrt(e*e+n*n),this._rotation=180/Math.PI*Math.atan2(-e/this._scale_y,r/this._scale_x)),this.coordinates_dirty=!1)},set_dirty:function(t){if(null==t&&(t=!1),t||!this.dirty){this.dirty=this.inverse_dirty=this.coordinates_dirty=!0;for(var r=0,i=this.children;r<i.length;)i[r++].set_dirty(!0);null!=this.on_dirty&&this.on_dirty(this)}}};var U=function(t,r,i){Error.call(this,t),this.message=t,this.__previousException=r,this.__nativeException=null!=i?i:this};U.__name__=!0,U.thrown=function(t){return t instanceof U?t.get_native():t instanceof Error?t:new X(t)},U.__super__=Error,U.prototype=e(Error.prototype,{get_native:function(){return this.__nativeException},__properties__:{get_native:"get_native"}});var X=function(t,r,i){U.call(this,String(t),r,i),this.value=t};X.__name__=!0,X.__super__=U,X.prototype=e(U.prototype,{});function R(){}R.__name__=!0,R.prototype={set:function(t,r){this.root=this.setLoop(t,r,this.root)},get:function(t){for(var r=this.root;null!=r;){var i=this.compare(t,r.key);if(0==i)return r.value;r=i<0?r.left:r.right}return null},setLoop:function(t,r,i){if(null==i)return new A(null,t,r,null);var e=this.compare(t,i.key);if(0==e)return new A(i.left,t,r,i.right,null==i?0:i._height);if(e<0)return this.balance(this.setLoop(t,r,i.left),i.key,i.value,i.right);var n=this.setLoop(t,r,i.right);return this.balance(i.left,i.key,i.value,n)},balance:function(t,r,i,e){var n=null==t?0:t._height,o=null==e?0:e._height;if(o+2<n){var l=t.left,s=t.right;return(null==l?0:l._height)>=(null==s?0:s._height)?new A(t.left,t.key,t.value,new A(t.right,r,i,e)):new A(new A(t.left,t.key,t.value,t.right.left),t.right.key,t.right.value,new A(t.right.right,r,i,e))}if(n+2<o){l=e.right,s=e.left;return(null==l?0:l._height)>(null==s?0:s._height)?new A(new A(t,r,i,e.left),e.key,e.value,e.right):new A(new A(t,r,i,e.left.left),e.left.key,e.left.value,new A(e.left.right,e.key,e.value,e.right))}return new A(t,r,i,e,(o<n?n:o)+1)},compare:function(t,r){return _.compare(t,r)}};var A=function(t,r,i,e,n){var o,l,s;null==n&&(n=-1),this.left=t,this.key=r,this.value=i,this.right=e,-1==n?(s=this.left,o=this.right,l=(null==s?0:s._height)>(null==o?0:o._height)?null==(s=this.left)?0:s._height:null==(s=this.right)?0:s._height,this._height=l+1):this._height=n};A.__name__=!0;var k=h["haxe.ds.Either"]={__ename__:!0,__constructs__:null,Left:((i=function(t){return{_hx_index:0,v:t,__enum__:"haxe.ds.Either",toString:r}})._hx_name="Left",i.__params__=["v"],i),Right:((i=function(t){return{_hx_index:1,v:t,__enum__:"haxe.ds.Either",toString:r}})._hx_name="Right",i.__params__=["v"],i)};k.__constructs__=[k.Left,k.Right],k.__empty_constructs__=[];function L(){R.call(this)}L.__name__=!0,L.__super__=R,L.prototype=e(R.prototype,{compare:function(t,r){var i=t._hx_index-r._hx_index;if(0!=i)return i;var e=a.enumParameters(t),n=a.enumParameters(r);return 0==e.length&&0==n.length?0:this.compareArgs(e,n)},compareArgs:function(t,r){var i=t.length-r.length;if(0!=i)return i;for(var e=0,n=t.length;e<n;){var o=e++,l=this.compareArg(t[o],r[o]);if(0!=l)return l}return 0},compareArg:function(t,r){return _.isEnumValue(t)&&_.isEnumValue(r)?this.compare(t,r):t instanceof Array&&r instanceof Array?this.compareArgs(t,r):_.compare(t,r)}});var F=function(){this.h=Object.create(null)};F.__name__=!0;var q=function(t,r,i,e,n,o,l,s,_){this.m00=t,this.m10=r,this.m20=i,this.m01=e,this.m11=n,this.m21=o,this.m02=l,this.m12=s,this.m22=_};q.__name__=!0;var z=function(){};z.__name__=!0,z.__string_rec=function(n,o){if(null==n)return"null";if(5<=o.length)return"<...>";var t,r=typeof n;switch("function"==r&&(n.__name__||n.__ename__)&&(r="object"),r){case"function":return"<function>";case"object":if(n.__enum__){var l=h[n.__enum__].__constructs__[n._hx_index],i=l._hx_name;return l.__params__?(o+="\t",i+"("+function(){for(var t=[],r=0,i=l.__params__;r<i.length;){var e=i[r];r+=1,t.push(z.__string_rec(n[e],o))}return t}().join(",")+")"):i}if(n instanceof Array){var e="[";o+="\t";for(var s=0,_=n.length;s<_;){var a=s++;e+=(0<a?",":"")+z.__string_rec(n[a],o)}return e+="]"}try{t=n.toString}catch(s){return"???"}if(null!=t&&t!=Object.toString&&"function"==typeof t){var d=n.toString();if("[object Object]"!=d)return d}e="{\n";o+="\t";var y=null!=n.hasOwnProperty,c=null;for(c in n)y&&!n.hasOwnProperty(c)||"prototype"!=c&&"__class__"!=c&&"__super__"!=c&&"__interfaces__"!=c&&"__properties__"!=c&&(2!=e.length&&(e+=", \n"),e+=o+c+" : "+z.__string_rec(n[c],o));return e+="\n"+(o=o.substring(1))+"}";case"string":return n;default:return String(n)}};function Y(){PIXI.TilingSprite.call(this,PIXI.Texture.from("assets/clouds_bg.png"),1024,180),this.anchor.set(.5),Zt.tween(this.tilePosition,120,{x:320},{type:Qt.LOOP_FORWARDS}),this.texture.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST}Y.__name__=!0,Y.__super__=PIXI.TilingSprite,Y.prototype=e(PIXI.TilingSprite.prototype,{});var V=function(){this.match_rotation=!0,this.groups=[],this.alive=!0,this.flash_timer=0,this.touching=0,this.normals=[],this.facing=tt.RIGHT,PIXI.Container.call(this),V.all.push(this),this.active=!0};V.__name__=!0,V.update_all=function(t){for(var r=0,i=V.all;r<i.length;){var e=i[r];if(++r,e.active){if(e.touching=0,null!=e.body){for(var n=0,o=e.normals;n<o.length;){var l=o[n];++n;.5<zt.zero(l[0]*kr[0]+l[1]*kr[1])&&(e.touching=e.touching+4096);.5<zt.zero(l[0]*Lr[0]+l[1]*Lr[1])&&(e.touching=e.touching+256);.5<zt.zero(l[0]*Fr[0]+l[1]*Fr[1])&&(e.touching=e.touching+16);.5<zt.zero(l[0]*Cr[0]+l[1]*Cr[1])&&(e.touching=e.touching+1)}for(var s=0,_=e.normals;s<_.length;){var a=_[s];++s,zt.pool.push(a)}e.normals=[];var d=mt.level_rect,y=d[1]+d[3];if(e.body.bounds().min_y>y&&0<e.get_velocity().y){var c=e.body,h=mt.level_rect[1],u=e.body.bounds(),f=h-(u.max_y-u.min_y)/2,v=c.transform;if(!v.dirty){v.dirty=v.inverse_dirty=v.coordinates_dirty=!0;for(var m=0,p=v.children;m<p.length;){var g=p[m];++m,g.dirty=g.inverse_dirty=g.coordinates_dirty=!0;for(var x=0,w=g.children;x<w.length;)w[x++].set_dirty(!0);null!=g.on_dirty&&g.on_dirty(g)}null!=v.on_dirty&&v.on_dirty(v)}v.local_y=f,null!=c.on_move&&c.on_move(c.transform.local_x,c.transform.local_y)}if(e.body.bounds().max_y<mt.level_rect[1]&&e.get_velocity().y<0){var I=e.body,b=mt.level_rect,P=b[1]+b[3],S=e.body.bounds(),T=P+(S.max_y-S.min_y),E=I.transform;if(!E.dirty){E.dirty=E.inverse_dirty=E.coordinates_dirty=!0;for(var M=0,O=E.children;M<O.length;){var X=O[M];++M,X.dirty=X.inverse_dirty=X.coordinates_dirty=!0;for(var R=0,A=X.children;R<A.length;)A[R++].set_dirty(!0);null!=X.on_dirty&&X.on_dirty(X)}null!=E.on_dirty&&E.on_dirty(E)}E.local_y=T,null!=I.on_move&&I.on_move(I.transform.local_x,I.transform.local_y)}}e.update(t)}}},V.__super__=PIXI.Container,V.prototype=e(PIXI.Container.prototype,{get_touching_cieling:function(){return u.gt(4096&this.touching,0)},get_touching_floor:function(){return u.gt(256&this.touching,0)},get_touching_left:function(){return u.gt(16&this.touching,0)},get_touching_right:function(){return u.gt(1&this.touching,0)},get_touching_wall:function(){return!!this.get_touching_left()||this.get_touching_right()},get_velocity:function(){return this.body.velocity},get_acceleration:function(){return this.body.acceleration},make_body:function(t,r,i){null==i&&(i=!0);var e=this;if(this.body=new j(t),i&&(this.body.on_move=function(t,r){e.position.set(Math.round(t),Math.round(r))},this.body.on_rotate=function(t){e.match_rotation&&(e.rotation=t*(Math.PI/180))}),mt.world.add(this.body),this.body.acceleration.y=rr,(this.body.data.object=this).body.max_velocity.y=or,null!=r){this.groups=r;for(var n=0;n<r.length;)r[n++].push(this.body)}},update:function(t){this.visible=0==(this.flash_timer=Math.max(this.flash_timer-t,0))||.25<Yt.synced_sin(.15)},destroy:function(t){if(s.remove(V.all,this),null!=this.body)for(var r=0,i=this.groups;r<i.length;)s.remove(i[r++],this.body);null!=this.animations&&this.animations.destroy(),mt.world.remove(this.body),this.body.dispose(),PIXI.Container.prototype.destroy.call(this,{children:!0,texture:!1,baseTexture:!1})},__properties__:{get_acceleration:"get_acceleration",get_velocity:"get_velocity",get_touching_wall:"get_touching_wall",get_touching_right:"get_touching_right",get_touching_left:"get_touching_left",get_touching_floor:"get_touching_floor",get_touching_cieling:"get_touching_cieling"}});function Z(){V.call(this)}Z.__name__=!0,Z.__super__=V,Z.prototype=e(V.prototype,{make_body:function(t,r,i){null==i&&(i=!0),null==r&&(r=[]),-1==r.indexOf(mt.i.hazards)&&r.push(mt.i.hazards),V.prototype.make_body.call(this,t,r,i)},destroy:function(t){mt.i.poofs.get().fire({position:zt.from_array_float([this.body.transform.local_x,this.body.transform.local_y])}),V.prototype.destroy.call(this)}});function $(t,r,i){this.chain_length=.001,this.chain_angle=270,this.offset=zt.get(0,.001),this.chain=[],Z.call(this),this.origin=zt.get(t,r),this.make_body({shape:{type:1,radius:5},mass:0},null,!1),this.make_chain(i),mt.i.poofs.get().fire({position:zt.from_array_float([t,r])})}$.__name__=!0,$.__super__=Z,$.prototype=e(Z.prototype,{make_chain:function(t){for(var r=Gt("assets/ball_and_chain.png",3,1,12,12),i=0;i<r.length;)r[i++].baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;for(r.unshift(r.pop());r.length<t;)r.push(r[r.length-1]);r.push(r.shift());for(i=0;i<r.length;){var e=PIXI.Sprite.from(r[i++]);e.anchor.set(.5),this.chain.push(e),this.addChild(e)}},update:function(t){Z.prototype.update.call(this,t);var r=this.offset,i=this.chain_angle;i*=Math.PI/180;var e=Math.sqrt(r[0]*r[0]+r[1]*r[1]),n=e*Math.cos(i);null==(s=e*Math.sin(i))&&(s=0),null==n&&(n=0),r[0]=zt.zero(n),r[1]=zt.zero(s);r=this.offset,i=this.chain_length,n=r[0]/Math.sqrt(r[0]*r[0]+r[1]*r[1]);null==(s=r[1]/Math.sqrt(r[0]*r[0]+r[1]*r[1]))&&(s=0),null==n&&(n=0),r[0]=zt.zero(n),r[1]=zt.zero(s);n=r[0]*i;null==(s=r[1]*i)&&(s=0),null==n&&(n=0),r[0]=zt.zero(n),r[1]=zt.zero(s);for(var o=0,l=this.chain.length;o<l;){var s,_=o++,a=this.chain[_],r=this.offset,d=zt.get(r[0],r[1]),i=Math.sqrt(d[0]*d[0]+d[1]*d[1])*Math.max(_,.001),n=d[0]/Math.sqrt(d[0]*d[0]+d[1]*d[1]);null==(s=d[1]/Math.sqrt(d[0]*d[0]+d[1]*d[1]))&&(s=0),null==n&&(n=0),d[0]=zt.zero(n),d[1]=zt.zero(s);var y=d[0]*i,c=d[1]*i;null==c&&(c=0),null==y&&(y=0),d[0]=zt.zero(y),d[1]=zt.zero(c),d=zt.add(d,this.origin),a.position.set(Math.round(d[0]),Math.round(d[1])),_==this.chain.length-1&&this.body.set_position(d[0],d[1]),zt.pool.push(d),d=null}this.chain_angle+=144*t,this.chain_length+=.025*(6-this.chain_length)}});function Q(t,r){this.anim_speed=.1,this.anim_timer=0,this.counter=0,this.idx=0,this.textures=Gt("assets/box.png",3,2,16,16),V.call(this),this.make_body({shape:{type:0,width:12,height:12},x:t,y:r},[mt.i.pickups]),this.get_acceleration().y=0,this.make_graphic()}Q.__name__=!0,Q.__super__=V,Q.prototype=e(V.prototype,{make_graphic:function(){for(var t=0,r=this.textures;t<r.length;)r[t++].baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;this.sprite=PIXI.Sprite.from(this.textures[0]),this.sprite.anchor.set(.5),this.glow=PIXI.Sprite.from("assets/box_glow.png"),this.glow.anchor.set(.5),this.glow.scale.set(.2),this.glow.blendMode=PIXI.BLEND_MODES.OVERLAY,this.glow.alpha=.5,this.addChild(this.glow),this.addChild(this.sprite),this.scale.set(0)},update:function(t){V.prototype.update.call(this,t),this.counter+=t,(this.anim_timer-=t)<=0&&(this.anim_timer=this.anim_speed,this.idx=(this.idx+1)%6,this.sprite.texture=this.textures[this.idx]),this.glow.rotation+=.05;var r=(Math.sin(this.counter)- -1)/2;this.glow.alpha=.3*(1-r)+.5*r,this.scale.x+=.1*(1-this.scale.x),this.scale.y+=.1*(1-this.scale.y)},destroy:function(t){mt.i.poofs.get().fire({position:zt.from_array_float([this.x,this.y])}),V.prototype.destroy.call(this)}});var tt=h["objects.Facing"]={__ename__:!0,__constructs__:null,LEFT:{_hx_name:"LEFT",_hx_index:0,__enum__:"objects.Facing",toString:r},RIGHT:{_hx_name:"RIGHT",_hx_index:1,__enum__:"objects.Facing",toString:r}};tt.__constructs__=[tt.LEFT,tt.RIGHT],tt.__empty_constructs__=[tt.LEFT,tt.RIGHT];function rt(t,r){this.start_timer=3,this.particle_timer=0,this.health=Mr,this.last_touching=0,this.last_vel_y=0,this.last_vel_x=0,this.high_jump_amt=0,this.rotation_speed=0,this.heading_up=!1,this.can_double_jump=!1,this.just_jumped_timer=0,this.jump_timer=0,this.power=it.JUMP,V.call(this),this.position.set(t,r),this.make_body({shape:{type:0,width:6,height:12},x:t,y:r},[mt.i.physics_objects,mt.i.player_bodies]),this.make_graphic(),this.reset_powers(),this.flash_timer=4,d.game_events.dispatch(y.PLAYER_HEALTH,{health:this.health})}rt.__name__=!0,rt.__super__=V,rt.prototype=e(V.prototype,{reset_powers:function(){for(var t=[],r=0,i=it.__empty_constructs__.slice();r<i.length;)t.push(i[r++]);this.powers=t,s.remove(this.powers,it.JUMP),s.remove(this.powers,this.power),jt.shuffle(this.powers)},make_graphic:function(){for(var r=this,i=Gt("assets/player.png",8,8,24,24),t=0;t<i.length;)i[t++].baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;this.sprite=new PIXI.Sprite,this.sprite.anchor.set(.5,.75),this.animations=new Ht({on_frame_change:function(t){r.sprite.texture=i[t]}}),this.animations.add({name:"idle",frames:[0]}),this.animations.add({name:"jump",frames:[7]}),this.animations.add({name:"fall",frames:[8]}),this.animations.add({name:"walk",frames:[1,1,2,3,4,4,5,6],duration:.5}),this.animations.add({name:"walk_jetpack",frames:[13,13,14,15,16,16,17,18],duration:.5}),this.animations.add({name:"jump_jetpack",frames:[19]}),this.animations.add({name:"fall_jetpack",frames:[20]}),this.animations.add({name:"float_fall",frames:[21,22,23,24,25,26],duration:.3}),this.animations.add({name:"flip",frames:[9,10,11,12],duration:.1}),this.animations.add({name:"ball",frames:[27]}),this.animations.add({name:"zero_g_out",frames:[28]}),this.animations.add({name:"zero_g_in",frames:[29]}),this.animations.add({name:"pogo_up",frames:[30]}),this.animations.add({name:"pogo_down",frames:[31,32,33],duration:.25});for(var e=this.animations,t=[],n=0;n<32;)t.push(n++%3+34);e.add({name:"charge",frames:t,duration:gr,ease:Jt.quadOut,type:Qt.SINGLE_SHOT_FORWARDS,on_complete:function(){mt.i.stars.get().fire({position:zt.from_array_float([r.x,r.y]),velocity:zt.from_array_int([-80,-80])}),mt.i.stars.get().fire({position:zt.from_array_float([r.x,r.y]),velocity:zt.from_array_int([80,-80])})}}),this.animations.add({name:"dash",frames:[37,38,39],duration:.15,type:Qt.SINGLE_SHOT_FORWARDS}),this.addChild(this.sprite)},get_new_power:function(){var t;switch(this.set_power(this.powers.pop()),this.power._hx_index){case 0:t=Ft.JUMP;break;case 1:t=Ft.DOUBLE_JUMP;break;case 2:t=Ft.JETPACK;break;case 3:t=Ft.GLIDE;break;case 4:t=Ft.GRAVITY_FLIP;break;case 5:t=Ft.PING_PONG;break;case 6:t=Ft.PARKOUR;break;case 7:t=Ft.POGO;break;case 8:t=Ft.ZERO_GRAVITY;break;case 9:t=Ft.HIGH_JUMP}t!=Ft.JUMP&&Ct.play(t),this.flash_timer=Er,d.game_events.dispatch(y.NEW_POWER,{power:this.power}),0==this.powers.length&&this.reset_powers()},set_power:function(t){this.power=t,this.scale.y=1;var r=this.body,i=r.transform;if(!i.dirty){i.dirty=i.inverse_dirty=i.coordinates_dirty=!0;for(var e=0,n=i.children;e<n.length;){var o=n[e];++e,o.dirty=o.inverse_dirty=o.coordinates_dirty=!0;for(var l=0,s=o.children;l<s.length;)s[l++].set_dirty(!0);null!=o.on_dirty&&o.on_dirty(o)}null!=i.on_dirty&&i.on_dirty(i)}return i.local_rotation=0,null!=r.on_rotate&&r.on_rotate(r.transform.local_rotation),this.rotation=r.transform.local_rotation,this.get_acceleration().y=rr,this.heading_up=!1,this.match_rotation=!0,this.power},update:function(t){V.prototype.update.call(this,t),this.controls(t),this.animation(t)},controls:function(t){switch(this.power._hx_index){case 0:this.jump(t);break;case 1:this.double_jump(t);break;case 2:this.jetpack(t);break;case 3:this.glide(t);break;case 4:this.grav_flip(t);break;case 5:this.ping_pong(t);break;case 6:this.parkour(t);break;case 7:this.pogo(t);break;case 8:this.zero_gravity(t);break;case 9:this.high_jump(t)}0!=this.get_velocity().x&&(this.last_vel_x=this.get_velocity().x),0!=this.get_velocity().y&&(this.last_vel_y=this.get_velocity().y),this.last_touching=this.touching},walk:function(t,r){var i;null==r&&(r=!0),0<this.start_timer&&0<(this.start_timer-=t)?this.get_velocity().x=0:(i=this.facing==tt.LEFT?-fr:fr,this.get_velocity().x=i,(this.get_touching_left()&&this.get_touching_floor()||this.get_touching_left()&&(!r||0<this.get_velocity().y))&&(this.facing=tt.RIGHT),(this.get_touching_right()&&this.get_touching_floor()||this.get_touching_right()&&(!r||0<this.get_velocity().y))&&(this.facing=tt.LEFT))},jump:function(t,r){return null==r&&(r=!0),this.walk(t,r),this.jump_timer=Math.max(this.jump_timer-=t,0),this.just_jumped_timer=Math.max(this.just_jumped_timer-=t,0),Dt.get_just_pressed()&&(this.just_jumped_timer=ir),Dt.get_just_released()&&this.get_velocity().y<0&&(this.get_velocity().y*=er),this.get_touching_floor()&&(this.jump_timer=ir),0<this.jump_timer&&0<this.just_jumped_timer&&(Ct.play(Ft.SFX_JUMP),this.get_velocity().y=-nr,!(this.jump_timer=this.just_jumped_timer=0))},double_jump:function(t){!this.jump(t)&&Dt.get_just_pressed()&&this.can_double_jump&&(this.get_velocity().y=-nr,this.jump_timer=this.just_jumped_timer=0,this.can_double_jump=!1,mt.i.stars.get().fire({position:zt.from_array_float([this.x,this.y]),velocity:zt.from_array_int([0,80])}),Ct.play(Ft.SFX_DOUBLE_JUMP)),this.get_touching_floor()&&(this.can_double_jump=!0)},jetpack:function(t){this.walk(t,!1),Dt.pressed?(this.get_acceleration().y=lr,(this.particle_timer-=t)<=0&&(this.particle_timer=.1,mt.i.stars.get().fire({position:zt.from_array_float([this.x,this.y]),velocity:zt.from_array_float([40*Math.random()-20,150])}),Ct.play(Ft.SFX_BOOST))):this.get_acceleration().y=rr,this.get_touching_cieling()&&(this.get_velocity().y=sr)},glide:function(t){this.jump(t,!1),Dt.pressed&&(this.get_velocity().y=Math.min(this.get_velocity().y,_r),0<this.get_velocity().y&&!this.get_touching_floor()&&(this.particle_timer-=t)<=0&&(this.particle_timer=.1,mt.i.stars.get().fire({position:zt.from_array_float([this.x,this.y+(12*Math.random()-6)]),velocity:zt.from_array_int([this.facing==tt.LEFT?64:-64,0])}),Ct.play(Ft.SFX_TWINKLE)))},grav_flip:function(t){this.walk(t,!1),Dt.get_just_pressed()&&(this.get_acceleration().y=-this.get_acceleration().y,Ct.play(Ft.SFX_GRAV_SHIFT))},ping_pong:function(t){this.get_acceleration().y=0;var r=this.get_velocity();r.x=this.facing==tt.LEFT?-fr:fr,r.y=this.heading_up?-fr:fr,this.get_touching_floor()&&(this.heading_up=!0),this.get_touching_cieling()&&(this.heading_up=!1),this.get_touching_left()&&(this.facing=tt.RIGHT),this.get_touching_right()&&(this.facing=tt.LEFT),0!=this.touching&&Ct.play(Ft.SFX_PONG),Dt.get_just_pressed()&&(this.heading_up=!this.heading_up,Ct.play(Ft.SFX_PONG_HIT))},pogo:function(t){var r,i=this.facing==tt.LEFT?Dt.pressed&&0<this.get_velocity().y?-vr:-fr:Dt.pressed&&0<this.get_velocity().y?vr:fr;this.get_velocity().x+=.2*(i-this.get_velocity().x),this.get_touching_left()&&(this.facing=tt.RIGHT),this.get_touching_right()&&(this.facing=tt.LEFT),this.get_touching_floor()&&(Ct.play(Ft.SFX_POGO),r=Dt.pressed?-pr:-mr,this.get_velocity().y=r),0<this.get_velocity().y&&Dt.pressed&&(this.get_velocity().y*=1.1),this.get_velocity().y<0&&Dt.get_just_released()&&(this.get_velocity().y*=er),this.get_touching_floor()&&Dt.pressed&&(mt.i.stars.get().fire({position:zt.from_array_float([this.x,this.y+6]),velocity:zt.from_array_int([-100,-80])}),mt.i.stars.get().fire({position:zt.from_array_float([this.x,this.y+6]),velocity:zt.from_array_int([100,-80])}))},zero_gravity:function(t){this.match_rotation=!1,this.get_acceleration().y=0,this.rotation_speed=Dt.pressed?0:this.rotation_speed+.1*(Ir-this.rotation_speed),this.rotation+=this.rotation_speed;var r=2*Math.PI;this.rotation=(this.rotation%r+r)%r;var i=zt.get(this.get_velocity().x,this.get_velocity().y);0==Math.sqrt(i[0]*i[0]+i[1]*i[1])&&(i[0]=.01);var e=this.rotation-Math.PI/2,n=Math.sqrt(i[0]*i[0]+i[1]*i[1]),o=n*Math.cos(e),l=n*Math.sin(e);null==l&&(l=0),null==o&&(o=0),i[0]=zt.zero(o),i[1]=zt.zero(l);e=Math.sqrt(i[0]*i[0]+i[1]*i[1])+((Dt.pressed?br:.01)-Math.sqrt(i[0]*i[0]+i[1]*i[1]))*(Dt.pressed?.2:.1),o=i[0]/Math.sqrt(i[0]*i[0]+i[1]*i[1]);null==(l=i[1]/Math.sqrt(i[0]*i[0]+i[1]*i[1]))&&(l=0),null==o&&(o=0),i[0]=zt.zero(o),i[1]=zt.zero(l);o=i[0]*e;null==(l=i[1]*e)&&(l=0),null==o&&(o=0),i[0]=zt.zero(o),i[1]=zt.zero(l);var s,_=this.get_velocity();_.x=i[0],_.y=i[1],zt.pool.push(i),i=null,this.get_touching_cieling()&&(this.get_velocity().y=Math.abs(this.last_vel_y)),this.get_touching_floor()&&(this.get_velocity().y=-Math.abs(this.last_vel_y)),this.get_touching_left()&&(this.get_velocity().x=Math.abs(this.last_vel_x)),this.get_touching_right()&&(this.get_velocity().x=-Math.abs(this.last_vel_x)),(this.get_touching_cieling()||this.get_touching_floor()||this.get_touching_left()||this.get_touching_right())&&(_=this.get_velocity(),this.rotation=Math.atan2(_.y,_.x)+Math.PI/2),Dt.pressed&&(this.particle_timer-=t)<=0&&(this.particle_timer=.1,e=zt.get(100,0),s=this.rotation+Math.PI/2+(.4*Math.random()-.2),o=(n=Math.sqrt(e[0]*e[0]+e[1]*e[1]))*Math.cos(s),null==(l=n*Math.sin(s))&&(l=0),null==o&&(o=0),e[0]=zt.zero(o),e[1]=zt.zero(l),mt.i.stars.get().fire({position:zt.from_array_float([this.x,this.y]),velocity:e}),Ct.play(Ft.SFX_BOOST))},high_jump:function(t){var r;(Dt.get_just_pressed()&&this.get_touching_floor()||Dt.pressed&&this.get_touching_floor()&&0==this.last_touching)&&Ct.play(Ft.SFX_CHARGE),Dt.get_just_released()&&this.get_touching_floor()&&(Ct.stop(Ft.SFX_CHARGE),Ct.play(Ft.SFX_DOUBLE_JUMP),i=(1-(r=Math.min(this.high_jump_amt,gr)/gr))*xr+r*wr,this.get_velocity().y=-i),this.high_jump_amt=Dt.pressed&&this.get_touching_floor()?this.high_jump_amt+t:0;var i=Dt.pressed?0:this.facing==tt.LEFT?-fr:fr;this.get_velocity().x=i,(this.get_touching_left()&&this.get_touching_floor()||this.get_touching_left()&&0<this.get_velocity().y)&&(this.facing=tt.RIGHT),(this.get_touching_right()&&this.get_touching_floor()||this.get_touching_right()&&0<this.get_velocity().y)&&(this.facing=tt.LEFT)},parkour:function(t){var r=this.facing==tt.LEFT?-fr:fr,i=this.get_velocity().x+=.1*(r-this.get_velocity().x);(0<i?1:i<0?-1:0)!=(0<r?1:r<0?-1:0)&&(this.get_velocity().x=r),Dt.get_just_pressed()&&(Ct.play(Ft.SFX_DASH),e=this.facing==tt.LEFT?-Pr:Pr,this.get_velocity().x=e,this.get_touching_wall()&&(this.get_velocity().x*=-1,this.facing=this.facing==tt.LEFT?tt.RIGHT:tt.LEFT));var e=this.get_dashing()?0:this.get_touching_wall()?-fr:this.get_velocity().y;if(this.get_velocity().y=e,this.get_touching_cieling()&&this.get_touching_wall()){var n=(d=this.body).transform.local_y+4;if(!(y=d.transform).dirty){y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(var o=0,l=y.children;o<l.length;){var s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(var _=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=y.on_dirty&&y.on_dirty(y)}y.local_y=n,null!=d.on_move&&d.on_move(d.transform.local_x,d.transform.local_y),this.facing=this.facing==tt.LEFT?tt.RIGHT:tt.LEFT}e=this.get_dashing()?0:rr;if(this.get_acceleration().y=e,this.get_touching_wall()&&u.gt(4096&this.last_touching,0)){n=(d=this.body).transform.local_y+2;if(!(y=d.transform).dirty){y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(o=0,l=y.children;o<l.length;){s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=y.on_dirty&&y.on_dirty(y)}y.local_y=n,null!=d.on_move&&d.on_move(d.transform.local_x,d.transform.local_y);var d,y,n=(d=this.body).transform.local_x+(this.facing==tt.LEFT?-2:2);if(!(y=d.transform).dirty){y.dirty=y.inverse_dirty=y.coordinates_dirty=!0;for(o=0,l=y.children;o<l.length;){s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(_=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=y.on_dirty&&y.on_dirty(y)}y.local_x=n,null!=d.on_move&&d.on_move(d.transform.local_x,d.transform.local_y)}this.get_dashing()&&(this.particle_timer-=t)<=0&&(this.particle_timer=.1,mt.i.stars.get().fire({position:zt.from_array_float([this.x,this.y+(12*Math.random()-6)])}))},get_dashing:function(){return Math.abs(this.get_velocity().x)-Sr>fr},animation:function(t){switch(this.power._hx_index){case 0:case 1:this.get_touching_floor()?0==this.get_velocity().x?this.animations.play("idle",0,!0):this.animations.play("walk"):0<this.get_velocity().y?this.animations.play("fall",0,!0):this.animations.play("jump",0,!0);break;case 2:this.get_touching_floor()?this.animations.play("walk_jetpack"):0<this.get_velocity().y?this.animations.play("fall_jetpack",0,!0):this.animations.play("jump_jetpack",0,!0);break;case 3:this.get_touching_floor()?0==this.get_velocity().x?this.animations.play("idle",0,!0):this.animations.play("walk"):0<this.get_velocity().y?Dt.pressed?this.animations.play("float_fall"):this.animations.play("fall",0,!0):this.animations.play("jump",0,!0);break;case 4:this.get_touching_floor()||this.get_touching_cieling()?0==this.get_velocity().x?this.animations.play("idle",0,!0):this.animations.play("walk"):this.animations.play("fall",0,!0),0!=this.get_velocity().y&&(r=this.get_velocity().y,this.scale.y=0<r?1:r<0?-1:0);break;case 5:this.animations.play("ball");var r=this.get_velocity().y;this.scale.y=-(0<r?1:r<0?-1:0);break;case 6:var i=this.body,e=this.get_touching_left()?90:this.get_touching_right()?-90:0,n=i.transform;if(!n.dirty){n.dirty=n.inverse_dirty=n.coordinates_dirty=!0;for(var o=0,l=n.children;o<l.length;){var s=l[o];++o,s.dirty=s.inverse_dirty=s.coordinates_dirty=!0;for(var _=0,a=s.children;_<a.length;)a[_++].set_dirty(!0);null!=s.on_dirty&&s.on_dirty(s)}null!=n.on_dirty&&n.on_dirty(n)}n.local_rotation=e,null!=i.on_rotate&&i.on_rotate(i.transform.local_rotation),this.get_dashing()?this.animations.play("dash"):this.get_touching_floor()||this.get_touching_left()||this.get_touching_right()?this.animations.play("walk"):this.animations.play("fall");break;case 7:this.get_velocity().y<0?this.animations.play("pogo_up"):this.animations.play("pogo_down");break;case 8:Dt.pressed?this.animations.play("zero_g_out"):this.animations.play("zero_g_in");break;case 9:this.get_touching_floor()?0==this.get_velocity().x?this.animations.play("charge"):this.animations.play("walk"):0<this.get_velocity().y?this.animations.play("fall",0,!0):this.animations.play("jump",0,!0)}this.scale.x=this.facing==tt.LEFT?-1:1},hurt:function(){var t,r,i,e,n;0<this.flash_timer||(Ct.play(Ft.SFX_HURT),t=zt.get(150,0),r=45,r*=Math.PI/180,e=(i=Math.sqrt(t[0]*t[0]+t[1]*t[1]))*Math.cos(r),null==(n=i*Math.sin(r))&&(n=0),null==e&&(e=0),t[0]=zt.zero(e),t[1]=zt.zero(n),mt.i.stars.get().fire({position:zt.from_array_float([this.body.transform.local_x,this.body.transform.local_y]),velocity:t}),t=zt.get(150,0),r=135,r*=Math.PI/180,e=(i=Math.sqrt(t[0]*t[0]+t[1]*t[1]))*Math.cos(r),null==(n=i*Math.sin(r))&&(n=0),null==e&&(e=0),t[0]=zt.zero(e),t[1]=zt.zero(n),mt.i.stars.get().fire({position:zt.from_array_float([this.body.transform.local_x,this.body.transform.local_y]),velocity:t}),t=zt.get(150,0),r=225,r*=Math.PI/180,e=(i=Math.sqrt(t[0]*t[0]+t[1]*t[1]))*Math.cos(r),null==(n=i*Math.sin(r))&&(n=0),null==e&&(e=0),t[0]=zt.zero(e),t[1]=zt.zero(n),mt.i.stars.get().fire({position:zt.from_array_float([this.body.transform.local_x,this.body.transform.local_y]),velocity:t}),t=zt.get(150,0),r=315,r*=Math.PI/180,e=(i=Math.sqrt(t[0]*t[0]+t[1]*t[1]))*Math.cos(r),null==(n=i*Math.sin(r))&&(n=0),null==e&&(e=0),t[0]=zt.zero(e),t[1]=zt.zero(n),mt.i.stars.get().fire({position:zt.from_array_float([this.body.transform.local_x,this.body.transform.local_y]),velocity:t}),this.flash_timer=Tr,--this.health,d.game_events.dispatch(y.PLAYER_HEALTH,{health:this.health}),0<this.health&&new Mt(this.sprite),0<this.health||(this.alive=!1,mt.i.dead_players.get().fire({position:zt.from_array_float([this.x,this.y])}),this.destroy(),Vt.get(1,function(){mt.i.game_over()})))},__properties__:e(V.prototype.__properties__,{get_dashing:"get_dashing",set_power:"set_power"})});var it=h["objects.Power"]={__ename__:!0,__constructs__:null,JUMP:{_hx_name:"JUMP",_hx_index:0,__enum__:"objects.Power",toString:r},DOUBLE_JUMP:{_hx_name:"DOUBLE_JUMP",_hx_index:1,__enum__:"objects.Power",toString:r},JETPACK:{_hx_name:"JETPACK",_hx_index:2,__enum__:"objects.Power",toString:r},GLIDE:{_hx_name:"GLIDE",_hx_index:3,__enum__:"objects.Power",toString:r},GRAVITY_FLIP:{_hx_name:"GRAVITY_FLIP",_hx_index:4,__enum__:"objects.Power",toString:r},PING_PONG:{_hx_name:"PING_PONG",_hx_index:5,__enum__:"objects.Power",toString:r},PARKOUR:{_hx_name:"PARKOUR",_hx_index:6,__enum__:"objects.Power",toString:r},POGO:{_hx_name:"POGO",_hx_index:7,__enum__:"objects.Power",toString:r},ZERO_GRAVITY:{_hx_name:"ZERO_GRAVITY",_hx_index:8,__enum__:"objects.Power",toString:r},HIGH_JUMP:{_hx_name:"HIGH_JUMP",_hx_index:9,__enum__:"objects.Power",toString:r}};it.__constructs__=[it.JUMP,it.DOUBLE_JUMP,it.JETPACK,it.GLIDE,it.GRAVITY_FLIP,it.PING_PONG,it.PARKOUR,it.POGO,it.ZERO_GRAVITY,it.HIGH_JUMP],it.__empty_constructs__=[it.JUMP,it.DOUBLE_JUMP,it.JETPACK,it.GLIDE,it.GRAVITY_FLIP,it.PING_PONG,it.PARKOUR,it.POGO,it.ZERO_GRAVITY,it.HIGH_JUMP];function et(t,r){this.timer=0,this.idx=0,this.textures=Gt("assets/rolling_ball.png",3,2,18,18),Z.call(this),this.make_body({shape:{type:1,radius:8},x:t,y:r},[mt.i.hazards,mt.i.physics_objects]),this.get_acceleration().y=.5*rr,this.facing=tt.RIGHT,this.make_graphic()}et.__name__=!0,et.__super__=Z,et.prototype=e(Z.prototype,{make_graphic:function(){for(var t=0,r=this.textures;t<r.length;)r[t++].baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;this.sprite=new PIXI.Sprite,this.sprite.anchor.set(.5,.5),this.addChild(this.sprite)},update:function(t){Z.prototype.update.call(this,t),this.get_touching_floor()&&(this.get_velocity().y=-dr),this.get_touching_left()&&(this.facing=tt.RIGHT),this.get_touching_right()&&(this.facing=tt.LEFT),0!=this.touching&&Ct.play(Ft.SFX_BOUNCE);var r=this.facing==tt.LEFT?-yr:yr;this.get_velocity().x=r,this.scale.x=this.facing==tt.LEFT?-1:1,0<(this.timer-=t)||(this.sprite.texture=this.textures[this.idx++%6],this.timer=.1)}});function nt(t,r,i){this.idx=0,this.anim_timer=0,Z.call(this),this.nodes=[zt.get(t,r)];for(var e=0;e<i.length;){var n=i[e];++e,this.nodes.push(zt.get(n.x,n.y))}this.make_body({shape:{type:1,radius:6},x:t,y:r}),this.get_acceleration().y=0,this.make_graphic(),this.get_target(),mt.i.poofs.get().fire({position:zt.from_array_float([t,r])})}nt.__name__=!0,nt.__super__=Z,nt.prototype=e(Z.prototype,{make_graphic:function(){this.textures=Gt("assets/saw_blade.png",2,2,16,16);for(var t=0,r=this.textures;t<r.length;)r[t++].baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;this.sprite=PIXI.Sprite.from(this.textures[0]),this.sprite.anchor.set(.5),this.addChild(this.sprite)},get_target:function(){null!=this.target&&this.body.set_position(this.target[0],this.target[1]),this.target=this.nodes.shift(),this.nodes.push(this.target)},update:function(t){Z.prototype.update.call(this,t);var r=zt.get(this.body.transform.local_x,this.body.transform.local_y),i=zt.subtract(this.target,zt.from_array_float(r));Math.sqrt(i[0]*i[0]+i[1]*i[1])<.5&&this.get_target();var e=zt.subtract(this.target,r),n=cr,o=e[0]/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=e[1]/Math.sqrt(e[0]*e[0]+e[1]*e[1]);null==l&&(l=0),null==o&&(o=0),e[0]=zt.zero(o),e[1]=zt.zero(l);o=e[0]*n;null==(l=e[1]*n)&&(l=0),null==o&&(o=0),e[0]=zt.zero(o),e[1]=zt.zero(l);var s=this.get_velocity();s.x=e[0],s.y=e[1],zt.pool.push(r),zt.pool.push(e),e=null,(this.anim_timer-=t)<=0&&(this.anim_timer=.025,this.sprite.texture=this.textures[this.idx++%3])}});function ot(t,r){this.spikes_up=!1;var i=this;Z.call(this),this.make_body({shape:{type:0,width:16,height:4},x:t,y:r}),this.make_graphic(),this.get_acceleration().y=0,this.set_spikes_up(!0),this.timer=Vt.get(hr,function(){i.set_spikes_up(!i.spikes_up)},999),mt.i.poofs.get().fire({position:zt.from_array_float([t,r])})}ot.__name__=!0,ot.__super__=Z,ot.prototype=e(Z.prototype,{make_graphic:function(){for(var t=this,i=Gt("assets/spikes.png",2,2,8,8),r=0;r<i.length;)i[r++].baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;var e=[],n=PIXI.Sprite.from(i[0]);n.anchor.set(1,.75),this.addChild(n),e.push(n);var o=PIXI.Sprite.from(i[0]);o.anchor.set(0,.75),this.addChild(o),e.push(o),this.animations=new Ht({on_frame_change:function(t){for(var r=0;r<e.length;)e[r++].texture=i[t]}}),this.animations.add({name:"up",frames:[0,1,2,3,3,3],type:Qt.SINGLE_SHOT_FORWARDS,duration:.3,on_complete:function(){t.body.active=!0}}),this.animations.add({name:"down",frames:[3,2,1,0],type:Qt.SINGLE_SHOT_FORWARDS,duration:.2})},set_spikes_up:function(t){(this.spikes_up=t)||(this.body.active=t),Ct.play(t?Ft.SFX_SPIKES_UP:Ft.SFX_SPIKES_DOWN),t?this.animations.play("up"):this.animations.play("down")},destroy:function(t){this.timer.pause(),Z.prototype.destroy.call(this,t)}});function lt(t,r){PIXI.Container.call(this);var i=[],e=PIXI.BaseTexture.from("assets/tiles.png");e.scaleMode=PIXI.SCALE_MODES.NEAREST,i.push(new PIXI.Texture(e,new PIXI.Rectangle(0,0,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(8,0,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(16,0,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(24,0,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(32,0,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(40,0,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(48,0,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(56,0,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(0,8,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(8,8,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(16,8,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(24,8,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(32,8,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(40,8,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(48,8,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(56,8,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(0,16,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(8,16,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(16,16,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(24,16,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(32,16,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(40,16,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(48,16,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(56,16,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(0,24,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(8,24,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(16,24,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(24,24,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(32,24,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(40,24,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(48,24,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(56,24,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(0,32,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(8,32,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(16,32,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(24,32,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(32,32,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(40,32,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(48,32,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(56,32,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(0,40,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(8,40,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(16,40,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(24,40,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(32,40,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(40,40,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(48,40,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(56,40,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(0,48,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(8,48,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(16,48,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(24,48,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(32,48,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(40,48,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(48,48,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(56,48,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(0,56,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(8,56,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(16,56,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(24,56,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(32,56,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(40,56,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(48,56,8,8))),i.push(new PIXI.Texture(e,new PIXI.Rectangle(56,56,8,8)));for(var n=0,o=t.length;n<o;)for(var l=n++,s=0,_=t[l].length;s<_;){var a,d,y=s++,c=t[l][y],h=r[l][y];c<0||((a=PIXI.Sprite.from(i[c])).anchor.set(.5),a.position.set(8*y+4,8*l+4),0!=h&&(0<(4&h)&&(a.scale.x*=-1),0<(2&h)&&(a.scale.y*=-1),0<(1&h)&&(a.scale.y*=-1,d=a.scale.x<0?Math.PI:0,d+=a.scale.y<0?Math.PI/2:-Math.PI/2,a.rotation+=d)),this.addChild(a))}}lt.__name__=!0,lt.__super__=PIXI.Container,lt.prototype=e(PIXI.Container.prototype,{});function st(t){this.acceleration=zt.get(),this.velocity=zt.get(),PIXI.Sprite.call(this,t),this.kill()}st.__name__=!0,st.__super__=PIXI.Sprite,st.prototype=e(PIXI.Sprite.prototype,{fire:function(t){null==t.velocity&&(t.velocity=zt.get()),null==t.acceleration&&(t.acceleration=zt.get()),null==t.lifetime&&(t.lifetime=0),this.position.set(t.position[0],t.position[1]);var r=this.velocity,i=t.velocity,e=i[0],n=i[1];null==n&&(n=0),null==e&&(e=0),r[0]=zt.zero(e),r[1]=zt.zero(n);r=this.acceleration,e=(i=t.acceleration)[0];null==(n=i[1])&&(n=0),null==e&&(e=0),r[0]=zt.zero(e),r[1]=zt.zero(n),this.lifetime=t.lifetime,this.visible=!0,zt.pool.push(t.position),t.position=null,zt.pool.push(t.velocity),t.velocity=null,zt.pool.push(t.acceleration),t.acceleration=null},kill:function(){this.visible=!1},update:function(t){this.velocity[0]+=this.acceleration[0]*t.dt,this.velocity[1]+=this.acceleration[1]*t.dt,this.position.x+=this.velocity[0]*t.dt,this.position.y+=this.velocity[1]*t.dt,0<this.lifetime&&(this.lifetime-=t.dt)<=0&&this.kill(),this.position.set(Math.round(this.x),Math.round(this.y))},get_available:function(){return!this.visible},destroy:function(t){PIXI.Sprite.prototype.destroy.call(this,{children:!0,texture:!1,baseTexture:!1})},__properties__:{get_available:"get_available"}});function _t(){var t=Gt("assets/player_dead.png",1,1,16,16)[0];t.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST,st.call(this,t),this.anchor.set(.5)}_t.__name__=!0,_t.__super__=st,_t.prototype=e(st.prototype,{fire:function(t){t.velocity=zt.get(0,.75*-nr),t.acceleration=zt.get(0,rr),st.prototype.fire.call(this,t)},update:function(t){st.prototype.update.call(this,t),512<this.y&&this.kill()}});function at(t){this.pool=[],PIXI.Container.call(this),this.get_new=t,d.game_events.listen(y.UPDATE,tr(this,this.update))}at.__name__=!0,at.__super__=PIXI.Container,at.prototype=e(PIXI.Container.prototype,{get:function(){for(var t=0,r=this.pool;t<r.length;){var i=r[t];if(++t,i.get_available())return i}var e=this.get_new();return this.pool.push(e),this.addChild(e),e},update:function(t){for(var r=0,i=this.pool;r<i.length;){var e=i[r];++r,e.get_available()||e.update(t)}}});function dt(){this.timer=0,this.textures=Gt("assets/poof.png",3,3,24,24);for(var t=0,r=this.textures;t<r.length;)r[t++].baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;st.call(this,this.textures[0]),this.anchor.set(.5)}dt.__name__=!0,dt.__super__=st,dt.prototype=e(st.prototype,{fire:function(t){st.prototype.fire.call(this,t),this.lifetime=.4,this.set_idx(0)},update:function(t){st.prototype.update.call(this,t),0<(this.timer-=t.dt)||this.set_idx(this.idx+1)},set_idx:function(t){return 8<t?this.kill():this.texture=this.textures[t],this.timer=.05,this.idx=t},__properties__:e(st.prototype.__properties__,{set_idx:"set_idx"})});function yt(){for(var r=this,i=Gt("assets/star.png",3,3,5,5),t=0;t<i.length;)i[t++].baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;st.call(this,i[0]),this.anchor.set(.5),this.animation=new Ht({on_frame_change:function(t){r.texture=i[t]}}),this.animation.add({name:"play",frames:[0,1,2,3,4,5,6,7,8],duration:.4,type:Qt.SINGLE_SHOT_FORWARDS,on_complete:tr(this,this.kill)})}yt.__name__=!0,yt.__super__=st,yt.prototype=e(st.prototype,{fire:function(t){st.prototype.fire.call(this,t),this.animation.play("play",0,!0),this.alpha=1},update:function(t){st.prototype.update.call(this,t);var r,i,e,n,o=this.velocity;0<Math.sqrt(o[0]*o[0]+o[1]*o[1])&&(o=this.velocity,r=this.velocity,i=.9*Math.sqrt(r[0]*r[0]+r[1]*r[1]),e=o[0]/Math.sqrt(o[0]*o[0]+o[1]*o[1]),null==(n=o[1]/Math.sqrt(o[0]*o[0]+o[1]*o[1]))&&(n=0),null==e&&(e=0),o[0]=zt.zero(e),o[1]=zt.zero(n),e=o[0]*i,null==(n=o[1]*i)&&(n=0),null==e&&(e=0),o[0]=zt.zero(e),o[1]=zt.zero(n)),this.animation.get_active()||this.kill()}});function ct(){st.call(this);var t=new PIXI.Graphics;t.lineStyle(32,14957380,1,0),t.drawCircle(0,0,64),this.addChild(t),t.blendMode=PIXI.BLEND_MODES.ADD}ct.__name__=!0,ct.__super__=st,ct.prototype=e(st.prototype,{fire:function(t){st.prototype.fire.call(this,t),this.scale.set(1,1)},update:function(t){st.prototype.update.call(this,t),this.scale.x+=.05*(0-this.scale.x),this.scale.y+=.05*(0-this.scale.y),this.scale.x<.01&&this.kill()}});function ut(){PIXI.Container.call(this),this.init(),d.app_events.listen(o.RESIZE,tr(this,this.resize)),d.game_events.listen(y.UPDATE,tr(this,this.update))}ut.__name__=!0,ut.__super__=PIXI.Container,ut.prototype=e(PIXI.Container.prototype,{init:function(){},update:function(t){},resize:function(t){},destroy:function(t){d.app_events.unlisten(o.RESIZE,tr(this,this.resize)),d.game_events.unlisten(y.UPDATE,tr(this,this.update)),PIXI.Container.prototype.destroy.call(this,t)}});var ft={zero:function(t){return Math.abs(t)<=ft.epsilon?0:t},get:function(t,r,i,e){if(null==e&&(e=0),null==i&&(i=0),null==r&&(r=0),null==t&&(t=0),null!=ft.pool&&0<ft.pool.length){var n=ft.pool.shift(),o=t,l=r,s=i,_=null==e?0:e;return null==i&&(s=0),null==r&&(l=0),null==t&&(o=0),vt.arr_set(n,0,ft.zero(o)),vt.arr_set(n,1,ft.zero(l)),vt.arr_set(n,2,ft.zero(s)),vt.arr_set(n,3,ft.zero(_)),n}o=t,l=r,s=i,_=null==e?0:e;return null==i&&(s=0),null==r&&(l=0),null==t&&(o=0),vt.from_array_float([o,l,s,_])}},vt={zero:function(t){return Math.abs(t)<=vt.epsilon?0:t},from_array_float:function(t){return vt.get(t[0],t[1],t[2],t[3])},arr_set:function(t,r,i){r<0||3<r||(t[r]=i)},get:function(t,r,i,e){if(null==e&&(e=0),null==i&&(i=0),null==r&&(r=0),null==t&&(t=0),null!=vt.pool&&0<vt.pool.length){var n=vt.pool.shift(),o=t,l=r,s=i,_=null==e?0:e;return null==i&&(s=0),null==r&&(l=0),null==t&&(o=0),n[0]=vt.zero(o),n[1]=vt.zero(l),n[2]=vt.zero(s),n[3]=vt.zero(_),n}return[o=null==t?0:t,l=null==r?0:r,s=null==i?0:i,_=null==e?0:e]}},mt=function(){this.dead_players=new at(function(){return new _t}),this.warnings=new at(function(){return new ct}),this.stars=new at(function(){return new yt}),this.poofs=new at(function(){return new dt}),this.one_way_geom=[],this.level_geom=[],this.pickups=[],this.hazards=[],this.player_bodies=[],this.physics_objects=[],this.current_time=0,this.hazard_data=[],this.box_positions=[],this.level=d.assets.resources["assets/level.json"].data,ut.call(this)};mt.__name__=!0,mt.__super__=ut,mt.prototype=e(ut.prototype,{init:function(){(mt.i=this).addChild(this.game_layer=new PIXI.Container),this.addChild(this.ui_layer=new PIXI.Container),this.game_layer.addChild(new Y),this.game_layer.addChild(this.dolly=new qt),this.make_layers(),this.make_tiles(),this.make_particles(),this.make_ui(),this.set_state(pt.TITLE)},make_layers:function(){this.dolly.addChild(this.background=new PIXI.Container),this.dolly.addChild(this.objects=new PIXI.Container),this.dolly.addChild(this.foreground=new PIXI.Container)},make_tiles:function(){var t=Kt.get_tile_layer(this.level,"bg"),r=Kt.get_tile_layer(this.level,"tiles"),i=new lt(t.data2D,t.tileFlags2D);this.tile_data=r.data2D;var e=new lt(this.tile_data,r.tileFlags2D);this.background.addChild(i),this.foreground.addChild(e)},init_game:function(){var r=this;Ct.play_music(),Or=0,V.all=[],Xr=[],this.box_positions=[],this.hazard_data=[],this.physics_objects=[],this.player_bodies=[],this.hazards=[],this.pickups=[],this.current_time=0,mt.world=new p({width:1e3,height:1e3}),Kt.load_entities(Kt.get_entity_layer(this.level,"entities"),function(t){switch(t.name){case"box":r.box_positions.push(zt.get(t.x,t.y));break;case"player":r.objects.addChild(r.player=new rt(t.x,t.y));break;case"ball_and_chain":case"rolling_ball":case"saw_blade":case"spikes":r.hazard_data.push(t)}}),jt.shuffle(this.hazard_data),jt.shuffle(this.box_positions),d.game_events.dispatch(y.NEW_POWER,{power:it.JUMP});for(var t=this.tile_data,i=[],e=0;e<t.length;){var n=t[e];++e;for(var o=0;o<n.length;)i.push(n[o++])}this.level_geom=M.generate(i,8,8,56,32,0,0,1,null,[12,13,14,15]);for(t=this.tile_data,i=[],e=0;e<t.length;){n=t[e];++e;for(o=0;o<n.length;)i.push(n[o++])}(e=[]).push(16),e.push(17),e.push(18),e.push(19),e.push(20),e.push(21),e.push(22),e.push(23),e.push(24),e.push(25),e.push(26),e.push(27),e.push(28),e.push(29),e.push(30),e.push(31),e.push(32),e.push(33),e.push(34),e.push(35),e.push(36),e.push(37),e.push(38),e.push(39),e.push(40),e.push(41),e.push(42),e.push(43),e.push(44),e.push(45),e.push(46),e.push(47),e.push(48),e.push(49),e.push(50),e.push(51),e.push(52),e.push(53),e.push(54),e.push(55),e.push(56),e.push(57),e.push(58),e.push(59),e.push(60),e.push(61),e.push(62),e.push(63),this.one_way_geom=M.generate(i,8,8,56,32,0,0,12,null,e);for(i=0,e=this.level_geom;i<e.length;)mt.world.add(e[i++]);for(i=0,e=this.one_way_geom;i<e.length;)mt.world.add(e[i++]);this.add_listeners(),Vt.get(4,function(){r.spawn_box()})},make_particles:function(){this.foreground.addChild(this.dead_players),this.foreground.addChild(this.poofs),this.background.addChild(this.stars),this.foreground.addChild(this.warnings)},make_ui:function(){this.ui_layer.addChild(this.white_layer=new PIXI.Graphics),this.white_layer.beginFill(16777215,.15),this.white_layer.drawRect(0,0,1,1),this.ui_layer.addChild(new Lt),this.ui_layer.addChild(new Tt),this.ui_layer.addChild(new It),this.ui_layer.addChild(new Pt),this.ui_layer.addChild(new Et),this.ui_layer.addChild(new Ot),this.ui_layer.addChild(new wt),this.ui_layer.addChild(new St),this.ui_layer.addChild(new xt),this.ui_layer.addChild(new bt),this.ui_layer.addChild(new Xt)},add_listeners:function(){var e=this;W.listen(mt.world,k.Right(this.physics_objects),k.Right(this.level_geom),{stay:function(t,r,i){for(var e=0;e<i.length;){var n=i[e];++e,t.data.object.normals.push(zt.get(n.normal.x,n.normal.y))}}}),W.listen(mt.world,k.Right(this.physics_objects),k.Right(this.one_way_geom),{condition:function(t,r,i){var e=i[0].normal;return.5<=e.x*qr.x+e.y*qr.y&&0<=t.velocity.y},stay:function(t,r,i){for(var e=0;e<i.length;){var n=i[e];++e,t.data.object.normals.push(zt.get(n.normal.x,n.normal.y))}}}),W.listen(mt.world,k.Right(this.player_bodies),k.Right(this.pickups),{enter:function(t,r,i){e.get_box(r.data.object)}}),W.listen(mt.world,k.Right(this.player_bodies),k.Right(this.hazards),{enter:function(t,r,i){t.data.object.hurt()},separate:!1})},get_box:function(t){var r=this;Or++,t.destroy(),Xr.push(this.current_time),this.current_time=0,this.player.get_new_power(),Vt.get(.5,function(){r.spawn_box()}),Or%ur==0&&this.spawn_hazard()},spawn_box:function(){for(var t=this.get_box_pos(),r=zt.get(this.player.x,this.player.y);;){var i=zt.subtract(r,zt.from_array_float(t));if(!(Math.sqrt(i[0]*i[0]+i[1]*i[1])<64))break;t=this.get_box_pos()}Ct.play(Ft.SFX_SPAWN),this.objects.addChild(new Q(t[0],t[1]))},get_box_pos:function(){var t=this.box_positions.pop();return this.box_positions.unshift(t),t},spawn_hazard:function(){var t,r=this;0!=this.hazard_data.length&&(t=this.hazard_data.pop(),Vt.get(1.5,function(){switch(Ct.play(Ft.SFX_SPAWN),t.name){case"ball_and_chain":r.objects.addChild(new $(t.x,t.y,t.values.links));break;case"rolling_ball":r.objects.addChild(new et(t.x,t.y));break;case"saw_blade":r.objects.addChild(new nt(t.x,t.y,t.nodes));break;case"spikes":r.objects.addChild(new ot(t.x,t.y))}}),this.warnings.get().fire({position:zt.from_array_int([t.x,t.y])}))},update:function(t){this.current_time+=t.dt,null!=mt.world&&W.step(mt.world,t.dt),V.update_all(t.dt),this.dolly.update(t);var r=this.dolly,i=r.scroll,e=r.scroll[1];switch(this.state._hx_index){case 1:n=.025*(72-this.dolly.scroll[1]);break;case 0:case 2:n=.025*(-108-this.dolly.scroll[1])}i[1]=e+n;var n,i=(r=this.dolly).scroll,e=r.scroll[0];switch(this.state._hx_index){case 1:n=null!=this.player&&this.player.alive?.1*Math.min(Math.max(this.player.x+this.player.get_velocity().x/2-this.dolly.scroll[0],-20),20):0;break;case 0:case 2:n=.1*(224-this.dolly.scroll[0])}i[0]=e+n,this.state!=pt.TITLE&&this.state!=pt.END||!Dt.get_just_released()||xt.i.just_pressed||bt.i.just_pressed||this.set_state(pt.PLAY)},resize:function(t){mt.zoom=t.height/mt.game_height,this.game_layer.position.set(t.width/2,t.height/2),this.game_layer.scale.set(mt.zoom,mt.zoom),gt.resize_all(t),this.dolly.resize(t),this.white_layer.scale.set(t.width,t.height)},set_state:function(t){switch(this.state=t,d.game_events.dispatch(y.GAME_STATE,{state:this.state}),this.state._hx_index){case 0:break;case 1:this.init_game(),Ct.play(Ft.SKILL_SWAP);break;case 2:Vt.get(1,function(){Ct.play(Ft.NICE_JOB)})}return this.state},game_over:function(){for(var t=0,r=V.all;t<r.length;)r[t++].destroy();this.objects.removeChildren(),mt.world.clear(),this.set_state(pt.END)},__properties__:{set_state:"set_state"}});var pt=h["states.PlayStateState"]={__ename__:!0,__constructs__:null,TITLE:{_hx_name:"TITLE",_hx_index:0,__enum__:"states.PlayStateState",toString:r},PLAY:{_hx_name:"PLAY",_hx_index:1,__enum__:"states.PlayStateState",toString:r},END:{_hx_name:"END",_hx_index:2,__enum__:"states.PlayStateState",toString:r}};pt.__constructs__=[pt.TITLE,pt.PLAY,pt.END],pt.__empty_constructs__=[pt.TITLE,pt.PLAY,pt.END];var gt=function(t,r,i){null==r&&(r=At.WINDOW),null==t&&(t=Rt.MIDDLE_CENTER),this.state=kt.IN,PIXI.Container.call(this),this.anchor=t,this.offset=null==i?zt.get():i,this.reference=r,gt.all.push(this)};gt.__name__=!0,gt.resize_all=function(t){for(var r=0,i=gt.all;r<i.length;)i[r++].resize(t)},gt.__super__=PIXI.Container,gt.prototype=e(PIXI.Container.prototype,{resize:function(t){var r,i,e,n,o=zt.get(),l=Math.max(Math.min(Math.min(t.width/1600,1),t.height/900),.4);switch(this.scale.set(l),this.reference._hx_index){case 0:r=this.parent.width;break;case 1:r=t.width}switch(this.reference._hx_index){case 0:i=this.parent.height;break;case 1:i=t.height}switch(this.anchor._hx_index){case 0:o[0]=zt.zero(0),o[1]=zt.zero(0);break;case 1:null==(e=r/2)&&(e=0),o[0]=zt.zero(e),o[1]=zt.zero(0);break;case 2:null==(e=r)&&(e=0),o[0]=zt.zero(e),o[1]=zt.zero(0);break;case 3:null==(n=i/2)&&(n=0),o[0]=zt.zero(0),o[1]=zt.zero(n);break;case 4:null==(n=i/2)&&(n=0),null==(e=r/2)&&(e=0),o[0]=zt.zero(e),o[1]=zt.zero(n);break;case 5:null==(n=i/2)&&(n=0),null==(e=r)&&(e=0),o[0]=zt.zero(e),o[1]=zt.zero(n);break;case 6:null==(n=i)&&(n=0),o[0]=zt.zero(0),o[1]=zt.zero(n);break;case 7:null==(n=i)&&(n=0),null==(e=r/2)&&(e=0),o[0]=zt.zero(e),o[1]=zt.zero(n);break;case 8:null==(n=i)&&(n=0),null==(e=r)&&(e=0),o[0]=zt.zero(e),o[1]=zt.zero(n)}var s=zt.multiply_f(this.offset,l),o=zt.add(o,s);this.position.set(o[0],o[1]),zt.pool.push(o),zt.pool.push(s)}});var xt=function(){this.just_pressed=!1,this.textures=Gt("assets/audio.png",2,1,115,120),this.muted=!1;var r=this;xt.i=this,gt.call(this,Rt.TOP_LEFT,At.WINDOW,zt.from_array_int([248,118])),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update)),this.interactive=this.buttonMode=!0,this.on("pointertap",function(t){r.set_muted()}),this.container=new PIXI.Container,this.addChild(this.container),this.container.position.set(-512,0),this.sprite=PIXI.Sprite.from(this.textures[0]),this.sprite.anchor.set(.5);var t=new PIXI.Graphics;t.beginFill(0,.75),t.arc(-160,0,40,Math.PI/2,Math.PI/2*3),t.arc(160,0,40,-Math.PI/2,Math.PI/2),t.endFill(),t.rotation=-Math.PI/180*2,t.position.set(0,80),this.text=new PIXI.Text("SOUND ON",{fill:16777215,fontSize:36,fontFamily:"'Lilita One', Arial"}),this.text.anchor.set(.5),t.addChild(this.text),this.container.addChild(t),this.container.addChild(this.sprite),null!=Ar&&Vt.get(.1,function(){r.set_muted(Ar)})};xt.__name__=!0,xt.__super__=gt,xt.prototype=e(gt.prototype,{set_state:function(t){var r,i=t.state;if(null==i)r=kt.OUT;else switch(i._hx_index){case 1:r=kt.OUT;break;case 0:case 2:r=kt.IN}this.state=r},update:function(t){var r;switch(this.state._hx_index){case 0:r=0;break;case 1:r=-512}this.container.x+=.1*(r-this.container.x)},set_muted:function(t){var r=this;this.just_pressed=!0,this.muted=null==t?!this.muted:!t,this.sprite.texture=this.muted?this.textures[1]:this.textures[0],Howler.mute(this.muted),Vt.get(.1,function(){r.just_pressed=!1}),this.text.text=this.muted?"SOUND OFF":"SOUND ON";var i=this.muted?"0":"1";window.localStorage.setItem("muted",i),new Mt(this.sprite)}});var wt=function(){this.time=0,this.target_out=400,gt.call(this,Rt.BOTTOM_CENTER,At.WINDOW,zt.from_array_int([0,-128]));var t=PIXI.Sprite.from("assets/cta.png");t.anchor.set(.5),this.container=new PIXI.Container,this.container.y=this.target_out,this.addChild(this.container),this.container.addChild(t),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update)),t.interactive=t.buttonMode=!0,t.on("pointertap",function(t){l.location.href="http://unboxedtechnology.com/"})};wt.__name__=!0,wt.__super__=gt,wt.prototype=e(gt.prototype,{set_state:function(t){var r=this,i=t.state;if(null==i)null!=this.timer&&this.timer.get_active()&&this.timer.cancel(),this.state=kt.OUT;else switch(i._hx_index){case 0:case 1:null!=this.timer&&this.timer.get_active()&&this.timer.cancel(),this.state=kt.OUT;break;case 2:this.timer=Vt.get(1.5,function(){r.state=kt.IN})}},update:function(t){switch(this.state._hx_index){case 0:this.container.y+=.1*(0-this.container.y);break;case 1:this.container.y+=.1*(this.target_out-this.container.y)}this.time+=2*t.dt,this.rotation=Math.sin(this.time)/16}});var It=function(){this.alpha_target=0,this.hearts=[];var r=this;gt.call(this,Rt.TOP_LEFT,At.WINDOW,zt.get(214,92));for(var t=0,i=Mr;t<i;){var e=PIXI.Sprite.from("assets/heart.png");e.anchor.set(.5),this.addChild(e),e.position.set(60*t++,0),this.hearts.push(e)}d.game_events.listen(y.PLAYER_HEALTH,tr(this,this.update_hearts)),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,function(t){r.alpha+=.1*(r.alpha_target-r.alpha)}),this.alpha=0};It.__name__=!0,It.__super__=gt,It.prototype=e(gt.prototype,{update_hearts:function(t){for(var r=0,i=Mr;r<i;){var e=r++;e==t.health&&1==this.hearts[e].alpha&&new Mt(this.hearts[e]),this.hearts[e].tint=e>=t.health?0:16777215,this.hearts[e].alpha=e>=t.health?.25:1}},set_state:function(t){var r,i=t.state;if(null==i)r=0;else switch(i._hx_index){case 1:r=1;break;case 0:case 2:r=0}this.alpha_target=r}});var bt=function(){this.just_pressed=!1;var r=this;bt.i=this,gt.call(this,Rt.TOP_RIGHT,At.WINDOW,zt.from_array_int([-248,118])),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update)),this.container=new PIXI.Container,this.addChild(this.container),this.container.position.set(512,0);var t=new PIXI.Graphics;t.beginFill(0,.75),t.arc(-160,0,40,Math.PI/2,Math.PI/2*3),t.arc(160,0,40,-Math.PI/2,Math.PI/2),t.endFill(),t.rotation=Math.PI/180*2,t.position.set(0,80),this.text=new PIXI.Text("MY HIGH SCORE",{fill:16777215,fontSize:36,fontFamily:"'Lilita One', Arial"}),this.text.anchor.set(.5),t.addChild(this.text);var i=PIXI.Sprite.from(d.assets.resources["assets/share.png"].texture);i.anchor.set(.5),i.position.set(128,140),i.buttonMode=i.interactive=!0,i.on("pointertap",function(t){r.just_pressed=!0,Xt.i.show()}),this.hi_sprite=PIXI.Sprite.from(d.assets.resources["assets/arrow.png"].texture),this.hi_sprite.anchor.set(.5),this.hi_sprite.rotation=-Math.PI/4,this.score_text=new PIXI.Text("0",{fill:16753408,fontSize:144,fontFamily:"'Lilita One', Arial",strokeThickness:16,stroke:0}),this.score_text.anchor.set(.5),this.container.addChild(t),this.container.addChild(i),this.container.addChild(this.score_text),this.container.addChild(this.hi_sprite),this.set_score(null!=Rr?Rr:0),d.game_events.listen(y.GAME_STATE,tr(this,this.update_score))};bt.__name__=!0,bt.__super__=gt,bt.prototype=e(gt.prototype,{set_score:function(t){return this.score_text.text=""+t,this.hi_sprite.x=this.score_text.width/2+24,this.score=t},set_state:function(t){var r=this,i=t.state;if(null==i)this.state=kt.OUT;else switch(i._hx_index){case 1:this.state=kt.OUT;break;case 0:case 2:Vt.get(.1,function(){r.state=null==Rr?kt.OUT:kt.IN})}},update:function(t){var r;switch(this.state._hx_index){case 0:r=0;break;case 1:r=512}this.container.x+=.1*(r-this.container.x)},update_score:function(t){this.hi_sprite.scale.set(0),t.state==pt.END&&(Or<=Rr||(Rr=Or,this.set_score(Or),Zt.tween(this.hi_sprite.scale,.5,{x:1,y:1},{delay:1,ease:Jt.elasticOut}),window.localStorage.setItem("hiscore",""+Or)))},__properties__:{set_score:"set_score"}});var Pt=function(){this.pulse_timer=3,gt.call(this,Rt.MIDDLE_CENTER,At.WINDOW,zt.from_array_int([0,-96])),this.sprite=PIXI.Sprite.from("assets/logo.png"),this.sprite.anchor.set(.5),this.addChild(this.sprite),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update));var t=PIXI.Sprite.from("assets/test.png");t.rotation=.01,t.position.set(0,180),t.anchor.set(.5),t.scale.set(0),this.sprite.addChild(t),Zt.tween(t.scale,.4,{x:1,y:1},{ease:Jt.backOut,delay:.5})};Pt.__name__=!0,Pt.__super__=gt,Pt.prototype=e(gt.prototype,{update:function(t){0<(this.pulse_timer-=t.dt)||this.state==kt.OUT||(this.pulse_timer=5,new Mt(this.sprite,.5,1.5))},set_state:function(t){var r=this,i=t.state;if(null!=i)switch(i._hx_index){case 0:break;case 1:this.state=kt.OUT,Zt.tween(this.scale,.5,{x:0,y:0},{ease:Jt.backIn,on_complete:function(){r.alpha=0}});break;case 2:this.state=kt.OUT}}});var St=function(){this.out_pos=-1280,this.percent=0,gt.call(this,Rt.MIDDLE_CENTER,At.WINDOW,zt.from_array_int([0,-128])),this.addChild(this.container=new PIXI.Container);var t=new PIXI.Graphics;t.beginFill(0,.75),t.drawRoundedRect(-256,-256,512,512,16),t.endFill();var r=PIXI.Sprite.from(d.assets.resources["assets/logo.png"].texture);r.anchor.set(.5,1),r.position.set(0,-100),r.scale.set(.4),this.container.addChild(t),this.container.addChild(r),this.container.y=this.out_pos;var i=new PIXI.Text("SCORE:",{fill:16777215,fontSize:36,fontFamily:"'Lilita One', Arial"});i.position.set(0,-100),i.anchor.set(.5);var e=new PIXI.Text("MY SKILL AGILITY:",{fill:16777215,fontSize:36,fontFamily:"'Lilita One', Arial"});e.position.set(0,100),e.anchor.set(.5),this.container.addChild(i),this.container.addChild(e),this.score=new PIXI.Text("12",{fill:16753408,fontSize:144,fontFamily:"'Lilita One', Arial",strokeThickness:16,stroke:0}),this.score.anchor.set(.5),this.score.position.set(0,-8),this.container.addChild(this.score);var n=new PIXI.Graphics;n.lineStyle(8,16777215,1,0),n.arc(-140,0,20,Math.PI/2,Math.PI/2*3),n.arc(140,0,20,-Math.PI/2,-Math.PI/2*3),n.lineTo(-140,20),n.position.set(0,144),this.container.addChild(n);var o=window.document.createElement("canvas");o.width=320,o.height=40;var l=o.getContext("2d",null),s=l.createLinearGradient(0,0,320,40);s.addColorStop(0,"#7000FF"),s.addColorStop(1,"#FF004D"),l.fillStyle=s,l.fillRect(0,0,320,40);var _=PIXI.Sprite.from(o);_.anchor.set(.5),_.position.set(0,144),this.bar=new PIXI.Graphics,_.mask=this.bar,this.bar.position.set(0,144),this.container.addChild(this.bar),this.container.addChild(_),this.dot=new PIXI.Graphics,this.dot.beginFill(16777215),this.dot.drawCircle(0,0,6),this.dot.position.set(0,144),this.container.addChild(this.dot),this.stars=new at(function(){return new yt}),this.stars.scale.set(4),this.addChild(this.stars),this.set_percent(.5),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update))};St.__name__=!0,St.__super__=gt,St.prototype=e(gt.prototype,{set_percent:function(t){this.bar.clear(),this.bar.beginFill(16777215),this.bar.drawCircle(-140,0,6);var r=+t;this.bar.drawCircle(-140*(1-r)+140*r,0,6);r=+t;this.bar.drawRect(-140,-6,0*(1-r)+280*r,12),this.bar.endFill();r=+t;return this.dot.x=-140*(1-r)+140*r,this.percent=t},set_state:function(t){var r=t.state;if(null==r)this.state=kt.OUT;else switch(r._hx_index){case 0:case 1:this.state=kt.OUT;break;case 2:this.state=kt.IN,this.set_percent(0),this.score.text=""+Or,Vt.get(1,tr(this,this.animate_skill))}},update:function(t){var r;switch(this.state._hx_index){case 0:r=0;break;case 1:r=this.out_pos}this.container.y+=.1*(r-this.container.y)},animate_skill:function(){var l=this,t=0;Xr.shift();for(var r=0,i=Xr;r<i.length;)t+=i[r++];var e=((t/=Xr.length)-20)/-15,s=Math.min(Math.max(0*(1-e)+e,.5),1);Zt.tween(this,1,{percent:s},{ease:Jt.quadOut,on_complete:function(){Ct.play(Ft.SFX_GET);var t=+s;l.stars.position.set(-140*(1-t)+140*t,144);var r=zt.get(0,100),i=45;i*=Math.PI/180;var e=Math.sqrt(r[0]*r[0]+r[1]*r[1]),n=e*Math.cos(i),o=e*Math.sin(i);null==o&&(o=0),null==n&&(n=0),r[0]=zt.zero(n),r[1]=zt.zero(o),l.stars.get().fire({position:zt.from_array_int([0,0]),velocity:r});r=zt.get(0,100),i=135;i*=Math.PI/180;n=(e=Math.sqrt(r[0]*r[0]+r[1]*r[1]))*Math.cos(i);null==(o=e*Math.sin(i))&&(o=0),null==n&&(n=0),r[0]=zt.zero(n),r[1]=zt.zero(o),l.stars.get().fire({position:zt.from_array_int([0,0]),velocity:r});r=zt.get(0,100),i=225;i*=Math.PI/180;n=(e=Math.sqrt(r[0]*r[0]+r[1]*r[1]))*Math.cos(i);null==(o=e*Math.sin(i))&&(o=0),null==n&&(n=0),r[0]=zt.zero(n),r[1]=zt.zero(o),l.stars.get().fire({position:zt.from_array_int([0,0]),velocity:r});r=zt.get(0,100),i=315;i*=Math.PI/180;n=(e=Math.sqrt(r[0]*r[0]+r[1]*r[1]))*Math.cos(i);null==(o=e*Math.sin(i))&&(o=0),null==n&&(n=0),r[0]=zt.zero(n),r[1]=zt.zero(o),l.stars.get().fire({position:zt.from_array_int([0,0]),velocity:r})}})},__properties__:{set_percent:"set_percent"}});var Tt=function(){this.out_x=-600;for(var t=new L,r=0,i=[],e=0,n=it.__empty_constructs__.slice();e<n.length;)i.push(n[e++]);for(var o=i;r<o.length;){var l=o[r];++r,t.set(l,c.string(l).split("_").join(" "))}this.names=t,this.icons=new L;for(var s=Gt("assets/power_icons.png",5,2,128,128),t=0,r=[],e=0,i=it.__empty_constructs__.slice();e<i.length;)r.push(i[e++]);for(i=r;t<i.length;){l=i[t];++t;for(var _=this.icons,r=[],e=0,n=it.__empty_constructs__.slice();e<n.length;)r.push(n[e++]);_.set(l,s[r.indexOf(l)])}gt.call(this,Rt.TOP_LEFT,At.WINDOW,zt.get(136,136)),d.game_events.listen(y.NEW_POWER,tr(this,this.set_power)),this.icon_sprite=PIXI.Sprite.from(s[0]),this.icon_sprite.anchor.set(.5),this.name_bg=new PIXI.Graphics,this.name_bg.position.set(64,0),this.name_text=new PIXI.Text("",{fill:16777215,fontSize:36,fontFamily:"'Lilita One', Arial"}),this.name_text.position.set(96,0),this.name_text.anchor.set(0,.5);var a=new PIXI.Container;this.container=new PIXI.Container,this.container.x=this.out_x,this.addChild(a),a.addChild(this.container),this.container.addChild(this.icon_sprite),this.container.addChild(this.name_bg),this.container.addChild(this.name_text),this.set_power({power:it.JUMP}),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update))};Tt.__name__=!0,Tt.__super__=gt,Tt.prototype=e(gt.prototype,{set_power:function(t){var r;null!=t.power&&(r=this.icons.get(t.power),this.icon_sprite.texture=r,r=this.names.get(t.power),this.name_text.text=r,this.name_bg.clear(),this.name_bg.beginFill(0,.75),this.name_bg.drawRect(0,-30,this.name_text.width+32,60),this.name_bg.arc(this.name_text.width+32,0,30,-Math.PI/2,Math.PI/2),this.name_bg.endFill())},resize:function(t){gt.prototype.resize.call(this,t),this.name_bg.visible=this.name_text.visible=.5<this.scale.x},set_state:function(t){var r=t.state;if(null==r)this.state=kt.OUT;else switch(r._hx_index){case 1:this.state=kt.IN;break;case 0:case 2:this.state=kt.OUT}},update:function(t){var r;switch(this.state._hx_index){case 0:r=0;break;case 1:r=this.out_x}this.container.x+=.1*(r-this.container.x)}});var Et=function(){var t=new L;t.set(it.JUMP,"TAP TO JUMP, RELEASE TAP TO FALL"),t.set(it.DOUBLE_JUMP,"TAP TO JUMP, TAP AGAIN TO JUMP IN MIDAIR"),t.set(it.JETPACK,"HOLD TO BOOST, RELEASE TO FALL"),t.set(it.GLIDE,"TAP TO JUMP, HOLD TO GLIDE"),t.set(it.GRAVITY_FLIP,"TAP TO REVERSE GRAVITY"),t.set(it.PING_PONG,"TAP TO SWITCH DIRECTION"),t.set(it.PARKOUR,"TAP TO DASH, RUN UP WALLS"),t.set(it.POGO,"HOLD TO SLOW DOWN AND BOUNCE HIGHER"),t.set(it.ZERO_GRAVITY,"HOLD TO BOOST, RELEASE TO AIM"),t.set(it.HIGH_JUMP,"HOLD TO CHARGE UP A HIGH JUMP"),this.instructions=t,this.out_target=-200,gt.call(this,Rt.BOTTOM_CENTER,null,zt.get(0,-64)),this.bg=new PIXI.Graphics,this.text=new PIXI.Text("",{fill:16777215,fontSize:36,fontFamily:"'Lilita One', Arial"}),this.text.position.set(16,0),this.text.anchor.set(.5),this.pointer_sprite=PIXI.Sprite.from("assets/pointer.png"),this.pointer_sprite.anchor.set(.5);var r=new PIXI.Container;this.container=new PIXI.Container,r.addChild(this.container),this.container.addChild(this.bg),this.container.addChild(this.text),this.container.addChild(this.pointer_sprite),this.addChild(r),d.game_events.listen(y.NEW_POWER,tr(this,this.set_power)),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update)),this.set_power({power:it.JUMP})};Et.__name__=!0,Et.__super__=gt,Et.prototype=e(gt.prototype,{set_power:function(t){var r=this.instructions.get(t.power);this.text.text=r;var i=this.text.width+112;this.bg.clear(),this.bg.beginFill(0,.75),this.bg.drawRoundedRect(-i/2,-32,i,64,32),this.bg.endFill(),this.pointer_sprite.position.set(-i/2+40,0)},set_state:function(t){var r=this,i=t.state;if(null!=i)switch(i._hx_index){case 0:this.state=kt.IN,this.set_title("TAP ANYWHERE TO BEGIN!");break;case 1:null!=this.timer&&this.timer.get_active()&&this.timer.cancel(),this.state=kt.IN,this.set_power({power:it.JUMP});break;case 2:this.timer=Vt.get(1,function(){r.state=kt.OUT}),this.set_title("TAP ANYWHERE TO PLAY AGAIN!")}},set_title:function(t){this.text.text=t;var r=this.text.width+112;this.bg.clear(),this.bg.beginFill(0,.75),this.bg.drawRoundedRect(-r/2,-32,r,64,32),this.bg.endFill(),this.pointer_sprite.position.set(-r/2+40,0)},update:function(t){var r;switch(this.state._hx_index){case 0:r=0;break;case 1:r=this.out_target}this.container.y+=.1*(r-this.container.y)}});var Mt=function(t,r,i){null==i&&(i=2),null==r&&(r=.2);var e=this;PIXI.Sprite.call(this),this.transform.setFromMatrix(t.transform.worldTransform),this.texture=t.texture,Zt.tween(this.scale,r,{x:this.scale.x*i,y:this.scale.y*i},{ease:Jt.quadOut}),Zt.tween(this,r,{alpha:0},{ease:Jt.quintOut}),Vt.get(r+.1,function(){e.destroy(!1)}),Xt.i.active||d.app.stage.addChild(this),this.anchor.set(.5)};Mt.__name__=!0,Mt.__super__=PIXI.Sprite,Mt.prototype=e(PIXI.Sprite.prototype,{});var Ot=function(){this.out_x=400;var r=this;gt.call(this,Rt.TOP_RIGHT,At.WINDOW,zt.get(-120,120)),this.score_text=new PIXI.Text("0",{fill:16753408,fontSize:144,fontFamily:"'Lilita One', Arial",strokeThickness:16,stroke:0}),this.score_text.anchor.set(.5),this.container=new PIXI.Container,this.container.x=this.out_x,this.addChild(this.container),this.container.addChild(this.score_text),d.game_events.listen(y.NEW_POWER,function(t){r.score_text.text=""+Or}),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update))};Ot.__name__=!0,Ot.__super__=gt,Ot.prototype=e(gt.prototype,{set_state:function(t){var r=t.state;if(null==r)this.state=kt.OUT;else switch(r._hx_index){case 1:this.state=kt.IN;break;case 0:case 2:this.state=kt.OUT}},update:function(t){var r;switch(this.state._hx_index){case 0:r=0;break;case 1:r=this.out_x}this.container.x+=.1*(r-this.container.x)}});var Xt=function(){var r=this;Xt.i=this,gt.call(this,Rt.MIDDLE_CENTER,At.WINDOW,zt.get()),this.container=new PIXI.Container,this.bg=new PIXI.Graphics,this.bg.beginFill(0,.75),this.bg.drawRect(-1920,-1920,3840,3840),this.bg.endFill(),this.bg.interactive=!0,this.bg.on("pointertap",function(t){r.hide()});var t=new PIXI.Graphics;t.interactive=!0,t.beginFill(0,.75),t.drawRect(-376,-182,768,380),t.endFill(),t.beginFill(16777215),t.drawRect(-384,-190,768,380),t.endFill();var i=new PIXI.Sprite(d.assets.resources["assets/linkedin.png"].texture);i.anchor.set(.5),i.position.set(-112,-48),i.interactive=i.buttonMode=!0,i.on("pointertap",function(t){l.location.href="https://www.linkedin.com/shareArticle?url=https://unboxedtechnology.com/skill-swap-game/"});var e=new PIXI.Sprite(d.assets.resources["assets/facebook.png"].texture);e.anchor.set(.5),e.position.set(0,-48),e.interactive=e.buttonMode=!0,e.on("pointertap",function(t){FB.ui({display:"popup",method:"share",href:"http://unboxedtechnology.com/skill-swap-game/",quote:"I got "+Rr+" points testing my skill agility with Unboxed Training & Technology! See how many skills you can unpack at http://unboxedtechnology.com/skill-swap-game/"})});var n=new PIXI.Sprite(d.assets.resources["assets/twitter.png"].texture);n.anchor.set(.5),n.position.set(112,-48),n.interactive=n.buttonMode=!0,n.on("pointertap",function(t){var r;r="https://twitter.com/intent/tweet?url=http%3A%2F%2Funboxedtechnology.com%2Fskill-swap-game%2F&text=I%20got%20"+Rr,l.location.href=r+"%20points%20testing%20my%20skill%20agility%20with%20Unboxed%20Training%20%26%20Technology!%20See%20how%20many%20skills%20you%20can%20unpack%20at"}),this.copy=new PIXI.Container;var o=new PIXI.Text("http://unboxedtechnology.com/skill-swap-game/",{fontFamily:"Arial",fontSize:24,fontWeight:"bold",fill:0});this.copy_icon=new PIXI.Sprite(d.assets.resources["assets/copy.png"].texture),o.anchor.set(1,.5),this.copy_icon.anchor.set(0,.5),o.x=-8,this.copy_icon.x=8,this.copy.addChild(o),this.copy.addChild(this.copy_icon),this.copy.position.set(240,48),this.copy.interactive=this.copy.buttonMode=!0,this.copy.on("pointertap",function(t){var r;r="http://unboxedtechnology.com/skill-swap-game/",l.navigator.clipboard.writeText(r).then(function(t){Nt()},function(t){!function(t){var r=window.document.createElement("textarea");r.value=t,r.style.top="0",r.style.left="0",r.style.position="fixed",window.document.body.appendChild(r),r.focus(),r.select();try{(window.document.execCommand("copy")?Nt:Ut)()}catch(t){Ut()}window.document.body.removeChild(r)}(r)})}),this.copy_confirmation=PIXI.Sprite.from(d.assets.resources["assets/copy_confirmation.png"].texture),this.copy_confirmation.anchor.set(.5),this.copy_confirmation.position.set(0,96),this.copy_confirmation.alpha=0,this.addChild(this.container),this.container.addChild(this.bg),this.container.addChild(t),this.container.addChild(i),this.container.addChild(e),this.container.addChild(n),this.container.addChild(this.copy),this.container.addChild(this.copy_confirmation),this.hide()};Xt.__name__=!0,Xt.__super__=gt,Xt.prototype=e(gt.prototype,{show:function(){this.container.x=0,this.active=!0},hide:function(){this.container.x=5120,Vt.get(.1,function(){bt.i.just_pressed=!1}),this.active=!1}});var Rt=h["ui.Anchor"]={__ename__:!0,__constructs__:null,TOP_LEFT:{_hx_name:"TOP_LEFT",_hx_index:0,__enum__:"ui.Anchor",toString:r},TOP_CENTER:{_hx_name:"TOP_CENTER",_hx_index:1,__enum__:"ui.Anchor",toString:r},TOP_RIGHT:{_hx_name:"TOP_RIGHT",_hx_index:2,__enum__:"ui.Anchor",toString:r},MIDDLE_LEFT:{_hx_name:"MIDDLE_LEFT",_hx_index:3,__enum__:"ui.Anchor",toString:r},MIDDLE_CENTER:{_hx_name:"MIDDLE_CENTER",_hx_index:4,__enum__:"ui.Anchor",toString:r},MIDDLE_RIGHT:{_hx_name:"MIDDLE_RIGHT",_hx_index:5,__enum__:"ui.Anchor",toString:r},BOTTOM_LEFT:{_hx_name:"BOTTOM_LEFT",_hx_index:6,__enum__:"ui.Anchor",toString:r},BOTTOM_CENTER:{_hx_name:"BOTTOM_CENTER",_hx_index:7,__enum__:"ui.Anchor",toString:r},BOTTOM_RIGHT:{_hx_name:"BOTTOM_RIGHT",_hx_index:8,__enum__:"ui.Anchor",toString:r}};Rt.__constructs__=[Rt.TOP_LEFT,Rt.TOP_CENTER,Rt.TOP_RIGHT,Rt.MIDDLE_LEFT,Rt.MIDDLE_CENTER,Rt.MIDDLE_RIGHT,Rt.BOTTOM_LEFT,Rt.BOTTOM_CENTER,Rt.BOTTOM_RIGHT],Rt.__empty_constructs__=[Rt.TOP_LEFT,Rt.TOP_CENTER,Rt.TOP_RIGHT,Rt.MIDDLE_LEFT,Rt.MIDDLE_CENTER,Rt.MIDDLE_RIGHT,Rt.BOTTOM_LEFT,Rt.BOTTOM_CENTER,Rt.BOTTOM_RIGHT];var At=h["ui.PositionReference"]={__ename__:!0,__constructs__:null,PARENT:{_hx_name:"PARENT",_hx_index:0,__enum__:"ui.PositionReference",toString:r},WINDOW:{_hx_name:"WINDOW",_hx_index:1,__enum__:"ui.PositionReference",toString:r}};At.__constructs__=[At.PARENT,At.WINDOW],At.__empty_constructs__=[At.PARENT,At.WINDOW];var kt=h["ui.UIState"]={__ename__:!0,__constructs__:null,IN:{_hx_name:"IN",_hx_index:0,__enum__:"ui.UIState",toString:r},OUT:{_hx_name:"OUT",_hx_index:1,__enum__:"ui.UIState",toString:r}};kt.__constructs__=[kt.IN,kt.OUT],kt.__empty_constructs__=[kt.IN,kt.OUT];var Lt=function(){gt.call(this,Rt.BOTTOM_RIGHT,At.WINDOW,zt.from_array_int([-192,-80]));var t=new PIXI.Graphics;t.beginFill(16777215),t.drawRoundedRect(-140,-56,280,512,16);var r=new PIXI.Text("Powered by",{fill:2965072,fontSize:20,fontFamily:"'Lilita One', Arial"});r.position.set(20,-20),r.anchor.set(.5);var i=PIXI.Sprite.from("assets/unboxed.png");i.anchor.set(.5,.25),i.scale.set(.8),this.container=new PIXI.Container,this.addChild(this.container),this.container.addChild(t),this.container.addChild(r),this.container.addChild(i),d.game_events.listen(y.GAME_STATE,tr(this,this.set_state)),d.game_events.listen(y.UPDATE,tr(this,this.update))};Lt.__name__=!0,Lt.__super__=gt,Lt.prototype=e(gt.prototype,{set_state:function(t){var r=t.state;if(null==r)this.state=kt.OUT;else switch(r._hx_index){case 1:this.state=kt.OUT;break;case 0:case 2:this.state=kt.IN}},update:function(t){var r,i=this.container,e=i.y;switch(this.state._hx_index){case 0:r=.1*(0-this.container.y);break;case 1:r=.1*(320-this.container.y)}i.y=e+r}});var Ft=h["util.Sound"]={__ename__:!0,__constructs__:null,DOUBLE_JUMP:{_hx_name:"DOUBLE_JUMP",_hx_index:0,__enum__:"util.Sound",toString:r},GLIDE:{_hx_name:"GLIDE",_hx_index:1,__enum__:"util.Sound",toString:r},GRAVITY_FLIP:{_hx_name:"GRAVITY_FLIP",_hx_index:2,__enum__:"util.Sound",toString:r},HIGH_JUMP:{_hx_name:"HIGH_JUMP",_hx_index:3,__enum__:"util.Sound",toString:r},JETPACK:{_hx_name:"JETPACK",_hx_index:4,__enum__:"util.Sound",toString:r},JUMP:{_hx_name:"JUMP",_hx_index:5,__enum__:"util.Sound",toString:r},NICE_JOB:{_hx_name:"NICE_JOB",_hx_index:6,__enum__:"util.Sound",toString:r},PARKOUR:{_hx_name:"PARKOUR",_hx_index:7,__enum__:"util.Sound",toString:r},PING_PONG:{_hx_name:"PING_PONG",_hx_index:8,__enum__:"util.Sound",toString:r},POGO:{_hx_name:"POGO",_hx_index:9,__enum__:"util.Sound",toString:r},SKILL_SWAP:{_hx_name:"SKILL_SWAP",_hx_index:10,__enum__:"util.Sound",toString:r},ZERO_GRAVITY:{_hx_name:"ZERO_GRAVITY",_hx_index:11,__enum__:"util.Sound",toString:r},SFX_BOOST:{_hx_name:"SFX_BOOST",_hx_index:12,__enum__:"util.Sound",toString:r},SFX_BOUNCE:{_hx_name:"SFX_BOUNCE",_hx_index:13,__enum__:"util.Sound",toString:r},SFX_CHARGE:{_hx_name:"SFX_CHARGE",_hx_index:14,__enum__:"util.Sound",toString:r},SFX_DASH:{_hx_name:"SFX_DASH",_hx_index:15,__enum__:"util.Sound",toString:r},SFX_DIE:{_hx_name:"SFX_DIE",_hx_index:16,__enum__:"util.Sound",toString:r},SFX_DOUBLE_JUMP:{_hx_name:"SFX_DOUBLE_JUMP",_hx_index:17,__enum__:"util.Sound",toString:r},SFX_GET:{_hx_name:"SFX_GET",_hx_index:18,__enum__:"util.Sound",toString:r},SFX_GRAV_SHIFT:{_hx_name:"SFX_GRAV_SHIFT",_hx_index:19,__enum__:"util.Sound",toString:r},SFX_HURT:{_hx_name:"SFX_HURT",_hx_index:20,__enum__:"util.Sound",toString:r},SFX_JUMP:{_hx_name:"SFX_JUMP",_hx_index:21,__enum__:"util.Sound",toString:r},SFX_LAND:{_hx_name:"SFX_LAND",_hx_index:22,__enum__:"util.Sound",toString:r},SFX_POGO:{_hx_name:"SFX_POGO",_hx_index:23,__enum__:"util.Sound",toString:r},SFX_PONG:{_hx_name:"SFX_PONG",_hx_index:24,__enum__:"util.Sound",toString:r},SFX_PONG_HIT:{_hx_name:"SFX_PONG_HIT",_hx_index:25,__enum__:"util.Sound",toString:r},SFX_SPAWN:{_hx_name:"SFX_SPAWN",_hx_index:26,__enum__:"util.Sound",toString:r},SFX_SPIKES_DOWN:{_hx_name:"SFX_SPIKES_DOWN",_hx_index:27,__enum__:"util.Sound",toString:r},SFX_SPIKES_UP:{_hx_name:"SFX_SPIKES_UP",_hx_index:28,__enum__:"util.Sound",toString:r},SFX_TWINKLE:{_hx_name:"SFX_TWINKLE",_hx_index:29,__enum__:"util.Sound",toString:r}};Ft.__constructs__=[Ft.DOUBLE_JUMP,Ft.GLIDE,Ft.GRAVITY_FLIP,Ft.HIGH_JUMP,Ft.JETPACK,Ft.JUMP,Ft.NICE_JOB,Ft.PARKOUR,Ft.PING_PONG,Ft.POGO,Ft.SKILL_SWAP,Ft.ZERO_GRAVITY,Ft.SFX_BOOST,Ft.SFX_BOUNCE,Ft.SFX_CHARGE,Ft.SFX_DASH,Ft.SFX_DIE,Ft.SFX_DOUBLE_JUMP,Ft.SFX_GET,Ft.SFX_GRAV_SHIFT,Ft.SFX_HURT,Ft.SFX_JUMP,Ft.SFX_LAND,Ft.SFX_POGO,Ft.SFX_PONG,Ft.SFX_PONG_HIT,Ft.SFX_SPAWN,Ft.SFX_SPIKES_DOWN,Ft.SFX_SPIKES_UP,Ft.SFX_TWINKLE],Ft.__empty_constructs__=[Ft.DOUBLE_JUMP,Ft.GLIDE,Ft.GRAVITY_FLIP,Ft.HIGH_JUMP,Ft.JETPACK,Ft.JUMP,Ft.NICE_JOB,Ft.PARKOUR,Ft.PING_PONG,Ft.POGO,Ft.SKILL_SWAP,Ft.ZERO_GRAVITY,Ft.SFX_BOOST,Ft.SFX_BOUNCE,Ft.SFX_CHARGE,Ft.SFX_DASH,Ft.SFX_DIE,Ft.SFX_DOUBLE_JUMP,Ft.SFX_GET,Ft.SFX_GRAV_SHIFT,Ft.SFX_HURT,Ft.SFX_JUMP,Ft.SFX_LAND,Ft.SFX_POGO,Ft.SFX_PONG,Ft.SFX_PONG_HIT,Ft.SFX_SPAWN,Ft.SFX_SPIKES_DOWN,Ft.SFX_SPIKES_UP,Ft.SFX_TWINKLE];var Ct=function(){};Ct.__name__=!0,Ct.init=function(){Howler.init(),Ct.music=new Howl({src:["assets/audio/music.ogg","assets/audio/music.mp3","assets/audio/music.wav"],loop:!0,preload:!0,volume:.9});for(var t=0,r=[],i=0,e=Ft.__empty_constructs__.slice();i<e.length;)r.push(e[i++]);for(e=r;t<e.length;){var n=e[t];++t;var o=new Howl({src:["assets/audio/"+c.string(n).toLowerCase()+".ogg","assets/audio/"+c.string(n).toLowerCase()+".mp3","assets/audio/"+c.string(n).toLowerCase()+".wav"],loop:!1,preload:!0,volume:Ct.volume.get(n)});Ct.sounds.set(n,o),Ct.cooldowns.set(n,!0)}},Ct.play=function(t){Ct.cooldowns.get(t)&&(Ct.sounds.get(t).play(),Ct.cooldowns.set(t,!1),Vt.get(.1,function(){Ct.cooldowns.set(t,!0)}))},Ct.stop=function(t){Ct.sounds.get(t).stop()},Ct.play_music=function(){Ct.music.playing()||Ct.music.play()};var qt=function(){this.offset=zt.get(0,0),this.scroll=zt.get(0,-108),PIXI.Container.call(this)};function Gt(t,r,i,e,n){for(var o=d.assets.resources[t].texture,l=[],s=0;s<i;)for(var _=s++,a=0;a<r;)l.push(new PIXI.Texture(o.baseTexture,new PIXI.Rectangle(a++*e,_*n,e,n)));return l}qt.__name__=!0,qt.__super__=PIXI.Container,qt.prototype=e(PIXI.Container.prototype,{update:function(t){this.position.set(this.wide?-224:-Math.min(Math.max(this.scroll[0],64-this.offset[0]),384+this.offset[0]),-this.scroll[1]+this.offset[1])},resize:function(t){this.wide=t.width/mt.zoom>mt.game_width;var r=this.offset,i=-t.width/mt.zoom/2,e=-t.height/mt.zoom/2;null==e&&(e=0),null==i&&(i=0),r[0]=zt.zero(i),r[1]=zt.zero(e)}});var Dt=function(){};function Nt(){Xt.i.copy_confirmation.alpha=1,Vt.get(4,function(){Xt.i.copy_confirmation.alpha=0})}function Ut(){console.log("src/util/Social.hx:74:","Fallback: Oops, unable to copy")}Dt.__name__=!0,Dt.__properties__={get_just_released:"get_just_released",get_just_pressed:"get_just_pressed"},Dt.init=function(){window.addEventListener("pointerdown",function(t){return Dt._pressed=!0}),window.addEventListener("pointerup",function(t){return Dt._pressed=!1}),window.addEventListener("pointerout",function(t){return Dt._pressed=!1}),d.game_events.listen(y.PRE_UPDATE,function(t){Dt.pressed=Dt._pressed}),d.game_events.listen(y.POST_UPDATE,function(t){Dt.last=Dt.pressed})},Dt.get_just_pressed=function(){return!!Dt.pressed&&!Dt.last},Dt.get_just_released=function(){return!Dt.pressed&&Dt.last};var zt={zero:function(t){return Math.abs(t)<=zt.epsilon?0:t},from_array_float:function(t){return zt.get(t[0],t[1])},from_array_int:function(t){return zt.get(t[0],t[1])},get:function(t,r){if(null==r&&(r=0),null==t&&(t=0),null!=zt.pool&&0<zt.pool.length){var i=zt.pool.shift(),e=t,n=null==r?0:r;return null==t&&(e=0),i[0]=zt.zero(e),i[1]=zt.zero(n),i}return[e=null==t?0:t,n=null==r?0:r]},add:function(t,r){return zt.get(t[0]+r[0],t[1]+r[1])},subtract:function(t,r){return zt.get(t[0]-r[0],t[1]-r[1])},multiply_f:function(t,r){return zt.get(t[0]*r,t[1]*r)}},jt=function(){};jt.__name__=!0,jt.shuffle=function(t){for(var r=0,i=t.length;r<i;){var e=r++,n=t.length,o=Math.random()*n|0,l=t[e];t[e]=t[o],t[o]=l}return t};var Ht=function(t){this.data=new F,this.animation_index=-1,this.on_frame_change=t.on_frame_change};Ht.__name__=!0,Ht.prototype={add:function(t){return null==t.duration&&(t.duration=1),null==t.type&&(t.type=Qt.LOOP_FORWARDS),null==t.ease&&(t.ease=function(t){return t}),this.data.h[t.name]=t,this},play:function(t,r,i){var e;null==i&&(i=!1),null==r&&(r=0),Object.prototype.hasOwnProperty.call(this.data.h,t)&&(null!=this.current&&this.current.name==t&&!i||(this.current=this.data.h[t],this.set_animation_index(0),null!=this.tween&&(this.tween.active=!1),e=this.current.frames.length-1,this.tween=Zt.get(this).duration(this.current.duration).ease(this.current.ease).set_period(r).type(this.current.type).prop({animation_index:e}),null!=this.current.on_complete&&this.tween.on_complete(this.current.on_complete),this.on_frame_change(this.current.frames[0])))},set_animation_index:function(t){return null==this.current?t:(t=Math.round(t)%this.current.frames.length,this.animation_index==t?t:(this.on_frame_change(this.current.frames[t]),this.animation_index=t))},destroy:function(){this.tween.destroy(),this.data.h=Object.create(null),this.current=null},get_active:function(){return this.tween.active},__properties__:{get_active:"get_active",set_animation_index:"set_animation_index"}};var Jt=function(){};Jt.__name__=!0,Jt.quadOut=function(t){return-t*(t-2)},Jt.quintOut=function(t){return--t*t*t*t*t+1},Jt.backIn=function(t){return t*t*(2.70158*t-1.70158)},Jt.backOut=function(t){return 1- --t*t*(-2.70158*t-1.70158)},Jt.elasticOut=function(t){return Jt.ELASTIC_AMPLITUDE*Math.pow(2,-10*t)*Math.sin((t-Jt.ELASTIC_PERIOD/(2*Math.PI)*Math.asin(1/Jt.ELASTIC_AMPLITUDE))*(2*Math.PI)/Jt.ELASTIC_PERIOD)+1};var Kt=function(){};Kt.__name__=!0,Kt.get_tile_layer=function(t,r){for(var i=0,e=t.layers;i<e.length;){var n=e[i];if(++i,n.name==r)return n}return null},Kt.get_entity_layer=function(t,r){for(var i=0,e=t.layers;i<e.length;){var n=e[i];if(++i,n.name==r)return n}return null},Kt.load_entities=function(t,r){for(var i=0,e=t.entities;i<e.length;)r(e[i++])};var Yt=function(){};Yt.__name__=!0,Yt.update=function(t){Yt.counter=(Yt.counter+t)%1},Yt.synced_sin=function(t){return Math.sin(Yt.counter*Math.PI*2/t)};var Vt=function(){};Vt.__name__=!0,Vt.get=function(t,r,i){null==i&&(i=1);var e=0<Vt.pool.length?Vt.pool.shift():new Vt;return e.time=t,e.fn=r,e.repeat=i,e.paused=!1,e.elapsed=0,Vt.timers.push(e),e},Vt.update=function(t){for(var r=0,i=Vt.timers;r<i.length;)i[r++].run(t)},Vt.prototype={get_active:function(){return 0<=Vt.timers.indexOf(this)},cancel:function(){s.remove(Vt.timers,this)&&Vt.pool.push(this)},pause:function(){this.paused=!0},run:function(t){this.paused||(this.elapsed+=t,this.time-this.elapsed>Vt.epsilon||(this.fn(),this.elapsed=0,this.repeat--,0==this.repeat&&this.cancel()))},__properties__:{get_active:"get_active"}};var Zt=function(){this.active=!0};Zt.__name__=!0,Zt.get=function(t){var r=Zt.pool.shift();return null==r&&(r=new Zt),r.init(t),r.active=!0,Zt.active_tweens.push(r),r},Zt.tween=function(t,r,i,e){var n=Zt.get(t).duration(r).prop(i);return null==e||(null!=e.delay&&n.delay(e.delay),null!=e.ease&&n.ease(e.ease),null!=e.type&&n.type(e.type),null!=e.on_complete&&n.on_complete(e.on_complete)),n},Zt.update=function(t){for(var r=0,i=Zt.active_tweens;r<i.length;)i[r++].update_tween(t)},Zt.prototype={duration:function(t){return this.data.duration=t,this},prop:function(t){for(var r=0,i=_.fields(t);r<i.length;){var e=i[r];++r;var n=_.getProperty(this.data.target,e);if(this.data.target instanceof Array)switch(e){case"g":case"y":n=this.data.target[1];break;case"a":case"height":case"w":n=this.data.target[3];break;case"b":case"width":case"z":n=this.data.target[2];break;case"r":case"x":n=this.data.target[0]}this.data.properties.push({field:e,start:null==n?0:n,end:_.field(t,e)})}return this},ease:function(t){return this.data.ease=t,this},delay:function(t){return this.data.delay=t,this.data.delay_ref=t,this},on_complete:function(t){return this.data.on_complete=t,this},type:function(t){var r;switch((this.data.type=t)._hx_index){case 1:case 3:r=!0;break;case 0:case 2:case 4:r=!1}return this.reverse=r,this},set_period:function(t){return this.period=Math.max(Math.min(t,1),0),this},destroy:function(){this.data=null,s.remove(Zt.active_tweens,this),this.active=!1,Zt.pool.push(this)},init:function(t){this.data=this.get_default_data(t),this.period=0,this.reverse=!1},get_default_data:function(t){return{target:t,duration:1,properties:[],ease:function(t){return t},delay:0,delay_ref:0,on_complete:function(){},type:Qt.SINGLE_SHOT_FORWARDS}},update_tween:function(t){this.active&&(t=this.update_dt(t),this.update_period(t))},update_dt:function(t){if(0<this.data.delay){if(this.data.delay-=t,0<this.data.delay)return 0;t=-this.data.delay}return t},update_period:function(t){var r;0!=t&&(r=t/this.data.duration,this.period+=this.reverse?-r:r,this.period=Math.max(Math.min(this.period,1),0),0==this.period||1==this.period?this.complete():this.apply())},complete:function(){switch(this.apply(),this.data.on_complete(),this.data.type._hx_index){case 0:case 1:this.destroy();break;case 2:case 3:case 4:this.reset()}},reset:function(){this.data.type==Qt.PING_PONG&&(this.reverse=!this.reverse),this.data.delay=this.data.delay_ref,this.period=this.reverse?1:0},apply:function(){if(null!=this.data)for(var t=this.data.ease(this.period),r=0,i=this.data.properties;r<i.length;){var e=i[r];++r;var n=+t,o=(1-n)*e.start+n*e.end;if(this.data.target instanceof Array)switch(e.field){case"g":case"y":this.data.target[1]=o;break;case"a":case"height":case"w":this.data.target[3]=o;break;case"b":case"width":case"z":this.data.target[2]=o;break;case"r":case"x":this.data.target[0]=o}else _.setProperty(this.data.target,e.field,o)}}};var $t,Qt=h["zero.utilities.TweenType"]={__ename__:!0,__constructs__:null,SINGLE_SHOT_FORWARDS:{_hx_name:"SINGLE_SHOT_FORWARDS",_hx_index:0,__enum__:"zero.utilities.TweenType",toString:r},SINGLE_SHOT_BACKWARDS:{_hx_name:"SINGLE_SHOT_BACKWARDS",_hx_index:1,__enum__:"zero.utilities.TweenType",toString:r},LOOP_FORWARDS:{_hx_name:"LOOP_FORWARDS",_hx_index:2,__enum__:"zero.utilities.TweenType",toString:r},LOOP_BACKWARDS:{_hx_name:"LOOP_BACKWARDS",_hx_index:3,__enum__:"zero.utilities.TweenType",toString:r},PING_PONG:{_hx_name:"PING_PONG",_hx_index:4,__enum__:"zero.utilities.TweenType",toString:r}};function tr(t,r){return null==r?null:(null==r.__id__&&(r.__id__=l.$haxeUID++),null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[r.__id__],null==i&&(i=r.bind(t),t.hx__closures__[r.__id__]=i),i);var i}Qt.__constructs__=[Qt.SINGLE_SHOT_FORWARDS,Qt.SINGLE_SHOT_BACKWARDS,Qt.LOOP_FORWARDS,Qt.LOOP_BACKWARDS,Qt.PING_PONG],Qt.__empty_constructs__=[Qt.SINGLE_SHOT_FORWARDS,Qt.SINGLE_SHOT_BACKWARDS,Qt.LOOP_FORWARDS,Qt.LOOP_BACKWARDS,Qt.PING_PONG],l.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(s.now=performance.now.bind(performance)),String.__name__=!0,Array.__name__=!0,z.__toStr={}.toString,d.container=window.document.getElementById("game"),d.app_events=new n,d.game_events=new n,o.RESIZE="RESIZE",y.UPDATE="UPDATE",y.PRE_UPDATE="PRE_UPDATE",y.POST_UPDATE="POST_UPDATE",y.NEW_POWER="NEW_POWER",y.PLAYER_HEALTH="PLAYER_HEALTH",y.GAME_STATE="GAME_STATE",j.ids=0,H.qr=[],H.sqr=[],W.cached_listeners=new f,W.cached_collisions=[],W.cached_zero=new hi(0,0),Wt._pool=new v(Wt),ht.zero=new hi(0,0),x._pool=new v(x),Ur._pool=new v(Ur),B._pool=new v(B),Bt._pool=new v(Bt),D._pool=new v(D),J._pool=new v(J),K._pool=new v(K),ui._pool=new v(ui),C._pool=new v(C),ar.norm=new hi(0,0),ar.closest=new hi(0,0),V.all=[],ft.epsilon=1e-8,ft.pool=[],vt.epsilon=1e-8,vt.pool=[],mt.game_width=320,mt.game_height=180,mt.level_rect=ft.get(64,64,mt.game_width,mt.game_height),gt.all=[],Ct.volume=(($t=new L).set(Ft.DOUBLE_JUMP,.5),$t.set(Ft.GLIDE,.5),$t.set(Ft.GRAVITY_FLIP,.5),$t.set(Ft.HIGH_JUMP,.5),$t.set(Ft.JETPACK,.5),$t.set(Ft.JUMP,.5),$t.set(Ft.NICE_JOB,.5),$t.set(Ft.PARKOUR,.5),$t.set(Ft.PING_PONG,.5),$t.set(Ft.POGO,.5),$t.set(Ft.SKILL_SWAP,.5),$t.set(Ft.ZERO_GRAVITY,.5),$t.set(Ft.SFX_BOOST,.9),$t.set(Ft.SFX_BOUNCE,.4),$t.set(Ft.SFX_CHARGE,.7),$t.set(Ft.SFX_DASH,.6),$t.set(Ft.SFX_DIE,.9),$t.set(Ft.SFX_DOUBLE_JUMP,.9),$t.set(Ft.SFX_GET,.75),$t.set(Ft.SFX_GRAV_SHIFT,.6),$t.set(Ft.SFX_HURT,.9),$t.set(Ft.SFX_JUMP,.8),$t.set(Ft.SFX_LAND,.2),$t.set(Ft.SFX_POGO,.6),$t.set(Ft.SFX_PONG,.3),$t.set(Ft.SFX_PONG_HIT,.5),$t.set(Ft.SFX_SPAWN,.7),$t.set(Ft.SFX_SPIKES_DOWN,.6),$t.set(Ft.SFX_SPIKES_UP,.8),$t.set(Ft.SFX_TWINKLE,.5),$t),Ct.sounds=new L,Ct.cooldowns=new L;var rr=500,ir=.08,er=.5,nr=224,or=500,lr=-200,sr=50,_r=10,dr=64,yr=40,cr=16,hr=2,ur=3,fr=64,vr=12,mr=112,pr=300,gr=1,xr=128,wr=400,Ir=.075,br=96,Pr=240,Sr=32,Tr=2.5,Er=1.5,Mr=3,Or=0,Xr=[],Rr=c.parseInt(window.localStorage.getItem("hiscore")),Ar=1==c.parseInt(window.localStorage.getItem("muted"));Dt.last=!1,Dt._pressed=!1,Dt.pressed=!1,zt.epsilon=1e-8,zt.pool=[];var kr=zt.get(0,-1),Lr=zt.get(0,1),Fr=zt.get(-1,0),Cr=zt.get(1,0),qr=new hi(0,1);Jt.ELASTIC_AMPLITUDE=1,Jt.ELASTIC_PERIOD=.4,Yt.counter=0,Vt.timers=[],Vt.pool=[],Vt.epsilon=1e-8,Zt.active_tweens=[],Zt.pool=[],d.main()}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);